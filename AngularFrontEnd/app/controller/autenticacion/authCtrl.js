app.controller("authCtrl",function($scope,$rootScope,$routeParams,$location,$http,Data,sessionService,CONFIG,LogGuardarInfo,registroLog,sweet){$scope.imageCST="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAFCAIAAADtz9qMAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAbSURBVBhXY3growJHIM5/GIBy0GWgHCiSUQEAe00iZYBvZ5oAAAAASUVORK5CYII=";$scope.imageLNG="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAFCAIAAADtz9qMAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAbSURBVBhXY3growJHIM5/GIBy0GWgHCiSUQEAe00iZYBvZ5oAAAAASUVORK5CYII=";
$scope.login={};$scope.signup={};$scope.opciones="mostrar";var vAsunto="Restauracion_de_PIN_GAMLP";var vMensaje="Usted_solicito_restaurar_PIN.";$scope.datos="";$scope._id="";$scope.getCaptchasX=function(){$scope.valorrandom=Math.floor(Math.random()*(224-1)+1);$scope.resultadoC="";var resAct=new reglasnegocio;resAct.identificador="RCCIUDADANO_77";resAct.parametros='{"x":"'+$scope.valorrandom+'"}';resAct.llamarregla(function(data){data=JSON.parse(data);$scope.data_capX=data;$scope.idImg=data[0].vctcs_id;
$scope.Imgenf=data[0].vctcs_url;$scope.imageCST=data[0].vctcs_urlc;if(data[0].vlng=="A")$scope.lengua="AYMARA";if(data[0].vlng=="Q")$scope.lengua="QUECHUA";if(data[0].vlng=="G")$scope.lengua="GUARANI";if(data[0].vlng=="C")$scope.lengua="CASTELLANO";$scope.imageLNG=$scope.Imgenf;$scope.palabraT="Ingrese texto: "+$scope.lengua+" CASTELLANO";$scope.toltipT="Palabra en "+$scope.lengua})};$scope.VerificarCapcha=function(prsCI,prsCorreo){var resAct=new reglasnegocio;resAct.identificador="RCCIUDADANO_88";
resAct.parametros='{"id":"'+$scope.idImg+'","rsp":"'+$scope.resultadoC+'"}';resAct.llamarregla(function(data){data=JSON.parse(data);$.unblockUI();$scope.data_capXres=data;if($scope.data_capXres.length==0){$scope.getCaptchasX();$scope.resultadoC="";sweet.show("Advertencia","Vuelva registrar el capcha","error")}else $scope.restaurarPin2(prsCI,prsCorreo)})};$scope.inicioLoginNode=function(){alert("inicio login")};$scope.validarInicioLogin=function(){document.getElementById("dvContenidoView").style.display=
"block";document.getElementById("dvContenidoVacio").style.display="none";if(sessionStorage.getItem("autenticacion")){var sArrayData=sessionStorage.getItem("autenticacion");try{var tipoData=JSON.parse(sArrayData);if(tipoData.length>0)$scope.doLoginNode(sArrayData);else window.location.href="../autenticacion/partials/login_.html"}catch(e){window.location.href="../autenticacion/partials/login_.html"}}$scope.$apply()};$scope.$on("api:ready",function(){document.getElementById("dvContenidoView").style.display=
"block";document.getElementById("dvContenidoVacio").style.display="none";if(sessionStorage.getItem("autenticacion")){var sArrayData=sessionStorage.getItem("autenticacion");try{var tipoData=JSON.parse(sArrayData);if(tipoData.length>0)$scope.doLoginNode(sArrayData);else window.location.href="../autenticacion/partials/login_.html"}catch(e){window.location.href="../autenticacion/partials/login_.html"}}});$scope.sesionToken=function(){var urlToken=CONFIG.CONEXION_MOTOR_SERVICIO+"api/apiLogin";$.ajax({dataType:"json",
type:"POST",url:urlToken,data:CONFIG.CREDENCIAL_MOTORES,async:true,success:function(response){dataResp=JSON.stringify(response);sessionStorage.setItem("TOKEN_MOTOR",response.token)},error:function(response,status,error){dataResp='{"error":{"message":"'+response.responseText+'","code":700}}'}})};$scope.sesionTokenCem=function(){var urlToken=CONFIG.CONEXION_API_CEMENTERIO+"api/gntkn";$.ajax({dataType:"json",type:"POST",url:urlToken,data:CONFIG.CREDENCIAL_CARONTE,async:true,success:function(response){dataResp=
JSON.stringify(response);sessionStorage.setItem("TOKEN_CEM",response.token)},error:function(response,status,error){dataResp='{"error":{"message":"'+response.responseText+'","code":700}}'}})};$scope.sesionTokenODM=function(){var urlToken=CONFIG.SERVICE_SIERRA_ODM+"api/apiLogin";$.ajax({dataType:"json",type:"POST",url:urlToken,data:CONFIG.CREDENCIAL_MOTORESODM,async:false,success:function(response){dataResp=JSON.stringify(response);sessionStorage.setItem("TOKEN_MOTORODM",response.token)},error:function(response,
status,error){dataResp='{"error":{"message":"'+response.responseText+'","code":700}}'}})};$scope.sesionTokenMas=function(){var urlTokenM=CONFIG.CONEXION_SERVICIOMASCOTAS+"api/apiLogin";$.ajax({dataType:"json",type:"POST",url:urlTokenM,data:CONFIG.CREDENCIAL_MOTORESMASCOTAS,async:true,success:function(response){dataRespM=JSON.stringify(response);sessionStorage.setItem("TOKEN_MOTORM",response.token)},error:function(response,status,error){dataRespM='{"error":{"message":"'+response.responseText+'","code":700}}'}})};
$scope.doLoginNode=function(response){if(!$rootScope.idioma){var idiomaDatos=new rcIdioma;$rootScope.idioma=sessionService.get("Idioma");idiomaDatos.filtro=$rootScope.idioma;idiomaDatos.obtenerTitulos(function(resultado){$scope.Label=JSON.parse(resultado);$rootScope.translateTitulos={};angular.forEach($scope.Label.success,function(celda,fila){$rootScope.translateTitulos[celda.idm_label]=celda.idm_contenido})});idiomaDatos.obtenerContenidos(function(resultado){$scope.Contenidos=JSON.parse(resultado);
$rootScope.translateContenidos={};angular.forEach($scope.Contenidos.success,function(celda,fila){$rootScope.translateContenidos[celda.idm_label]=celda.idm_contenido})});idiomaDatos.obtenerImagenes(function(resultado){$scope.Imagenes=JSON.parse(resultado);$rootScope.translateImagenes={};angular.forEach($scope.Imagenes.success,function(celda,fila){$rootScope.translateImagenes[celda.idm_label]=celda.idm_contenido})});idiomaDatos.obtenerMensajes(function(resultado){$scope.Mensajes=JSON.parse(resultado);
$rootScope.translateMensajes={};angular.forEach($scope.Mensajes.success,function(celda,fila){$rootScope.translateMensajes[celda.idm_label]=celda.idm_contenido})});var results=JSON.parse(response);var sTipoPersona=results[0].dtspsl_tipo_persona;var sActFisica="";var sActDigital="";$scope.sesionToken();$scope.sesionTokenCem();$scope.sesionTokenMas();$rootScope.mostrarMenuMascota="NO";if(results.length>0&&sTipoPersona=="NATURAL"){$rootScope.mostrarMenuMascota="SI";var sActivacionDigital=results[0].dtspsl_activaciond;
var sActivacionFisica=results[0].dtspsl_activacionf;$rootScope.sAceptacion=results[0].dtspsl_acepta_servicios;sessionService.set("IDCIUDADANO",results[0]._id);sessionService.set("CICIUDADANO",results[0].dtspsl_ci);sessionService.set("CIEXPEDIDO",results[0].dtspsl_expedido);localStorage.setItem("CI",results[0].dtspsl_ci);sessionService.set("IDUSUARIO",results[0]._id);sessionService.set("IDSOLICITANTE",results[0]._id);sessionService.set("USUARIO","Ciudadano");if(results[0].dtspsl_tipo_persona="NATURAL"){sessionService.set("US_NOMBRE",
results[0].dtspsl_nombres);sessionService.set("US_PATERNO",results[0].dtspsl_paterno);sessionService.set("US_MATERNO",results[0].dtspsl_materno);sessionService.set("US_EMAIL",results[0].dtspsl_correo)}else{sessionService.set("US_NOMBRE",results[0].dtspsl_razon_social);sessionService.set("US_PATERNO",results[0].dtspsl_paterno);sessionService.set("US_MATERNO",results[0].dtspsl_materno);sessionService.set("US_EMAIL",results[0].dtspsl_correo)}$rootScope.nombre=sessionService.get("USUARIO");sessionService.set("TIPO_PERSONA",
results[0].dtspsl_tipo_persona);$rootScope.vid=results[0]._id;$rootScope.mostrarMenuMascotaNatural="NO";$rootScope.mostrarMenuMascota="NO";if(sActivacionFisica=="SI"){$rootScope.mostrarMenuMascotaNatural="SI";$rootScope.mostrarMenuMascota="NO";sessionService.set("US_IDROL","5");sessionService.set("US_ROL","Ciudadano nivel 2");$.unblockUI();registroLog.almacenarLog(4,results[0]._id,0,"Inicio de session NIVEL 2");var origenurlSesion=sessionStorage.getItem("urliniciomoduloigob");origenurlSesion=decodeURIComponent(origenurlSesion);
if(origenurlSesion&&origenurlSesion!="null"){sessionStorage.removeItem("urliniciomoduloigob");$location.path(origenurlSesion)}else{sessionService.set("SERVICIOS",results[0].dtspsl_acepta_servicios);$rootScope.stiporol=sessionService.get("US_IDROL");if(sessionStorage.getItem("sessionAPP")){var svariable=sessionStorage.getItem("sessionAPP");if(svariable==="ae")$location.path("registro_ciudadano|servicios|index.html");if(svariable==="pc")$location.path("territorio|PC");if(svariable==="dp")$location.path("catastro|duplicado");
if(svariable==="at")$location.path("catastro|actualizaciones")}else $location.path("dashboard")}}else if(sActivacionDigital=="NO"&&sActivacionFisica=="NO"){sessionService.set("US_IDROL","4");sessionService.set("US_ROL","Ciudadano nivel 1");$.unblockUI();registroLog.almacenarLog(4,results[0]._id,0,"Inicio de session NIVEL 1");var origenurlSesion=sessionStorage.getItem("urliniciomoduloigob");if(origenurlSesion&&origenurlSesion!="null"){sessionStorage.removeItem("urliniciomoduloigob");$location.path(origenurlSesion)}else{sessionService.set("SERVICIOS",
results[0].dtspsl_acepta_servicios);$rootScope.stiporol=sessionService.get("US_IDROL");$location.path("dashboard")}}}else if(results.length>0&&sTipoPersona=="JURIDICO"){if(results.length>0){var sActivacionDigital=results[0].dtspsl_activaciond;var sActivacionFisica=results[0].dtspsl_activacionf;$rootScope.sAceptacion=results[0].dtspsl_acepta_servicios;sessionService.set("IDCIUDADANO",results[0]._id);sessionService.set("CICIUDADANO",results[0].dtspsl_ci);sessionService.set("NITCIUDADANO",results[0].dtspsl_nit);
sessionService.set("IDUSUARIO",results[0]._id);sessionService.set("IDSOLICITANTE",results[0]._id);sessionService.set("USUARIO","Empresa");sessionService.set("US_ROL","Empresa");$rootScope.nombre=sessionService.get("USUARIO");sessionService.set("US_NOMBRE",results[0].dtspsl_razon_social);sessionService.set("US_PATERNO",results[0].dtspsl_paterno_representante);sessionService.set("REPRESENTANTE",results[0].dtspsl_representante);sessionService.set("REPRESENTANTECI",results[0].dtspsl_ci_representante);
sessionService.set("US_MATERNO",results[0].dtspsl_materno);sessionService.set("US_EMAIL",results[0].dtspsl_correo);$rootScope.vid=results[0]._id;sessionService.set("TIPO_PERSONA",results[0].dtspsl_tipo_persona);if(sActivacionDigital=="SI"&&sActivacionFisica=="SI"){sessionService.set("US_IDROL","5");sessionService.set("US_ROL","Empresa nivel 2");$.unblockUI();registroLog.almacenarLog(4,results[0]._id,0,"Inicio de session NIVEL 2");sessionService.set("SERVICIOS",results[0].dtspsl_acepta_servicios);
$rootScope.stiporol=sessionService.get("US_IDROL");$rootScope.mostrarMenuMascota="SI";if(results.dtspsl_tipo_empresa)if(results.dtspsl_tipo_empresa==4)$rootScope.mostrarMenuMascota="SI";$location.path("dashboard")}else if(sActivacionDigital=="NO"&&sActivacionFisica=="NO"||sActivacionDigital=="NO"&&sActivacionFisica=="SI"||sActivacionDigital=="SI"&&sActivacionFisica=="NO"){sessionService.set("US_IDROL","4");sessionService.set("US_ROL","Empresa nivel 1");$.unblockUI();registroLog.almacenarLog(4,results[0]._id,
0,"Inicio de session NIVEL 1");sessionService.set("SERVICIOS",results[0].dtspsl_acepta_servicios);$rootScope.stiporol=sessionService.get("US_IDROL");$location.path("dashboard")}else{$.unblockUI();var sMensaje="por primera y \u00fanica vez,";sweet.show("","Estimado usuario. Active su cuenta aproxim\u00e1ndose "+sMensaje+" a la plataforma m\u00e1s cercana, donde validar\u00e1n sus datos y activar\u00e1n su cuenta. Otorg\u00e1ndole acceso a los servicios en l\u00ednea del GAMLP.","error")}}}else window.location.href=
"../autenticacion/partials/login_.html";$scope.obtenerFecha();$scope.obtenerHora()}};$scope.logout=function(){document.getElementById("dvContenidoView").style.display="none";registroLog.almacenarLog(4,sessionService.get("IDUSUARIO"),0,"Cierre de sesi\u00f3n");sessionService.destroy("USER");sessionService.destroy("IDUSUARIO");sessionService.destroy("USUARIO");sessionService.destroy("US_IDROL");sessionService.destroy("US_ROL");sessionService.destroy("US_NOMBRE");sessionService.destroy("US_PATERNO");
sessionService.destroy("US_MATERNO");sessionService.destroy("IDCIUDADANO");sessionService.destroy("CICIUDADANO");sessionService.destroy("NITCIUDADANO");sessionService.destroy("IDSOLICITANTE");sessionService.destroy("US_EMAIL");sessionService.destroy("SERVICIOS");sessionService.destroy("TIPO_PERSONA");sessionService.destroy("TOKEN");sessionService.destroy("TOKEN_MOTOR");sessionService.destroy("TOKEN_MOTORA");sessionService.destroy("urliniciomoduloigob");document.getElementById("menuIzqui").style.display=
"none";document.getElementById("menuIzqui2").style.display="none";sessionStorage.removeItem("autenticacion");sessionService.destroy("SERVICIOS_MODAL");window.location.href="../autenticacion/partials/login_.html"};$scope.registroCiudadano=function(customer){};$scope.verServicios=function(){$scope.opciones=null;$scope.servicios="visible"};$scope.verParticipacion=function(){$scope.opciones=null;$scope.servicios=null;$scope.participacionCiudadana="visible"};$scope.volverOpciones=function(){$scope.servicios=
null;$scope.opciones="visible"};$scope.volverParticipacion=function(){$scope.participacionCiudadana=null;$scope.opciones="visible"};$scope.envioMensaje=function(mensajeCorreo,mensajeAlerta,ciudadano,email){var sMensajeValidacion=mensajeCorreo.replace(/ /g,"_");var parametros={"cuerpo":sMensajeValidacion,"asunto":vAsunto,"para":email,"ciudadano":ciudadano,"mensaje":vMensaje};$.ajax({data:parametros,url:"http://gmlpsr0179:9090/smsemail/email/mail.php",type:"get",beforeSend:function(){},success:function(response){}});
sweet.show("",mensajeAlerta,"success")};$scope.restaurarPin2=function(prsCI,prsCorreo){sNumeroAleatorio=Math.round(Math.random()*1E5)+prsCI;var filtro="";filtro="dtspsl_ci='"+prsCI+"' and dtspsl_correo='"+prsCorreo+"'";var misDatos={"table_name":"ciudadanos","body":{"filter":filtro}};$.blockUI();$.unblockUI();document.getElementById("prsCI").value="";document.getElementById("prsCorreo").value=""};$scope.inicioCapcha=function(){$scope.getCaptchasX()};$scope.obtenerFecha=function(){var sfecha="";try{var fechaactualn=
new fechaHoraServer;fechaactualn.fechahora(function(resultado){sfecha=JSON.parse(resultado).success.fecha;$rootScope.fechaServer=sfecha});var sfechafinal="";if(sfecha!=null&&sfecha!=""){var snuevafecha="";var nrof=0;try{nrof=sfecha.split("/").length}catch(e){}if(nrof>1){var dateString=sfecha;var dateParts=sfecha.split("/");snuevafecha=new Date(dateParts[2],dateParts[1]-1,dateParts[0])}else snuevafecha=new Date(sfecha);var messnuevafecha="";var diasnuevafecha="";if(snuevafecha!="Invalid Date"){messnuevafecha=
snuevafecha.getMonth()+1;messnuevafecha=messnuevafecha<10?"0"+messnuevafecha:messnuevafecha;if(snuevafecha.getDate()<10)diasnuevafecha="0"+snuevafecha.getDate();else diasnuevafecha=snuevafecha.getDate();sfechafinal=diasnuevafecha+"/"+messnuevafecha+"/"+snuevafecha.getFullYear();$scope.anioserver=snuevafecha.getFullYear()}}else sfechafinal=sfecha;$scope.fechafinalserver=sfechafinal;return sfechafinal}catch(e){$.unblockUI()}};$scope.obtenerHora=function(){var sfecha="";var fechaactualh=new fechaHoraServer;
fechaactualh.fechahora(function(resultado){sfecha=JSON.parse(resultado).success.fecha});var sfechafinal="";if(sfecha!=null&&sfecha!=""){snuevafecha=new Date(sfecha);var shora="";var sminuto="";var ssegundo="";shora=snuevafecha.getHours();sminuto=snuevafecha.getMinutes();ssegundo=snuevafecha.getSeconds();sfechafinal=shora+":"+sminuto+":"+ssegundo}else sfechafinal=sfecha;$scope.horafinal=sfechafinal;return sfechafinal};$scope.generarDocumentoPhp=function(){$.blockUI();var tipoPersona="";var oidCiudadano=
"";var datosCiudadano="";var datosci="";var datosexpedido="";var dEmpresa="";var dnit="";tipoPersona=sessionService.get("TIPO_PERSONA");if(tipoPersona=="NATURAL"){oidCiudadano=sessionService.get("IDSOLICITANTE");datosCiudadano=sessionService.get("US_NOMBRE")+" "+sessionService.get("US_PATERNO")+" "+sessionService.get("US_MATERNO");datosci=sessionService.get("CICIUDADANO");datosexpedido=sessionService.get("CIEXPEDIDO");$.ajax({url:CONFIG.API_URL_DMS_2+"elaborarPdf/elaborar/elaborarDocPdf.php",type:"post",
data:{"soid":oidCiudadano,"sorigen":"IGOB24/7","stipo":tipoPersona,"usuario":datosCiudadano,"cedula":datosci,"expedido":datosexpedido,"empresa":"","nit":"","fecha":$scope.fechafinalserver,"hora":$scope.horafinal},success:function(response){var urlData=response;$scope.InsertarDocumentoCondicionUso(response);$.unblockUI()}})}else{oidCiudadano=sessionService.get("IDSOLICITANTE");datosCiudadano=sessionService.get("REPRESENTANTE");datosci=sessionService.get("REPRESENTANTECI");dEmpresa=sessionService.get("US_NOMBRE");
dnit=sessionService.get("NITCIUDADANO");$.ajax({url:CONFIG.API_URL_DMS_2+"elaborarPdf/elaborar/elaborarDocPdf.php",type:"post",data:{"soid":oidCiudadano,"sorigen":"IGOB24/7","stipo":tipoPersona,"usuario":datosCiudadano,"cedula":datosci,"expedido":"","empresa":dEmpresa,"nit":dnit,"fecha":$scope.fechafinalserver,"hora":$scope.horafinal},success:function(response){var urlData=response;$scope.InsertarDocumentoCondicionUso(response);$.unblockUI()}})}};$scope.InsertarDocumentoCondicionUso=function(urlData){var sDocSistema=
"IGOB247";var sDocProceso="CONDICIONES DE USO";var sDocId=1;var sDocCiNodo="CU";var sDocDatos="";var sDocUrl=urlData;var sDocVersion=1;var sDocTiempo=400;var sDocFirmaDigital=0;var sDocUsuario=sessionService.get("IDSOLICITANTE");var sDocTipoDoc="pdf";var sDocTamDoc="";var sDocNombre="CONDICIONES DE USO";var sDocTpsId=0;var sDocUrlLogica=urlData;var sDocAcceso="";var sDocTipoExt="";var sDocNroTramNexo="";var sCasoCodigo="0";var documento=new gDocumentosIgob;documento.doc_sistema=sDocSistema;documento.doc_proceso=
sDocProceso;documento.doc_id=sDocId;documento.doc_ci_nodo=sDocCiNodo;documento.doc_datos=sDocDatos;documento.doc_url=sDocUrl;documento.doc_version=sDocVersion;documento.doc_tiempo=sDocTiempo;documento.doc_firma_digital=sDocFirmaDigital;documento.doc_usuario=sDocUsuario;documento.doc_tipo_documento=sDocTipoDoc;documento.doc_tamanio_documento=sDocTamDoc;documento.doc_nombre=sDocNombre;documento.doc_tps_doc_id=sDocTpsId;documento.doc_url_logica=sDocUrlLogica;documento.doc_acceso=sDocAcceso;documento.doc_tipo_documento_ext=
sDocTipoExt;documento.doc_nrotramite_nexo=sDocNroTramNexo;documento.doc_id_codigo=sCasoCodigo;documento.insertarDocIgob(function(resultado){resultadoApi=JSON.parse(resultado);if(resultadoApi.success){srespuesta="TRUE";var nomArchivo=urlData.split("?")[0];var nomArchivo2=nomArchivo.split("/");var nombreArchivo=nomArchivo2[nomArchivo2.length-1];var datosCondicionUso=new guardarCondicionUso;datosCondicionUso.nombreCU=nombreArchivo;datosCondicionUso.oid=sDocUsuario;datosCondicionUso.guardarCondicion_deUso(function(resultado){var resultadoApi=
JSON.parse(resultado);if(typeof resultadoApi.success!="undefined"){var mensajeExito="Condici\u00f3n de Uso almacenada correctamente.";alertify.success(mensajeExito)}else{var mensajeExito=resultadoApi.error.message;alertify.warning("",mensajeExito,"error")}});return srespuesta}else{$.unblockUI();sweet.show(resultadoApi.error.message);srespuesta="FALSE";return srespuesta}})};$scope.InsertarDocumento=function(urlData){var sDocSistema="IGOB247";var sDocProceso="DECLARACION JURADA";var sDocId=1;var sDocCiNodo=
"CU";var sDocDatos="";var sDocUrl=urlData;var sDocVersion=1;var sDocTiempo=400;var sDocFirmaDigital=0;var sDocUsuario=sessionService.get("IDSOLICITANTE");var sDocTipoDoc="pdf";var sDocTamDoc="";var sDocNombre="DECLARACION JURADA";var sDocTpsId=0;var sDocUrlLogica=urlData;var sDocAcceso="";var sDocTipoExt="";var sDocNroTramNexo="";var sCasoCodigo="0";var documento=new gDocumentosIgob;documento.doc_sistema=sDocSistema;documento.doc_proceso=sDocProceso;documento.doc_id=sDocId;documento.doc_ci_nodo=sDocCiNodo;
documento.doc_datos=sDocDatos;documento.doc_url=sDocUrl;documento.doc_version=sDocVersion;documento.doc_tiempo=sDocTiempo;documento.doc_firma_digital=sDocFirmaDigital;documento.doc_usuario=sDocUsuario;documento.doc_tipo_documento=sDocTipoDoc;documento.doc_tamanio_documento=sDocTamDoc;documento.doc_nombre=sDocNombre;documento.doc_tps_doc_id=sDocTpsId;documento.doc_url_logica=sDocUrlLogica;documento.doc_acceso=sDocAcceso;documento.doc_tipo_documento_ext=sDocTipoExt;documento.doc_nrotramite_nexo=sDocNroTramNexo;
documento.doc_id_codigo=sCasoCodigo;documento.insertarDocIgob(function(resultado){resultadoApi=JSON.parse(resultado);if(resultadoApi.success){srespuesta="TRUE";return srespuesta}else{$.unblockUI();sweet.show(resultadoApi.error.message);srespuesta="FALSE";return srespuesta}})};$scope.cancelarCondicionesUso=function(btn){$scope.vercondicionesuso="mostrar";var stippersona=sessionService.get("TIPO_PERSONA");var susuariop="";if(stippersona=="NATURAL")susuariop=sessionService.get("US_NOMBRE");else susuariop=
sessionService.get("US_NOMBRE");var msgcondiciones="Estimad@ "+susuariop+": <br><br> Al no aceptar las condiciones uso del iGob 24/7 usted ya no podr\u00e1 acceder a los siguientes servicios: <br><br> \u2022 Seguimiento de Tr\u00e1mites y Servicios. <br> \u2022 Verificaci\u00f3n de Documentos para Autorizaci\u00f3n de Viaje. <br> \u2022 Salud - Cita M\u00e9dica. <br> \u2022 Espera en L\u00ednea en Plataformas de Atenci\u00f3n Ciudadana. <br> \u2022 Catastro en l\u00ednea (Duplicados, Actualizaciones). <br> \u2022 Territorio (Permisos de Construcci\u00f3n). <br> \u2022 Actividades Econ\u00f3micas Solicitud de Licencias de Funcionamiento. <br> \u2022 Reserva de Estacionamientos en V\u00eda P\u00fablica. <br> \u2022 Foro de acciones y propuestas ciudadanas. <br> \u2022 Reclamos y Denuncias. <br> \u2022 Pagos en L\u00ednea. <br> \u2022 Bandeja de Notificaciones. <br> \u2022 Descargas de Aplicaciones M\u00f3viles. <br> \u2022 Documentos.<br><br><br>\u00bfEst\u00e1 seguro de NO ACEPTAR estas condiciones de uso?";
$("#msgcondicionesuso").html(msgcondiciones);if($scope.btncondicionesuso_n==false){var condiciones=new rcCondicionesUso;condiciones.oid_ciudadano=sessionService.get("IDSOLICITANTE");condiciones.aceptacion="NO";condiciones.mostrarCondicionesUso(function(resp){$rootScope.aceptarcondiciones=true;if(sessionService.get("US_IDROL")=="4");$("#exampleModalCenter").modal("hide")})}$scope.btncondicionesuso_n=false;$scope.btncondicionesuso_a=true};$scope.aceptacondicionesuso="";$("#btncerrarmodal").hide();$scope.aceptarCondicionesUso=
function(){if($scope.btncondicionesuso_a==true){var tineCondicionesUso="SI";var condiciones=new rcCondicionesUso;condiciones.oid_ciudadano=sessionService.get("IDSOLICITANTE");condiciones.aceptacion="SI";condiciones.mostrarCondicionesUso(function(resp){$scope.aceptacondicionesuso="SI";sessionService.set("SERVICIOS_MODAL","SI");var stippersona=sessionService.get("TIPO_PERSONA");var susuariop="";if(stippersona=="NATURAL")susuariop=sessionService.get("US_NOMBRE");else susuariop=sessionService.get("US_NOMBRE");
var msgcondiciones="";if(sessionService.get("US_IDROL")=="4")msgcondiciones="Estimad@ "+susuariop+": <br><br> Active su cuenta aproxim\u00e1ndose por primera y \u00fanica vez, a la plataforma m\u00e1s cercana, donde validar\u00e1n sus datos y activar\u00e1n su cuenta. Otorg\u00e1ndole acceso a los servicios en l\u00ednea del GAMLP.";else msgcondiciones="Estimad@ "+susuariop+": <br><br> Gracias por aceptar las condiciones uso del iGob 24/7, Ahora usted puede acceder a todos los servicios en l\u00ednea brindados por el Gobierno Aut\u00f3nomo Municipal de La Paz.";
$("#btncondicionesuso_n").hide();$("#btncondicionesuso_a").hide();$("#btncerrarmodal").show();$("#msgcondicionesuso").html(msgcondiciones);$("#htmlcondicionesuso").hide();$scope.generarDocumentoPhp();$rootScope.sservicios="SI";sessionService.set("SERVICIOS","SI")})}else{$("#exampleModalCenter").modal("hide");$rootScope.aceptarcondiciones=false}$scope.btncondicionesuso_n=true;$scope.btncondicionesuso_a=false};$scope.sstylotexto="collapse";$scope.sstyloLetter="colapsado";$scope.txtcolapsado="+ Leer Mas";
$scope.fcolapsartexto=function(areferencia){if(areferencia=="extendido"){$scope.txtcolapsado="+ Leer Mas";$scope.sstylotexto="colapsado";$scope.sstyloLetter="colapsado"}else{$scope.txtcolapsado="- Leer Menos";$scope.sstylotexto="extendido";$scope.sstyloLetter="extendido"}};$rootScope.fmostrarCondicionesUso=function(){$("#exampleModalCenter").modal({backdrop:"static",keyboard:false});$("#msgcondicionesuso").html($scope.msgcondicionesuso)};$scope.mensaje_22="condiciones de uso ";$scope.iniciarAUTHCTRL=
function(){var fechaserver=new fechaHoraServer;fechaserver.fechahora(function(resp){var sfecha=JSON.parse(resp);var fecha=sfecha.success.fecha.split(" ")[0];var hora=sfecha.success.fecha.split(" ")[1];fecha=fecha.split("-")[2]+"/"+fecha.split("-")[1]+"/"+fecha.split("-")[0];$scope.btncondicionesuso_n=true;$scope.btncondicionesuso_a=true;setTimeout(function(){var dataLogin=JSON.parse(sessionStorage.getItem("autenticacion"));var valcondiciones=typeof dataLogin[0].dtspsl_acepta_servicios=="undefined"||
dataLogin[0].dtspsl_acepta_servicios==null?"":dataLogin[0].dtspsl_acepta_servicios;valcondiciones=valcondiciones.trim();$rootScope.aceptarcondiciones=true;var tienecondicionesuso="";var aceptacondicionesuso="";if(valcondiciones=="SI"){tienecondicionesuso="SI";aceptacondicionesuso="SI"}else if(valcondiciones=="NO"||valcondiciones==""){var svSession=typeof sessionService.get("SERVICIOS_MODAL")=="undefined"||sessionService.get("SERVICIOS_MODAL")==null?"":sessionService.get("SERVICIOS_MODAL");if(svSession==
"NO"||svSession==""||svSession=="undefined"||svSession==null){tienecondicionesuso="NO";aceptacondicionesuso=""}else if(svSession=="SI"&&sessionService.get("US_IDROL")=="5")$rootScope.stiporol=5}var stringCondicionesDeUso="";var urlcondiciones="";var snombre="";var scedulaid="";var sexpedido="";var snombreREP="";var scirep="";var sempresa="";var snit="";if(sessionService.get("TIPO_PERSONA")=="NATURAL"){urlcondiciones="../../docs/condiciones_uso_natural_1.html";snombre=sessionService.get("US_NOMBRE")+
" "+sessionService.get("US_PATERNO")+" "+sessionService.get("US_MATERNO");scedulaid=sessionService.get("CICIUDADANO");sexpedido=dataLogin[0].dtspsl_expedido}else if(sessionService.get("TIPO_PERSONA")=="JURIDICO"){urlcondiciones="../../docs/condiciones_uso_juridico_1.html";snombreREP=sessionService.get("REPRESENTANTE");snit=sessionService.get("NITCIUDADANO");sempresa=sessionService.get("US_NOMBRE");scirep=sessionService.get("REPRESENTANTECI")}$("#msgcondicionesuso").load(urlcondiciones,function(data){stringCondicionesDeUso=
data;stringCondicionesDeUso=stringCondicionesDeUso.replace("#USUARIO#",snombre);stringCondicionesDeUso=stringCondicionesDeUso.replace("#CEDULA#",scedulaid);stringCondicionesDeUso=stringCondicionesDeUso.replace("#EXPEDIDO#",sexpedido);stringCondicionesDeUso=stringCondicionesDeUso.replace("#FECHA#",fecha);stringCondicionesDeUso=stringCondicionesDeUso.replace("#HORA#",hora);stringCondicionesDeUso=stringCondicionesDeUso.replace("#REPRESENTANTE#",snombreREP);stringCondicionesDeUso=stringCondicionesDeUso.replace("#NIT#",
snit);stringCondicionesDeUso=stringCondicionesDeUso.replace("#EMPRESA#",sempresa);stringCondicionesDeUso=stringCondicionesDeUso.replace("#REPRESENTANTECI#",scirep);$scope.vercondicionesuso="mostrar";$scope.msgcondicionesuso=stringCondicionesDeUso;$scope.notifcondicionesuso=stringCondicionesDeUso;if(tienecondicionesuso=="NO")if(aceptacondicionesuso=="NO"){$scope.notifcondicionesuso=stringCondicionesDeUso;$scope.validarmodal=true}else setTimeout(function(){$rootScope.fmostrarCondicionesUso()},500);
else if(tienecondicionesuso=="SI")$rootScope.aceptarcondiciones=false});$scope.$apply()},500)})};$scope.solicitarSoporteIgob=function(){$scope.modalv=true;setTimeout(()=>{$("#mdlCambioPineee").modal({keyboard:false})},1E3)}});