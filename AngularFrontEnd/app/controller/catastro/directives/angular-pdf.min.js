(function(){"use strict";angular.module("pdf",[]).directive("ngPdf",["$window",function(e){var t=null,n=null,o=!1,a=function(e){var t=e.getContext("2d"),n=window.devicePixelRatio||1,o=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return n/o},r=function(e,t,n){console.log(e,t,n);var o=a(e);return e.width=Math.floor(t*o),e.height=Math.floor(n*o),e.style.width=Math.floor(t)+"px",e.style.height=Math.floor(n)+"px",e.getContext("2d").setTransform(o,0,0,o,0,0),e};return{restrict:"E",templateUrl:function(e,t){return t.templateUrl?t.templateUrl:"partials/viewer.html"},link:function(a,i,l){function s(){D&&D.clearRect(0,0,P.width,P.height)}function c(){s();var e={url:u,withCredentials:m};p&&(e.httpHeaders=p),u&&u.length&&(n=PDFJS.getDocument(e,null,null,a.onProgress),n.then(function(e){"function"==typeof a.onLoad&&a.onLoad(),g=e,a.renderPage(a.pageToDisplay),a.$apply(function(){a.pageCount=e.numPages})},function(e){e&&"function"==typeof a.onError&&a.onError(e)}))}i.css("display","block");var u=a.pdfUrl,p=a.httpHeaders,g=null,f=isFinite(l.page)?parseInt(l.page):1,d="page-fit"===l.scale,h=l.scale>0?l.scale:1.4,y=l.canvasid||"pdf-canvas",P=document.getElementById(y);o=!!l.hasOwnProperty("debug")&&l.debug;var m=l.usecredentials,D=P.getContext("2d"),w=angular.element(e);w.on("scroll",function(){a.$apply(function(){a.scroll=w[0].scrollY})}),PDFJS.disableWorker=!0,a.pageNum=f,a.renderPage=function(e){t&&t._internalRenderTask.cancel(),g.getPage(e).then(function(e){var n,o,l;if(d){n=e.getViewport(1);var s=i[0].getBoundingClientRect();o=s.width/n.width,h=o}n=e.getViewport(h),r(P,n.width,n.height),l={canvasContext:D,viewport:n},t=e.render(l),t.promise.then(function(){"function"==typeof a.onPageRender&&a.onPageRender()}).catch(function(e){console.log(e)})})},a.goPrevious=function(){a.pageToDisplay<=1||(a.pageToDisplay=parseInt(a.pageToDisplay)-1,a.pageNum=a.pageToDisplay)},a.goNext=function(){a.pageToDisplay>=g.numPages||(a.pageToDisplay=parseInt(a.pageToDisplay)+1,a.pageNum=a.pageToDisplay)},a.zoomIn=function(){if(h<=2.3)return d=!1,h=parseFloat(h)+.3,a.renderPage(a.pageToDisplay),h},a.zoomOut=function(){if(h>=.8)return d=!1,h=parseFloat(h)-.3,a.renderPage(a.pageToDisplay),h},a.fit=function(){d=!1,h=1.4,a.renderPage(a.pageToDisplay)},a.changePage=function(){a.renderPage(a.pageToDisplay)},a.rotate=function(){"rotate0"===P.getAttribute("class")?P.setAttribute("class","rotate90"):"rotate90"===P.getAttribute("class")?P.setAttribute("class","rotate180"):"rotate180"===P.getAttribute("class")?P.setAttribute("class","rotate270"):P.setAttribute("class","rotate0")},a.$watch("pageNum",function(e){a.pageToDisplay=parseInt(e),null!==g&&a.renderPage(a.pageToDisplay)}),a.$watch("pdfUrl",function(e){""!==e&&(o&&console.log("pdfUrl value change detected: ",a.pdfUrl),u=e,a.pageNum=a.pageToDisplay=f,n?n.destroy().then(function(){c()}):c())}),a.RefreshUrl=function(e){PDFJS.getDocument(e,null,null,a.onProgress).then(function(e){"function"==typeof a.onLoad&&a.onLoad(),g=e,a.renderPage(a.pageToDisplay),a.$apply(function(){a.pageCount=e.numPages})},function(e){e&&"function"==typeof a.onError&&a.onError(e)})}}}}])})();