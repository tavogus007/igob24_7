app.controller("serviciosEEController",function(o,e,a,t,i,r,n,s,c,d,l,u,p,_,m,I,f,v,g,E){var b=new Date,C=b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate()+" "+b.getHours()+":"+b.getMinutes()+":"+b.getSeconds();o.txtMsgConexionGen="",o.txtCiudadanoExiste="",e.looo="",e.laaa="",o.tablaTramites={},o.tramitesUsuario=[],o.servicio=9,o.startDateOpen1=function(e){e.preventDefault(),e.stopPropagation(),o.startDateOpened1=!0},o.vistas=function(e){5==e&&(o.ocultar1=!0,o.ocultar=!1),1==e&&(o.ocultar=!0,o.ocultar1=!1),1!=e&&5!=e&&(o.ocultar=!1,o.ocultar1=!1)},o.verDesaparecido=function(e){console.log("estos son los datos de esa persona",e),o.visitas=parseInt(e.EE_VISITAS)+1,e.EE_VISITAS=o.visitas,console.log("estos son los nuevos datoossss",e);var a=new visitas;a.nro_caso=e.AE_NRO_CASO,a.visitas=JSON.stringify(e),console.log("estos son los parametros",a),a.agregarVisitas(function(e){resultadoApi=JSON.parse(e),console.log(resultadoApi),console.log("resultado....:",o.extraviados)}),o.nombre=e.EE_APELLIDO_P+" "+e.EE_APELLIDO_M+" "+e.EE_NOMBRE,o.nombre_den=e.EE_AP_DENUN+" "+e.EE_AM_DENUN+" "+e.EE_NOMBRE_DENUN,console.log(o.nombre),console.log(e.EE_OJOS_FORMA_VALOR),document.getElementById("vnombre1").value=o.nombre,document.getElementById("vtelefono").value=e.EE_TELF,document.getElementById("vfecha_extravio").value=e.EE_FECHA,document.getElementById("vcaso").value=e.EE_CASO,document.getElementById("vgenero").value=e.EE_GENERO_VALOR,document.getElementById("vestimenta").value=e.EE_VESTIMENTA,document.getElementById("hechos").value=e.EE_DESC_HECHOS,document.getElementById("denunciante").value=o.nombre_den,document.getElementById("parentesco").value=e.EE_PARENTESCO_VALOR,document.getElementById("tatuajes").value=e.EE_TATUAJES_DESC,document.getElementById("lunares").value=e.EE_LUNARES_DESC,document.getElementById("cicatrices").value=e.EE_CICATRICES_DESC,document.getElementById("color_ojos").value=e.EE_OJOS_COLOR_VALOR,document.getElementById("forma_ojos").value=e.EE_OJOS_FORMA_VALOR,document.getElementById("color_cabello").value=e.EE_COLOR_CABELLO_VALOR,document.getElementById("tam_cabello").value=e.EE_TAMAÑO_CABELLO_VALOR,document.getElementById("imagen_perdido").src=e.EE_IMG},o.lstExtraviados=function(){var e=new Extraviado;e.lstExtraviados(function(e){resultadoApi=JSON.parse(e),console.log(resultadoApi),o.extraviados=resultadoApi.data,console.log("resultado....:",o.extraviados)})},o.busqueda_Extraviado=function(e,a,t){console.log("este es el valor1",e),console.log("este es el valor2",a);var i=t,r=new Date(i),n=r.getMonth()+1,s=r.getDate();r.getDate()<10&&(s="0"+s),r.getMonth()<9&&(n="0"+n);o.fechaal=r.getFullYear()+"-"+n+"-"+s,console.log("************1",o.fechaal),console.log("este es el valor3",o.fechaal);var c=new Extraviado;c.ta=e,c.nombre=a,c.fec=o.fechaal,c.buscarExtraviado(function(e){resultadoApi=JSON.parse(e),console.log(resultadoApi),o.extraviados=resultadoApi.data,console.log("resultado....:",o.extraviados)})};n.get("US_IDROL");o.parentescos=0,o.templates=[{name:"template7.html",url:"../../../app/view/servicios/obito/index.html"}],o.serivicosInternet=[{name:"Solicitud de Certificado de Óbito",id:"9"}],o.seleccionarProceso=function(e){o.procesoSeleccionado=e.id,o.btnNuevoTramtite=!1},o.limpiarFormTramite=function(){o.procesoSeleccionado="",o.btnNuevoTramtite=!0,o.getCaptchasX()},o.seleccionarProceso=function(e){o.procesoSeleccionado=e.id,o.btnNuevoTramtite=!1},o.crearTramiteObito=function(){if(o.serivicosInternet){var e=o.serivicosInternet[0].id;o.adicionarServicioGamlp(e)}},o.loginPagoEnLinea=function(){var o=new gLogin;o.login(function(o){})},o.selParentesco=function(a){a=parseInt(a),e.parentescos=a,19==a?(console.log(a,"parentescos iiiff"),e.archivoDivCI=!1,e.archivoDivOJ=!0):(console.log(a,"parentescos else"),e.archivoDivCI=!0,e.archivoDivOJ=!1,console.log(o.datos.FILE_FOTOCOPIA_CI),o.datos.FILE_FOTOCOPIA_CI?console.log("lleno"):(console.log("vacio",o.datosIniciales.file_fotocopi_ci),o.datos.FILE_FOTOCOPIA_CI=o.datosIniciales.file_fotocopi_ci))},o.subirSesionFum=function(o){console.log(e.email),""!=e.email?(n.set("IDFUM",o),window.location.href="#servicios|epagos"):u.show("","En pago en línea es obligatorio el correo electrónico","error")},o.imprimirProforma=function(o){window.open("http://obito.lapaz.bo/wsProforma/proforma.asmx/obtenerProforma?idFum="+o,"_blank")},o.verConcepto=function(e){console.log(e.contenidofum),o.datosPago=JSON.parse(e.contenidofum),o.conceptoIdFum=o.datosPago[0].idFum,o.conceptoItemRecaudador=o.datosPago[0].idItemRecaudador,o.conceptoCabecera=o.datosPago[0].cabecera,o.conceptoFechaRegistro=o.datosPago[0].fechaRegistro,o.conceptoDescripcion=o.datosPago[0].descripcion,o.conceptoTotalGeneral=o.datosPago[0].AcctotalGeneral,o.conceptoTotalParcial=o.datosPago[0].AcctotalParcial,o.conceptoDetalle=o.datosPago[0].detalle,o.conceptoDetalleA=o.datosPago[0].detalleA,o.conceptoDetalleB=o.datosPago[0].detalleB,o.conceptoDetalleC=o.datosPago[0].detalleC,o.conceptoDetalleD=o.datosPago[0].detalleD,o.conceptoIdentificacion=o.datosPago[0].identificacion,o.conceptoNombre=o.datosPago[0].nombre},o.obtDatosFallecido=function(e){o.todo=JSON.parse(e.contenidofum),o.dtFallecidoNroProforma=e.vnroproforma,o.dtFallecidoNombre=o.todo[0].nombre+" "+o.todo[0].paterno+" "+o.todo[0].materno,o.dtFallecidoEdad=o.todo[0].edad,o.dtFallecidoEstado=o.todo[0].nestado_civil,o.dtFallecidoFecha=o.todo[0].nfechamuerte,o.dtFallecidoCausa=o.todo[0].ncausamuerte,o.dtFallecidoNacionalidad=o.todo[0].nnacionalidad,o.dtFallecidoCarpeta=o.todo[0].nlibro,o.dtFallecidoFolio=o.todo[0].nfolio},o.refrescar=function(){o.tramitesCiudadano()},o.mostrarimg=function(){if($.blockUI(),19==e.parentescos){var a="",t=o.datos.FILE_ORDEN_JUDICIAL.split(":");a=void 0!=t[1]?o.datos.FILE_ORDEN_JUDICIAL.substring(12):o.datos.FILE_ORDEN_JUDICIAL,o.archivoOrdenJ=s.APIURL+"/files/RC_CLI/"+n.get("IDSOLICITANTE")+"/"+a+"?app_name=todoangular"}else{var a="",t=o.datos.FILE_FOTOCOPIA_CI.split(":");a=void 0!=t[1]?o.datos.FILE_FOTOCOPIA_CI.substring(12):o.datos.FILE_FOTOCOPIA_CI,o.archivoCI=s.APIURL+"/files/RC_CLI/"+n.get("IDSOLICITANTE")+"/"+a+"?app_name=todoangular"}$.unblockUI()},o.limpiarFormTramite=function(){o.procesoSeleccionado="",o.btnNuevoTramtite=!0},o.template="";var A=new Array;o.recuperandoDatosInicialesCiudadano=function(){o.datosIniciales="";var a={},t=n.get("IDUSUARIO"),i=new rcNatural;if(i.oid=t,i.datosCiudadanoNatural(function(o){datos=JSON.parse(o)}),console.log(datos[0]),datos[0].dtspsl_ci)a.ci_bigdata=datos[0]._id,a.fec_solicitud=C,a.solicitante=datos[0].dtspsl_nombres+" "+datos[0].dtspsl_paterno+" "+datos[0].dtspsl_materno,a.nombres_t=datos[0].dtspsl_nombres,a.primer_apellido_t=datos[0].dtspsl_paterno,a.segundo_apellido_t=datos[0].dtspsl_materno,a.carnet_t=datos[0].dtspsl_ci,"LPZ"==datos[0].dtspsl_expedido&&(a.ci_expedido_t="LP"),"CBB"==datos[0].dtspsl_expedido&&(a.ci_expedido_t="CO"),"SCZ"==datos[0].dtspsl_expedido&&(a.ci_expedido_t="SC"),"CHQ"==datos[0].dtspsl_expedido&&(a.ci_expedido_t="CH"),"TJA"==datos[0].dtspsl_expedido&&(a.ci_expedido_t="TA"),"PTS"==datos[0].dtspsl_expedido&&(a.ci_expedido_t="PO"),"ORU"==datos[0].dtspsl_expedido&&(a.ci_expedido_t="OR"),"BNI"==datos[0].dtspsl_expedido&&(a.ci_expedido_t="BN"),"PND"==datos[0].dtspsl_expedido&&(a.ci_expedido_t="PA"),a.parentesco="",a.motivo="",a.titular_zona=datos[0].dtspsl_zona_desc,a.titular_nro=datos[0].dtspsl_numero_casa,a.tipo_via=datos[0].dtspsl_tipo_via,a.titular_via=datos[0].dtspsl_nombre_via,a.titular_fono=datos[0].dtspsl_telefono,a.titular_correo=datos[0].dtspsl_correo,e.email=datos[0].dtspsl_correo,a.nombre="",a.paterno="",a.materno="",a.apellido_casada="",a.ci_fallecido="",a.fecha1="",a.fecha2="",a.file_fotocopi_ci=datos[0].dtspsl_file_fotocopia_ci,o.datosIniciales=a;else if(datos[0].dtspsl_ci_representante){ci2=datos[0].dtspsl_ci_representante;var r=new rcNatural;r.ci=ci2,r.buscarNatural(function(o){datosJ=JSON.parse(o)}),a.ci_bigdata=datosJ[0]._id,a.fec_solicitud=C,a.solicitante=datosJ[0].dtspsl_nombres+" "+datosJ[0].dtspsl_paterno+" "+datosJ[0].dtspsl_materno,a.nombres_t=datosJ[0].dtspsl_nombres,a.primer_apellido_t=datosJ[0].dtspsl_paterno,a.segundo_apellido_t=datosJ[0].dtspsl_materno,a.carnet_t=datosJ[0].dtspsl_ci,"LPZ"==datosJ[0].dtspsl_expedido&&(a.ci_expedido_t="LP"),"CBB"==datosJ[0].dtspsl_expedido&&(a.ci_expedido_t="CO"),"SCZ"==datosJ[0].dtspsl_expedido&&(a.ci_expedido_t="SC"),"CHQ"==datosJ[0].dtspsl_expedido&&(a.ci_expedido_t="CH"),"TJA"==datosJ[0].dtspsl_expedido&&(a.ci_expedido_t="TA"),"PTS"==datosJ[0].dtspsl_expedido&&(a.ci_expedido_t="PO"),"ORU"==datosJ[0].dtspsl_expedido&&(a.ci_expedido_t="OR"),"BNI"==datosJ[0].dtspsl_expedido&&(a.ci_expedido_t="BN"),"PND"==datosJ[0].dtspsl_expedido&&(a.ci_expedido_t="PA"),a.parentesco="",a.motivo="",a.titular_zona=datosJ[0].dtspsl_zona_desc,a.titular_nro=datosJ[0].dtspsl_numero_casa,a.tipo_via=datosJ[0].dtspsl_tipo_via,a.titular_via=datosJ[0].dtspsl_nombre_via,a.titular_fono=datosJ[0].dtspsl_telefono,a.titular_correo=datosJ[0].dtspsl_correo,a.nombre="",a.paterno="",a.materno="",a.apellido_casada="",a.ci_fallecido="",a.fecha1="",a.fecha2="",a.FILE_FOTOCOPIA_CI="",o.datosIniciales=a}else u.show("","error en identificador de ciudadano","error")},o.actualizarFumsPagados=function(e,a){var t={idfum:a},i=n.get("TOKEN"),r='Bearer <\\"'+i+'\\">';$.ajax({async:!0,type:"POST",url:"https://pagonline.lapaz.bo/api/comprobante",data:t,dataType:"json",crossDomain:!0,headers:{"cache-control":"no-cache"},headers:{authorization:r},success:function(a){a.Resultado[0].idFum&&o.actualizarDatos(e,JSON.stringify(a.Resultado[0]))}})},o.actualizarDatos=function(o,e){var a={procedure_name:"upd_fum_tramites",body:{params:[{name:"tramite_id",value:o},{name:"fum",value:e}]}},t=d.api[s.SERVICE].callStoredProcWithParams(a);t.success(function(o){}).error(function(o){})},o.tramitesCiudadano=function(){sIdCiudadano=n.get("IDSOLICITANTE");var e={procedure_name:"spbusquedaformulario2",body:{params:[{name:"sidciudadano",value:sIdCiudadano}]}};d.api[s.SERVICE].callStoredProcWithParams(e).success(function(e){angular.forEach(e,function(a,t){var i,r;a.form_contenido&&(e[t].datos=JSON.parse(a.form_contenido)),i=a.vnroproforma,r=a.vtra_id,i&&o.actualizarFumsPagados(r,i)}),o.tramitesUsuario=e;o.tablaTramites.reload()}).error(function(o){alert("error al cargar")})},o.tablaTramites=new p({page:1,count:4,filter:{},sorting:{vtra_id:"desc"}},{total:o.tramitesUsuario.length,getData:function(e,a){var t=a.filter()?_("filter")(o.tramitesUsuario,a.filter()):o.tramitesUsuario,i=a.sorting()?_("orderBy")(t,a.orderBy()):o.tramitesUsuario;a.total(o.tramitesUsuario.length),e.resolve(i.slice((a.page()-1)*a.count(),a.page()*a.count()))}}),o.tramitesObservaciones=function(e,a){o.observaciones="mostrar";var t=n.get("IDSOLICITANTE"),i={procedure_name:"spbusquedaformulario",body:{params:[{name:"sidciudadano",value:t}]}};d.api[s.SERVICE].callStoredProcWithParams(i).success(function(e){o.noticias=e;o.tablaNoticias=new p({page:1,count:4,filter:{},sorting:{}},{total:o.noticias.length,getData:function(e,a){var t=a.filter()?_("filter")(o.noticias,a.filter()):o.noticias,i=a.sorting()?_("orderBy")(t,a.orderBy()):o.noticias;a.total(i.length),e.resolve(i.slice((a.page()-1)*a.count(),a.page()*a.count()))}})}).error(function(o){alert("error al cargar")})},o.iniciandoDatos=function(){console.log("DATOS INICIALES",o.datosIniciales);var a=o.datosIniciales,t=g.obtenerFechaActual();o.datos={};var i={};i.ci_bigdata=a.ci_bigdata,i.fec_solicitud=t,i.solicitante=a.solicitante,i.nombres_t=a.nombres_t,i.primer_apellido_t=a.primer_apellido_t,i.segundo_apellido_t=a.segundo_apellido_t,i.carnet_t=a.carnet_t,i.ci_expedido_t=a.ci_expedido_t,i.parentesco=a.parentesco,i.motivo=a.motivo,i.titular_zona=a.titular_zona,i.titular_nro=a.titular_nro,i.tipo_via=a.tipo_via,i.titular_via=a.titular_via,i.titular_fono=a.titular_fono,i.titular_correo=a.titular_correo,e.email=a.titular_correo,i.nombre=a.nombre,i.paterno=a.paterno,i.materno=a.materno,i.apellido_casada=a.apellido_casada,i.ci_fallecido=a.ci_fallecido,i.fecha1=a.fecha1,i.fecha2=a.fecha2,o.datos=i,a.titular_zona?o.validacionDireccion=!1:(o.validacionDireccion=!0,u.show("Complete información","Datos de dirección son obligatorios debe completar la información de su cuenta","error"))},o.recuperarSerializarInfo=function(a){var t=a.vtra_id,i=n.get("IDSOLICITANTE"),r=n.get("IDSERVICIO");if(i){var c={procedure_name:"splistafrmdatos",body:{params:[{name:"sidciudadano",value:i},{name:"sidservicio",value:r},{name:"sidtramite",value:t}]}};d.api[s.SERVICE].callStoredProcWithParams(c).success(function(i){i.length>0?(datos=JSON.parse(i[0].form_contenido),o.adjuntosArray=datos.ARCHIVOS_MULTIPLES,o.datos=datos,o.publicid=[],o.publicid=o.datos.publicidad,e.looo=o.datos.INT_AC_latitud,e.laaa=o.datos.INT_AC_longitud,o.selParentesco(o.datos.parentesco),o.nroRegistros=datos.length):(console.log(o.datos),e.archivoDivCI=!1,e.archivoDivOJ=!1,o.nroRegistros=0,o.datos="",o.adjuntosArray="",o.iniciandoDatos(),n.set("IDTRAMITE",t)),"SI"==a.venviado?(o.btnGuardarForm=!0,o.desabilitado=!0,o.botones=null,o.cibloq=null):(o.btnGuardarForm=!1,o.desabilitado=!1,o.botones="mostrar",o.cibloq="mo"),e.$broadcast("validarBtnEnviar",i.length),e.$broadcast("inicializarCamposInternet",o.datos),e.$broadcast("inicializarGrillaAE",[{datos:o.datos,venviado:a.venviado}]),e.$broadcast("inicializarFechaOblitatorio",o.datos)}).error(function(o){})}else alert("NO existe id ciudadano")},o.bloquearBtnEnviarForm=function(){o.botones=null},o.almacenarGDocumental=function(o,e){var a="",t="",i=o.name,r={};r.doc_sistema="RC_CLI",r.doc_proceso="ADJUNTO",r.doc_ci_nodo="DMS",r.doc_datos=a,r.doc_version="1",r.doc_tiempo="0",r.doc_firma_digital=0,r.doc_acceso="",r.doc_tipo_documento="pdf",r.doc_tamanio_documento="0",r.doc_tps_doc_id="1",r.doc_tipo_documentacion="U",r.doc_tipo_ingreso="I",r.doc_estado_de_envio="N",r.doc_correlativo="",r.doc_tipo_documento_ext="",r.doc_nrotramite_nexo="",r.doc_id_carpeta="",r.doc_registro=C,r.doc_modificacion=C,r.doc_usuario=n.get("USUARIO"),r.doc_estado="A",r.doc_url=e,r.doc_url_logica=t,r.doc_nombre=i},o.almacenarDocumentos=function(a){console.log(a);var t=n.get("IDSOLICITANTE");o.direccionvirtual="RC_CLI";var i=s.APIURL+"/files/"+o.direccionvirtual+"/"+t+"/";a[0]&&(a[0].size<=3145728?(v.uploadFileToUrl(a,i),19==e.parentescos?o.datos.FILE_ORDEN_JUDICIAL=a[0].name:o.datos.FILE_FOTOCOPIA_CI=a[0].name,o.Advertencia1="ok"):(u.show("Advertencia","El tamaño de la imagen CEDULA DE IDENTIDAD es muy grande","error"),o.Advertencia1="advertencia",a[0].name="",document.getElementById("FILE_FOTOCOPIA_CI").value="",document.getElementById("FILE_ORDEN_JUDICIAL").value="")),angular.forEach(a,function(o,e){"undefined"!=typeof o?v.uploadFileToUrl(o,i):console.log("error en el archivo")})},o.serializarInformacionViajes=function(a){var t=(g.obtenerFechaActual(),new Array);console.log("el obj   ",a),t.push(o.FILE_FOTOCOPIA_CI),t.push(o.FILE_FACTURA_SERVICIO),t.push(o.FILE_CROQUIS_AMBIENTE),t.push(o.FILE_CERTIFICADO_PENAL);var i=JSON.stringify(a),r=n.get("IDSOLICITANTE"),c=n.get("IDTRAMITE"),l=n.get("IDSERVICIO"),p={procedure_name:"sp_crear_datos_formulario",body:{params:[{name:"id_servicio",value:l},{name:"data_json",value:i},{name:"oid_ciudadano",value:r},{name:"id_usuario",value:1},{name:"id_trm_form",value:c}]}};o.btnGuardarForm=!0,$.blockUI(),d.api[s.SERVICE].callStoredProcWithParams(p).success(function(a){a.length>0?($.unblockUI(),o.btnEnviarForm=!1,o.btnGuardarForm=!1,e.$broadcast("inicializarFechaOblitatorio",o.datos),u.show("","Formulario almacenado","success")):($.unblockUI(),u.show("","Formulario no almacenado","error"))}).error(function(e){o.btnGuardarForm=!1,$.unblockUI()})},o.cambiarFile=function(a,t){$.blockUI(),setTimeout(function(){var a=new Array;19==e.parentescos?(o.FILE_ORDEN_JUDICIAL=o.FILE_ORDEN_JUDICIAL,document.getElementById("FILE_ORDEN_JUDICIAL").value=t,a.push(o.FILE_ORDEN_JUDICIAL)):(o.FILE_FOTOCOPIA_CI=o.FILE_FOTOCOPIA_CI,document.getElementById("FILE_FOTOCOPIA_CI").value=t,a.push(o.FILE_FOTOCOPIA_CI));s.APIURL+"/files/RC_CLI/"+n.get("IDCIUDADANO")+"/";o.almacenarDocumentos(a),$.unblockUI()},1e3)},o.serializarInformacion=function(a){console.log("DATOS OBJ:",a);var t=(g.obtenerFechaActual(),new Array);a.solicitante="undefined"==typeof a.solicitante||null==a.solicitante?"":a.solicitante.toUpperCase(),a.nombres_t="undefined"==typeof a.nombres_t||null==a.nombres_t?"":a.nombres_t.toUpperCase(),a.primer_apellido_t="undefined"==typeof a.primer_apellido_t||null==a.primer_apellido_t?"":a.primer_apellido_t.toUpperCase(),a.segundo_apellido_t="undefined"==typeof a.segundo_apellido_t||null==a.segundo_apellido_t?"":a.segundo_apellido_t.toUpperCase(),a.titular_zona="undefined"==typeof a.titular_zona||null==a.titular_zona?"":a.titular_zona.toUpperCase(),a.titular_via="undefined"==typeof a.titular_via||null==a.titular_via?"":a.titular_via.toUpperCase(),a.nombre="undefined"==typeof a.nombre||null==a.nombre?"":a.nombre.toUpperCase(),a.paterno="undefined"==typeof a.paterno||null==a.paterno?"":a.paterno.toUpperCase(),a.materno="undefined"==typeof a.materno||null==a.materno?"":a.materno.toUpperCase(),a.apellido_casada="undefined"==typeof a.apellido_casada||null==a.apellido_casada?"":a.apellido_casada.toUpperCase(),a.idTramite=n.get("IDTRAMITE"),19==e.parentescos?t.push(o.FILE_ORDEN_JUDICIAL):t.push(o.FILE_FOTOCOPIA_CI),o.almacenarDocumentos(t);var i=JSON.stringify(a),r=n.get("IDSOLICITANTE"),c=n.get("IDTRAMITE"),l=n.get("IDSERVICIO"),p={procedure_name:"sp_crear_datos_formulario",body:{params:[{name:"id_servicio",value:l},{name:"data_json",value:i},{name:"oid_ciudadano",value:r},{name:"id_usuario",value:1},{name:"id_trm_form",value:c}]}};o.btnGuardarForm=!0,$.blockUI(),d.api[s.SERVICE].callStoredProcWithParams(p).success(function(a){a.length>0?($.unblockUI(),o.btnEnviarForm=!1,o.btnGuardarForm=!1,e.$broadcast("inicializarFechaOblitatorio",o.datos),u.show("","Formulario almacenado","success")):($.unblockUI(),u.show("","Formulario no almacenado","error"))}).error(function(e){o.btnGuardarForm=!1,$.unblockUI()})},o.enviarInformacion=function(e){var a=n.get("IDTRAMITE");idUsuario=n.get("IDUSUARIO");var t={table_name:"_formulario_tramites",body:{frm_tra_enviado:"SI",frm_tra_id_usuario:idUsuario,frm_tra_modificado:C},id:a},e=d.api[s.SERVICE].updateRecord(t);e.success(function(e){u.show("","Formulario enviado al G.A.M.L.P.","success"),o.tramitesCiudadano(),o.desabilitado=!0}),e.error(function(o){u.show("","Registro no modificado","error")})},o.adicionarServicioGamlp=function(e){var a=new Date,t=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds(),i=e,r=n.get("IDSOLICITANTE"),c=t,l={};l={frm_tra_dvser_id:i,frm_tra_id_ciudadano:r,frm_tra_fecha:c,frm_tra_enviado:"NO",frm_tra_registrado:t,frm_tra_modificado:t,frm_tra_id_usuario:"3"};var p={table_name:"_formulario_tramites",body:l},_=d.api[s.SERVICE].createRecords(p);$.blockUI(),_.success(function(e){o.tramitesCiudadano(),$.unblockUI(),u.show("","Registro almacenado correctamente","success"),$("#registro").modal("hide"),o.getCaptchasX()}).error(function(o){$.unblockUI()})},o.confirmarServicioGamlp=function(e){console.log(e),""!=o.procesoSeleccionado&&o.adicionarServicioGamlp(o.procesoSeleccionado)},e.TipoAutorizacion1=function(e){if("1-F"==e)var a="../catastro/img/caso1.png";if("2-F"==e)var a="../catastro/img/caso2.png";if("3-F"==e)var a="../catastro/img/caso3.png";if("4-F"==e)var a="../catastro/img/caso4.png";if("5-D"==e)var a="../catastro/img/caso5.png";o.ooooo=a},o.ErrorCapcha="",o.getlimpiareRROR=function(){o.ErrorCapcha=""},o.getCaptchasX=function(){var e=new captcha;e.obtcaptcha(function(e){json=JSON.parse(e),partes=json.success[0].sp_captcha_porx1.split(","),numero=partes[0].substring(1),i1=partes[2]+","+partes[3],i2=partes[4]+","+partes[5],o.imageLNG=i1.substring(1,i1.length-1),o.imageCST=i2.substring(1,i2.length-2);var a="";"A"==partes[1]?a="AYMARA":"Q"==partes[1]?a="QUECHUA":"G"==partes[1]?a="GUARANI":"C"==partes[1]?a="CASTELLANO":console.log("error",partes[1]),o.toltipTt="Palabra en "+a,o.palabraT="Ingrese texto: "+a+" CASTELLANO"})},o.getCaptchasXX=function(){var e=new captcha;e.obtcaptcha(function(e){json=JSON.parse(e),partes=json.success[0].sp_captcha_porx1.split(","),numero=partes[0].substring(1),i1=partes[2]+","+partes[3],i2=partes[4]+","+partes[5];var a="";"A"==partes[1]?a="AYMARA":"Q"==partes[1]?a="QUECHUA":"G"==partes[1]?a="GUARANI":"C"==partes[1]?a="CASTELLANO":console.log("error",partes[1]),null!=document.getElementById("imageLNG")?(document.getElementById("imageLNG").src=i1.substring(1,i1.length-1),document.getElementById("imageCST").src=i2.substring(1,i2.length-2),document.getElementById("palabraT").value="Ingrese texto: "+a+" CASTELLANO"):(o.imageLNG=i1.substring(1,i1.length-1),o.imageCST=i2.substring(1,i2.length-2)),o.toltipTt="Palabra en "+a,o.palabraT="Ingrese texto: "+a+" CASTELLANO"})},o.VerificarCapcha=function(e){var a=$("#resultadoC").val();console.log(a,numero),console.log("===>>",a);var t=numero,i=new captcha;i.identificador=t,i.respuesta=a,i.verificarCaptcha(function(a){json=JSON.parse(a),console.log(json),void 0==json.success[0]?(o.getCaptchasX(),document.getElementById("resultadoCC").value="",o.ErrorCapcha="Error en el captcha intentar de nuevo por favor"):(o.confirmarServicioGamlp(e),o.ErrorCapcha="")})},o.VerificarCapchaa=function(e){var a=$("#resultadoCC").val();console.log(a,numero);var t=numero,i=new captcha;i.identificador=t,i.respuesta=a,i.verificarCaptcha(function(a){json=JSON.parse(a),console.log(json),void 0==json.success[0]?(o.getCaptchasXX(),o.ErrorCapcha="Error en el captcha intentar de nuevo por favor"):(o.serializarInformacion(e),o.ErrorCapcha="")})},o.$on("api:ready",function(){o.lstExtraviados()}),o.inicioServicios=function(){d.api[s.SERVICE]&&o.lstExtraviados()},o.recuperarSerializarInfomacion=function(a){setTimeout(function(){var t=a.vtra_id,i=n.get("IDSOLICITANTE"),r=n.get("IDSERVICIO");if(i){var c={procedure_name:"splistafrmdatos",body:{params:[{name:"sidciudadano",value:i},{name:"sidservicio",value:r},{name:"sidtramite",value:t}]}};d.api[s.SERVICE].callStoredProcWithParams(c).success(function(i){if(i.length>0){var r=JSON.parse(i[0].form_contenido);o.publicid=[],o.publicid=o.datos.publicidad,e.looo=o.datos.INT_AC_latitud,e.laaa=o.datos.INT_AC_longitud,o.nroRegistros=r.length}else o.nroRegistros=0,o.datos="",o.adjuntosArray="",o.iniciandoDatos(),n.set("IDTRAMITE",t);"SI"==a.venviado?(o.btnGuardarForm=!0,o.desabilitado=!0,o.botones=null,o.cibloq=null):(o.btnGuardarForm=!1,o.desabilitado=!1,o.botones="mostrar",o.cibloq="mostrar"),e.$broadcast("validarBtnEnviar",i.length),e.$broadcast("inicializarCamposInternet",o.datos),e.$broadcast("inicializarGrillaAE",[{datos:o.datos,venviado:a.venviado}]),e.$broadcast("inicializarFechaOblitatorio",o.datos)}).error(function(o){})}else alert("NO existe id ciudadano")},1e3)},o.formTipoPermiso=function(e){"1-F"==e&&(o.PERMISO="F"),"2-F"==e&&(o.PERMISO="F"),"3-F"==e&&(o.PERMISO="F"),"4-F"==e&&(o.PERMISO="F"),"5-D"==e&&(o.PERMISO="D"),o.TER_TIP_PERMISO=e},o.formTipoSolicitud=function(e){o.TER_TIP_SOL=e,console.log(o.TER_TIP_SOL)},o.formSolos=function(e){o.TER_SOLOS=e,console.log(o.TER_SOLOS)},o.formAutoriza=function(e){o.TER_2_PROG=e,console.log(o.TER_2_PROG)},o.formViajan=function(e){o.TER_NNA_DEL=e,console.log(o.TER_NNA_DEL),o.datos.NNA_CANT_MAS=0,o.datos.NNA_CAN_FEM=0,o.datos.NNA_CANT_NN=0,o.datos.NNA_CAN_MAS=0,o.datos.NNA_CAN_FEM=0,o.datos.NNA_NRO_ADO=0,o.datos.NNA_CANT_TOTAL=0},o.getSeleccionaMunicipios=function(e){o.municipio=e,console.log("TER_MIN  en seleccionar     ",o.municipio)},o.getProvinciasDepto=function(e){var a=e.split("-");o.depto=a[0];var t="prv_dpto_codigo = '"+a[0]+"'",i={table_name:"_bp_provincias",body:{filter:t}},r=d.api[s.SERVICE].getRecordsByPost(i);r.success(function(e){o.obtDatos=e.record,"undefined"==o.municipio&&null==o.municipio||setTimeout(function(){o.getSeleccionaMunicipios(o.municipio),document.getElementById("TER_MIN").value=o.municipio},1e3)}),r.error(function(o){console.log(o)})},o.seleccionarTramite=function(a){o.getCaptchasXX(),null!=document.getElementById("resultadoCC")&&(document.getElementById("resultadoCC").value="",$("#alert").hide()),e.tramiteId=a.vtra_id,n.set("IDTRAMITE",a.vtra_id),n.set("IDSERVICIO",a.vdvser_id),n.set("ESTADO",a.venviado),o.template="",o.formulario="mostrar",o.template=o.templates[0],"VIAJES"==a.vservicio?o.recuperarInfomacionViajes(a):o.recuperarSerializarInfo(a),o.tramiteSeleccionado=a.vtra_id;var t=document.getElementById("tipo_contribuyente");t&&(t.style.display="none")},o.getListache=function(e){o.caras=e},o.imprSelec=function(o){var e=document.getElementById(o),a=window.open(" ","popimpr");a.document.write(e.innerHTML),a.document.close(),a.print(),a.close()},o.mostrarHistorico=function(a){e.tramiteId=a.vtra_id,n.set("IDTRAMITE",a.vtra_id),n.set("IDSERVICIO",a.vdvser_id),n.set("ESTADO",a.venviado),o.recuperarSerializarInfo(a),o.template="",o.formulario="mostrar","SI"==a.venviado?(o.desabilitado=!0,o.template="",o.template=o.templates[5]):(o.desabilitado=!1,o.template="",o.template=o.templates[5]);var t=document.getElementById("tipo_contribuyente");t&&(t.style.display="none")};var O=n.get("IDCIUDADANO");o.uploader=new f({url:s.APIURL+"?desripcion=ciudadano&&idCiudadano="+O});var S=o.uploader;S.filters.push({name:"customFilter",fn:function(o,e){return this.queue.length<10}}),S.onWhenAddingFileFailed=function(o,e,a){},S.onAfterAddingFile=function(e){tipoDocumento=e.file.type;var a=tipoDocumento.split("/");tipoDocumento=a[1];"png"==tipoDocumento||"jpg"==tipoDocumento||"jpeg"==tipoDocumento||"txt"==tipoDocumento||"plain"==tipoDocumento||"zip"==tipoDocumento||"rar"==tipoDocumento||"vnd.ms-word.document.12"==tipoDocumento||"vnd.openxmlformats-officedocument.spreadsheetml.sheet"==tipoDocumento||"vnd.visio"==tipoDocumento||"vnd.ms-publisher"==tipoDocumento||"msaccess"==tipoDocumento||"vnd.openxmlformats-officedocument.wordprocessingml.document"==tipoDocumento?(o.botonSubirOriginal=null,o.botonSubirError="oculta"):(o.botonSubirError=null,o.botonSubirOriginal="oculta")},o.falla=function(){u.show("","Tipo de archivo incorrecto elimine porfavor","error"),o.desabilitado2=!0};S.onSuccessItem=function(a,t,i,r){o.direccionvirtual="RC_CLI";var n=s.APIURL+"/files/"+o.direccionvirtual+"/"+e.tramiteId+"/"+a._file.name+"?app_name=todoangular";console.log("urlIdcosimagen: ",n);var c=a._file.name,d=a._file.size/1024/1024;d=d.toFixed(2),A=o.datos.ARCHIVOS_MULTIPLES?o.datos.ARCHIVOS_MULTIPLES:new Array;var l={nombre_archivo:c,tam_archivo:d,estado_archivo:"Env.",opcion_archivo:"-",url_archivo:n};A.push(l),o.adjuntosArray=A;var u=new Array;u.push(a._file),o.almacenarDocumentos(u),a.remove(),o.datos.ARCHIVOS_MULTIPLES=A,e.$broadcast("inicializarFechaOblitatorio",o.datos)};var h=e.$on("validarBtn",function(e,a){a.frm_tra_id&&o.tramitesCiudadano()});o.$on("$destroy",function(){h()}),o.eliminarMultipleAdjunto=function(a){o.datos.ARCHIVOS_MULTIPLES&&(o.adjuntosArray=o.datos.ARCHIVOS_MULTIPLES),o.adjuntosArray&&o.adjuntosArray.splice(a,1),e.$broadcast("inicializarFechaOblitatorio",o.datos)},o.bloquearForm=function(){o.desabilitado=!0},o.desBloquearForm=function(){o.desabilitado=!1},o.cambioServicio=function(e){o.servicio=e},o.combo="<select id='servicio' class='seleccionaServicio'>  <option value='1'>Internet</option> <option value='3'>Salud</option> <option value='4'>Publicidad</option> </select> <br>";try{$("body").removeClass("modal-open"),$(".modal-backdrop").remove()}catch(o){console.log("error",o)}}),app.directive("confirmButton",function(o,e){return{restrict:"A",link:function(a,t,i){var r,n,s,c,d,l;return r=Math.floor(1e10*Math.random()),i.buttonId=r,s=i.message||"Are you sure?",l=i.yes||"Yes",c=i.no||"No",d=i.title||"Crear nuevo tramite",n="<div style='width:190px;' id=\"button-"+r+'">\n '+a.combo+'<span class="confirmbutton-msg">'+s+"</span><br>\n   <button ng-disabled='frmServicio.$invalid' data-dismiss='modal' class=\"confirmbutton-yes btn btn-success\">"+l+'</button>\n    <button class="confirmbutton-no btn btn-danger">'+c+"</button> \n</div>",t.popover({content:n,html:!0,trigger:"manual",title:d}),t.bind("click",function(n){var s,c;s=!0,n.stopPropagation(),t.popover("show"),c=$("#button-"+r),c.closest(".popover").click(function(o){s&&o.stopPropagation()}),c.find(".seleccionaServicio").change(function(o){a.cambioServicio(servicio.value)}),c.find(".confirmbutton-yes").click(function(o){s=!1;var t=e(i.confirmButton);t(a)}),c.find(".confirmbutton-no").click(function(e){s=!1,o.off("click.confirmbutton."+r),t.popover("hide")}),o.on("click.confirmbutton."+r,":not(.popover, .popover *)",function(){o.off("click.confirmbutton."+r),t.popover("hide")})})}}});