/*
  filename: angular.integralui.checkbox.min.js
  version : 1.0.0
  Copyright © 2014-2015 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Studio for Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
angular.module("integralui").factory("IntegralUICheckBoxService",["$rootScope","IntegralUIPublicService",function(c,m){return{resumeLayout:function(d){c.$broadcast(d+"-resume-layout")},suspendLayout:function(d){c.$broadcast(d+"-suspend-layout")},updateLayout:function(d){c.$broadcast(d+"-update-layout")}}}]).controller("IntegralUICheckBoxController",["$scope","$element","IntegralUIInternalService",function(c,m,d){var b=this;b.defaultStyle={general:"iui-checkbox",box:{general:"iui-checkbox-box",disabled:"iui-checkbox-box-disabled",checked:"iui-checkbox-checked",indeterminate:"iui-checkbox-indeterminate",unchecked:"iui-checkbox-unchecked"},content:{general:"iui-checkbox-content",disabled:"iui-checkbox-content-disabled"}};b.options={autoCheck:!0,checked:!1,checkState:"unchecked",controlStyle:b.defaultStyle,enabled:!0,rtl:!1,text:"",threeState:!1};this.updateOptions=function(a){b.options={autoCheck:d.isFieldAvailable(a.autoCheck,!1),checked:d.isFieldAvailable(a.checked,!1),checkState:d.isFieldAvailable(a.checkState,"unchecked"),controlStyle:d.isFieldAvailable(a.controlStyle,null),rtl:d.isFieldAvailable(a.rtl,!1),text:d.isFieldAvailable(a.text,""),threeState:d.isFieldAvailable(a.threeState,!1)}};this.getCheckValue=function(a){return"checked"==a?"checked":1==b.options.threeState&&"indeterminate"==a?"indeterminate":"unchecked"};this.setCheckValue=function(a){var f=!1,f=1==b.options.threeState?b.callCheckStateChanging(a):b.callCheckedChanging(a);!1!==f&&(b.options.checkState="unchecked"==a?1==b.options.threeState?"indeterminate":"checked":"indeterminate"==a?"checked":"unchecked",b.options.checked="checked"==b.options.checkState?!0:!1,angular.isDefined(c.checked)&&(c.checked=b.options.checked),angular.isDefined(c.checkState)&&(c.checkState=b.options.checkState),angular.isDefined(c.checkState)||1!=b.options.threeState?angular.isDefined(c.checked)||0!=b.options.threeState||b.callCheckedChanged(b.options.checkState):b.callCheckStateChanged(b.options.checkState))};this.callCheckedChanging=function(a){var f=!0;a=b.getCheckValue(a);f="checked"==a?!0:!1;return f=angular.isDefined(c.events)&&c.events.checkedChanging?c.events.checkedChanging({checked:f,checkState:a}):c.checkedChanging({e:{checked:f,checkState:a}})};this.callCheckedChanged=function(a){a=b.getCheckValue(a);var f="checked"==a?!0:!1;angular.isDefined(c.events)&&c.events.checkedChanged?c.events.checkedChanged({checked:f,checkState:a}):c.checkedChanged({e:{checked:f,checkState:a}})};this.callCheckStateChanging=function(a){var f=!0;a=b.getCheckValue(a);f="checked"==a?!0:!1;return f=angular.isDefined(c.events)&&c.events.checkstateChanging?c.events.checkstateChanging({checked:f,checkState:a}):c.checkstateChanging({e:{checked:f,checkState:a}})};this.callCheckStateChanged=function(a){a=b.getCheckValue(a);var f="checked"==a?!0:!1;angular.isDefined(c.events)&&c.events.checkstateChanged?c.events.checkstateChanged({checked:f,checkState:a}):c.checkstateChanged({e:{checked:f,checkState:a}})};this.callEnabledChanged=function(a){angular.isDefined(c.events)&&c.events.enabledChanged?c.events.enabledChanged({enabled:a}):c.enabledChanged({e:{enabled:a}})};this.callStyleChanged=function(a){angular.isDefined(c.events)&&c.events.styledChanged?c.events.styledChanged({style:a}):c.styledChanged({e:{style:a}})};b.allowUpdate=!0;this.suspendLayout=function(){b.allowUpdate=!1};this.resumeLayout=function(){b.allowUpdate=!0;b.updateLayout()};c.$on(c.name+"-resume-layout",function(a){b.resumeLayout()});c.$on(c.name+"-suspend-layout",function(a){b.suspendLayout()});c.$on(c.name+"-update-layout",function(a){b.updateLayout()});c.$watch("options.autoCheck",function(a,c){a!==c&&(b.options.autoCheck=a,b.updateLayout())});c.$watch("autoCheck",function(a,c){a!==c&&(b.options.autoCheck=a,b.updateLayout())});c.$watch("options.checked",function(a,c){a!==c&&(b.options.checked=!1!==a?!0:!1,b.options.checkState=b.options.checked?"checked":"unchecked",b.updateLayout(),b.callCheckedChanged(b.options.checkState))});c.$watch("checked",function(a,c){a!==c&&(b.options.checked=!1!==a?!0:!1,b.options.checkState=b.options.checked?"checked":"unchecked",b.updateLayout(),b.callCheckedChanged(b.options.checkState))});c.$watch("options.checkState",function(a,c){a!==c&&(b.options.checkState=b.getCheckValue(a),b.options.checked="unchecked"==b.options.checkState?!1:!0,b.updateLayout(),b.callCheckStateChanged(b.options.checkState))});c.$watch("checkState",function(a,c){a!==c&&(b.options.checkState=b.getCheckValue(a),b.options.checked="unchecked"==b.options.checkState?!1:!0,b.updateLayout(),b.callCheckStateChanged(b.options.checkState))});c.$watch("options.controlStyle",function(a,c){a!==c&&(b.options.controlStyle=a,b.updateLayout())});c.$watch("controlStyle",function(a,c){a!==c&&(b.options.controlStyle=a,b.updateLayout(),b.callStyleChanged(a))});c.$watch("options.enabled",function(a,c){a!==c&&(b.options.enabled=a,b.updateLayout(),b.callEnabledChanged(a))});c.$watch("enabled",function(a,c){a!==c&&(b.options.enabled=a,b.updateLayout(),b.callEnabledChanged(a))});c.$watch("options.rtl",function(a,c){a!==c&&(b.options.rtl=a,b.updateLayout())});c.$watch("rtl",function(a,c){a!==c&&(b.options.rtl=a,b.updateLayout())});c.$watch("options.text",function(a,c){a!==c&&(b.options.text=a,b.updateLayout())});c.$watch("text",function(a,c){a!==c&&(b.options.text=a,b.updateLayout())});c.$watch("options.threeState",function(a,c){a!==c&&(b.options.threeState=a,b.updateLayout())});c.$watch("threeState",function(a,c){a!==c&&(b.options.threeState=a,0==b.options.threeState&&"indeterminate"==b.options.checkState&&b.setCheckValue("checked"),b.updateLayout())});var h=function(a){return a?{general:d.isFieldAvailable(a.general,"iui-checkbox-box"),disabled:d.isFieldAvailable(a.disabled,"iui-checkbox-disabled"),checked:d.isFieldAvailable(a.checked,"iui-checkbox-checked"),indeterminate:d.isFieldAvailable(a.indeterminate,"iui-checkbox-indeterminate"),unchecked:d.isFieldAvailable(a.unchecked,"iui-checkbox-unchecked")}:b.defaultStyle.box},n=function(a){return a?{general:d.isFieldAvailable(a.general,"iui-checkbox-content"),disabled:d.isFieldAvailable(a.disabled,"iui-checkbox-content-disabled")}:b.defaultStyle.content};this.updateControlStyle=function(a){b.options.controlStyle=a?{general:d.isFieldAvailable(a.general,"iui-checkbox"),box:h(a.box),content:n(a.content)}:{general:d.isFieldAvailable(b.defaultStyle.general,"iui-checkbox"),box:h(b.defaultStyle.box),content:n(b.defaultStyle.content)}}}]).directive("iuiCheckbox",["$timeout","$interval","IntegralUIInternalService",function(c,m,d){return{restrict:"EA",controller:"IntegralUICheckBoxController",transclude:!0,replace:!0,template:'<div data-element="checkbox"><canvas></canvas><div ng-transclude></div></div>',scope:{autoCheck:"=",checked:"=",checkState:"=",controlStyle:"=",enabled:"=",name:"@",options:"=?",rtl:"=",text:"@",threeState:"=",checkedChanging:"&",checkedChanged:"&",checkstateChanging:"&",checkstateChanged:"&",enabledChanged:"&",styleChanged:"&",events:"=?"},link:function(b,h,n,a,f){var k=this,e=h.children().eq(0),l=h.children().eq(1);b.$on("destroy",function(a){k.cb_s2t();h.unbind("click");e.unbind("click")});var r=function(){e.bind("click",function(b){0!=a.options.enabled&&(a.setCheckValue(a.options.checkState),a.updateLayout());b.stopPropagation()})};h.bind("click",function(b){0!=a.options.enabled&&a.options.autoCheck&&(a.setCheckValue(a.options.checkState),a.updateLayout())});a.updateLayout=function(){if(a.allowUpdate){h.removeAttr("class");h.addClass(a.defaultStyle.general);a.options.controlStyle&&d.isString(a.options.controlStyle.general)&&h.addClass(a.options.controlStyle.general);0<e.length&&p();0<l.length&&(l.removeAttr("class"),l.addClass(a.defaultStyle.content.general),a.options.controlStyle&&a.options.controlStyle.content&&d.isString(a.options.controlStyle.content.general)&&l.addClass(a.options.controlStyle.content.general),0==a.options.enabled&&a.options.controlStyle.content.disabled&&d.isString(a.options.controlStyle.content.disabled)&&l.addClass(a.options.controlStyle.content.disabled));var b=c(function(){var d="ltr";!0===a.options.rtl&&(d="rtl");h.css("direction",d);e.unbind("click");if((d=getComputedStyle(e[0])["background-image"])&&"none"!=d)e.remove(),e=angular.element("<span></span>"),h.prepend(e),p();else{e.remove();e=angular.element("<canvas></canvas>");h.prepend(e);p();getComputedStyle(e[0]);var g=getComputedStyle(e[0]).width,f=getComputedStyle(e[0]).height,d=getComputedStyle(e[0]).color;e[0].width=g?parseInt(g,10):14;e[0].height=f?parseInt(f,10):14;!0===a.options.rtl?(e.css("left","auto"),e.css("right",0)):(e.css("left",0),e.css("right","auto"));var g=e[0].getContext("2d"),f=e[0].width,k=e[0].height;g.beginPath();g.rect(0,0,f,k);g.fillStyle="#ffffff";g.fill();"checked"==a.options.checkState?(g.lineWidth=12<k?3:1,g.strokeStyle=d,"indeterminate"==a.options.checkState&&(g.strokeStyle="#808080"),g.beginPath(),g.moveTo(3,k/2+1),g.lineTo(0+f/2,0+k-3),g.stroke(),g.beginPath(),g.moveTo(0+f/2-1,0+k-3),g.lineTo(0+f-3,3),g.stroke()):"indeterminate"==a.options.checkState&&(g.beginPath(),g.rect(4,4,f-8,k-8),g.fillStyle=d,g.fill())}r();0==l.children().length&&l.css("padding",0);c.cancel(b)},1)}};var p=function(){e.removeAttr("class");e.addClass(a.defaultStyle.box.general+" "+a.defaultStyle.box[a.options.checkState]);a.options.controlStyle&&a.options.controlStyle.box&&(a.options.controlStyle.box.general&&d.isString(a.options.controlStyle.box.general)&&e.addClass(a.options.controlStyle.box.general),0==a.options.enabled&&a.options.controlStyle.box.disabled&&d.isString(a.options.controlStyle.box.disabled)?e.addClass(a.options.controlStyle.box.disabled):a.options.controlStyle.box[a.options.checkState]&&d.isString(a.options.controlStyle.box[a.options.checkState])&&e.addClass(a.options.controlStyle.box[a.options.checkState]))};this.crpar=function(){return["si","tri","ver","on","al "]};this.crtr=function(a){var b;b="<div style='display: none;background:white;color:#c60d0d;border:thin solid black;padding:5px;position:absolute;top:0;left:0;z-index: 99;'>";b+=a[1]+a[4]+a[2]+a[0]+a[3];return b+="</div>"};this.cb_tpar=this.crpar();this.$cb_tw=angular.element(this.crtr(this.cb_tpar));this.tmp=300;this.cb_twp=200*k.tmp;this.cb_trActive=!1;this.cb_trCount=0;this.cb_trlTime=this.cb_trId=null;this.cb_trShowCount=0;this.cb_animTr=function(){this.cb_trCount++;3>this.cb_trShowCount?(this.cb_trCount=1,this.$cb_tw.css("display","block"),this.$cb_tw.css("top",h[0].scrollTop+"px"),this.$cb_tw.css("left",h[0].scrollLeft+"px"),this.cb_trShowCount++):(0===this.cb_trCount%49&&(this.cb_trShowCount=0),this.$cb_tw.css("display","none"),this.$cb_tw.css("top",h[0].scrollTop+"px"),this.$cb_tw.css("left",h[0].scrollLeft+"px"))};this.cb_s1t=function(a){this.cb_trlTime=c(function(){k.cb_trActive||(k.cb_trCount=0,k.cb_trActive=!0,k.cb_trId=m(function(){k.cb_animTr()},1E3))},a)};this.cb_s2t=function(){this.cb_trId&&(m.clear(this.cb_trId),this.cb_trId=null);this.cb_trlTime&&(c.cancel(this.cb_trlTime),this.cb_trlTime=null);this.cb_trActive=!1;this.$cb_tw.remove()};var q=!1,t=c(function(){for(var a=h.parent();a&&a[0]&&a[0]!==document.getElementsByTagName("body")[0];){if(a[0].attributes&&a[0].attributes["data-element"]&&("treeview"==a[0].attributes["data-element"].value||"treegrid"==a[0].attributes["data-element"].value)){q=!0;break}a=a.parent()}q||(h.append(k.$cb_tw),k.cb_s1t(k.cb_twp));c.cancel(t)},1);angular.isDefined(b.options)?a.updateOptions(b.options):(0==b.autoCheck&&(a.options.autoCheck=b.autoCheck),1==b.checked&&(a.options.checked=b.checked,a.options.checkState="checked"),angular.isDefined(b.checkState)&&(a.options.checkState=b.checkState,a.options.checked="checked"==a.options.checkState?!0:!1),angular.isDefined(b.controlStyle)&&a.updateControlStyle(b.controlStyle),0==b.enabled&&(a.options.enabled=b.enabled),1==b.rtl&&(a.options.rtl=b.rtl),angular.isDefined(b.text)&&(a.options.text=b.text),!0===b.threeState&&(a.options.threeState=b.threeState));a.updateLayout()}}}]);