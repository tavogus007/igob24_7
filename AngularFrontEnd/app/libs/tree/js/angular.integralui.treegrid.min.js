/*
  filename: angular.integralui.treegrid.min.js
  version : 2.0.0
  Copyright © 2014-2015 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Studio for Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
angular.module("integralui").factory("IntegralUITreeGridService",["$rootScope",function(c){var k=null;return{addColumn:function(e,h){c.$broadcast(e+"-add-column",h)},clearColumns:function(e){c.$broadcast(e+"-clear-columns")},insertColumnAt:function(e,h,f){c.$broadcast(e+"-insert-column-at",h,f)},insertColumnBefore:function(e,h,f){c.$broadcast(e+"-insert-column-before",h,f)},insertColumnAfter:function(e,h,f){c.$broadcast(e+"-insert-column-after",h,f)},removeColumn:function(e,h){c.$broadcast(e+"-remove-column",h)},removeColumnAt:function(e,h){c.$broadcast(e+"-remove-column-at",h)},addRow:function(e,h,f){c.$broadcast(e+"-add-row",h,f)},clearRows:function(e,h){c.$broadcast(e+"-clear-rows",h)},insertRowAt:function(e,h,f,k){c.$broadcast(e+"-insert-row-at",h,f,k)},insertRowBefore:function(e,h,f){c.$broadcast(e+"-insert-row-before",h,f)},insertRowAfter:function(e,h,f){c.$broadcast(e+"-insert-row-after",h,f)},removeRow:function(e,h){c.$broadcast(e+"-remove-row",h)},removeRowAt:function(e,h,f){c.$broadcast(e+"-remove-row-at",h,f)},exportToJSON:function(e,h,f,k,l){c.$broadcast(e+"-export-json",h,f,k,l);e=this.getTempData();this.clearTempData();return e?e:""},loadData:function(e,h,f,k,l){c.$broadcast(e+"-load-data",h,f,k,l)},beginLoad:function(e,h){c.$broadcast(e+"-begin-load",h)},collapse:function(e,h){c.$broadcast(e+"-collapse",h)},endLoad:function(e){c.$broadcast(e+"-end-load")},expand:function(e,h){c.$broadcast(e+"-expand",h)},expandColIndex:function(e,h){c.$broadcast(e+"-expand-col-index",h)},toggle:function(e,h){c.$broadcast(e+"-toggle",h)},filter:function(e,h){c.$broadcast(e+"-filter",h);var f=this.getTempData();this.clearTempData();return f?f:null},findRowById:function(e,h){c.$broadcast(e+"-find-row-by-id",h);var f=this.getTempData();this.clearTempData();return f?f:null},findRowByText:function(e,h){c.$broadcast(e+"-find-row-by-text",h);var f=this.getTempData();this.clearTempData();return f?f:null},getRowParent:function(e,h){c.$broadcast(e+"-get-row-parent",h);var f=this.getTempData();this.clearTempData();return f?f:null},focus:function(e,h){c.$broadcast(e+"-focus",h)},clearTempData:function(){k=null},ensureVisible:function(e,h){c.$broadcast(e+"-ensure-visible",h)},getTempData:function(){return k},getRowLevel:function(e,h){c.$broadcast(e+"-get-row-level",h);var f=this.getTempData();this.clearTempData();return f?f:0},getFlatList:function(e,h){c.$broadcast(e+"-get-flat-list",h);var f=this.getTempData();this.clearTempData();return f?f:[]},getFullPath:function(e,h){c.$broadcast(e+"-get-full-path",h);var f=this.getTempData();this.clearTempData();return f?f:""},getList:function(e,h){c.$broadcast(e+"-get-list",h);var f=this.getTempData();this.clearTempData();return f?f:[]},setTempData:function(c){k=c},selectedColumn:function(e,h){if(h)c.$broadcast(e+"-set-selected-column",h);else{c.$broadcast(e+"-get-selected-column");var f=this.getTempData();this.clearTempData();return f?f:null}},selectedRow:function(e,h){if(h)c.$broadcast(e+"-set-selected-row",h);else{c.$broadcast(e+"-get-selected-row");var f=this.getTempData();this.clearTempData();return f?f:null}},selectedRows:function(e){c.$broadcast(e+"-get-selected-rows");e=this.getTempData();this.clearTempData();return e?e:null},getScrollPos:function(e){c.$broadcast(e+"-get-scroll-pos");e=this.getTempData();this.clearTempData();return e?e:{x:0,y:0}},setScrollPos:function(e,h){c.$broadcast(e+"-set-scroll-pos",h)},scrollTo:function(e,h,f){c.$broadcast(e+"-scroll-to",h,f)},refresh:function(e,h,f){c.$broadcast(e+"-refresh",h,f)},resumeLayout:function(e){c.$broadcast(e+"-resume-layout")},suspendLayout:function(e){c.$broadcast(e+"-suspend-layout")},updateLayout:function(e){c.$broadcast(e+"-update-layout")},updateView:function(e){c.$broadcast(e+"-update-view")}}}]).controller("IntegralUITreeGridController",["$scope","$element","$timeout","$window","IntegralUIInternalService","IntegralUIDataService","IntegralUITreeGridService","IntegralUIDragDrop","IntegralUIFilter",function(c,k,e,h,f,T,l,n,Fa){var a=this;this.suppressProcess=!1;this.hoverCell=this.hoverRow=this.hoverColumn=null;a.defaultCheckBoxStyle={general:"iui-checkbox",box:{general:"iui-checkbox-box",disabled:"iui-checkbox-box-disabled",checked:"iui-checkbox-checked",indeterminate:"iui-checkbox-indeterminate",unchecked:"iui-checkbox-unchecked"}};a.defaultStyle={general:"iui-treegrid",column:{general:{content:"iui-treegrid-column-cell-content",disabled:"iui-treegrid-column-disabled",normal:"iui-treegrid-column",hovered:"iui-treegrid-column-hovered",selected:"iui-treegrid-column-selected"},header:{content:"iui-treegrid-column-header-cell-content",disabled:"iui-treegrid-column-header-disabled",normal:"iui-treegrid-column-header",hovered:"iui-treegrid-column-header-hovered",selected:"iui-treegrid-column-header-selected"},body:{content:"iui-treegrid-column-body-cell-content",disabled:"iui-treegrid-column-body-disabled",normal:"iui-treegrid-column-body",hovered:"iui-treegrid-column-body-hovered",selected:"iui-treegrid-column-body-selected"},footer:{content:"iui-treegrid-column-footer-cell-content",disabled:"iui-treegrid-column-footer-disabled",normal:"iui-treegrid-column-footer",hovered:"iui-treegrid-column-footer-hovered",selected:"iui-treegrid-column-footer-selected"}},row:{general:{disabled:"iui-treegrid-row-disabled",focused:"iui-treegrid-row-focused",normal:"iui-treegrid-row",hovered:"iui-treegrid-row-hovered",selected:"iui-treegrid-row-selected"},checkBox:{general:"iui-checkbox",box:{general:"iui-checkbox-box",disabled:"iui-checkbox-box-disabled",checked:"iui-checkbox-checked",indeterminate:"iui-checkbox-indeterminate",unchecked:"iui-checkbox-unchecked"}},expandBox:{general:"iui-treegrid-expand-box",animated:"iui-treegrid-expand-box-load",expanded:"iui-treegrid-expand-box-open",collapsed:"iui-treegrid-expand-box-close"},cell:{content:"iui-treegrid-row-cell-content",general:"iui-treegrid-row-cell",disabled:"iui-treegrid-row-cell-disabled",focused:"iui-treegrid-row-cell-focused",normal:"iui-treegrid-row-cell",hovered:"iui-treegrid-row-cell-hovered",selected:"iui-treegrid-row-cell-selected"}},cell:{content:"iui-treegrid-row-cell-content",general:"iui-treegrid-row-cell",disabled:"iui-treegrid-row-cell-disabled",focused:"iui-treegrid-row-cell-focused",normal:"iui-treegrid-row-cell",hovered:"iui-treegrid-row-cell-hovered",selected:"iui-treegrid-row-cell-selected"}};a.options={allowAnimation:!0,allowCellFocus:!0,allowColumnReorder:!1,allowDrag:!1,allowDrop:!0,allowFocus:!0,animationSpeed:200,cellFields:{cid:"cid",content:"content",contextMenu:"contextMenu",enabled:"enabled",labelEdit:"labelEdit",style:"style",styleFromParent:"styleFromParent",text:"text",value:"value"},columnFields:{allowDrag:"allowDrag",allowDrop:"allowDrop",contentAlignment:"contentAlignment",contextMenu:"contextMenu",editorType:"editorType",editorSettings:"editorSettings",filterParams:"filterParams",fixedWidth:"fixedWidth",footerAlignment:"footerAlignment",footerText:"footerText",headerAlignment:"headerAlignment",headerContent:"headerContent",headerText:"headerText",dataSource:null,icon:"icon",id:"id",style:"style",width:"width"},controlStyle:a.defaultStyle,expandColIndex:0,fillSpace:!1,gridLines:"both",hoverSelection:!1,indent:15,labelEdit:!1,loadRow:null,pathSeparator:"\\",rowFields:{allowDrag:"allowDrag",allowDrop:"allowDrop",cells:"cells",content:"content",contextMenu:"contextMenu",dataSource:null,enabled:"enabled",expanded:"expanded",hasChildren:"hasChildren",icon:"icon",id:"id",pid:"pid",rows:"rows",statusIcon:"statusIcon",style:"style",text:"text"},rtl:!1,selectedColumn:null,selectedIndex:-1,selectedRow:null,selectedRows:[],selectionMode:"one",showFooter:!0,showHeader:!0,showIcons:!0};c.$on(c.name+"-add-column",function(b,d){a.columnsObj.insertAt(d,-1,null,a.columnIsAdded)});c.$on(c.name+"-clear-columns",function(b){a.columnsObj.clear(null,a.columnIsRemoved)});c.$on(c.name+"-insert-column-at",function(b,d,c){a.columnsObj.insertAt(d,c,null,a.columnIsAdded)});c.$on(c.name+"-insert-column-after",function(b,d,c){a.columnsObj.insertByRef(d,c,!0,a.columnIsAdded)});c.$on(c.name+"-insert-column-before",function(b,d,c){a.columnsObj.insertByRef(d,c,!1,a.columnIsAdded)});c.$on(c.name+"-remove-column",function(b,d){a.columnsObj.removeAt(d,-1,null,a.columnIsRemoved)});c.$on(c.name+"-remove-column-at",function(b,d){a.columnsObj.removeAt(null,d,null,a.columnIsRemoved)});a.columnIsAdded=function(){a.updateLayout()};a.columnIsRemoved=function(b,d){a.updateLayout()};c.$on(c.name+"-add-row",function(b,d,c){a.rowsObj.insertAt(d,-1,c,a.rowIsAdded)});c.$on(c.name+"-clear-rows",function(b,d){a.rowsObj.clear(d,a.rowIsRemoved);d||a.setScrollPos({x:0,y:0})});c.$on(c.name+"-insert-row-at",function(b,d,c,g){a.rowsObj.insertAt(d,c,g,a.rowIsAdded)});c.$on(c.name+"-insert-row-after",function(b,d,c){a.rowsObj.insertByRef(d,c,!0,a.rowIsAdded)});c.$on(c.name+"-insert-row-before",function(b,d,c){a.rowsObj.insertByRef(d,c,!1,a.rowIsAdded)});c.$on(c.name+"-remove-row",function(b,d){a.rowsObj.removeAt(d,-1,null,a.rowIsRemoved)});c.$on(c.name+"-remove-row-at",function(b,d,c){a.rowsObj.removeAt(null,d,c,a.rowIsRemoved)});this.rowIsAdded=function(){a.updateLayout()};this.rowIsRemoved=function(b,d,c){a.updateLayout()};this.objIsRemoved=function(b,d,c){a.updateLayout()};a.columnList=[];a.columnFilterList=[];this.updateColumnList=function(){a.columnList.length=0;a.columnFilterList.length=0;var b=a.columnsObj.getList();if(b)for(var d=0;d<b.length;d++){var c=b[d];c.type="column";c[a.options.columnFields.id]||(c[a.options.columnFields.id]=f.getUniqueId());var g=c[a.options.columnFields.filterParams],g=g?Fa.createTree(g.conditions,g.formula):null;a.columnFilterList.push({cid:c[a.options.columnFields.id],tree:g});a.columnList.push(c)}};var Na=function(b){for(var d=null,c=0;c<a.columnFilterList.length;c++)if(a.columnFilterList[c].cid==b){d=a.columnFilterList[c].tree;break}return d},t=a.options.indent;a.currentList=[];a.indentList=[];a.longestRow=null;a.isThereChildRows=!1;var J=function(b,d,c,g){b.type="row";b[a.options.rowFields.id]||(b[a.options.rowFields.id]=f.getUniqueId());c&&(b[a.options.rowFields.pid]=c);c=!0;if(b[a.options.rowFields.cells]&&0<b[a.options.rowFields.cells].length){var e=!0;if(b){c=-1;for(var h=null,l=null,k=0;k<b[a.options.rowFields.cells].length&&(e=!0,l=b[a.options.rowFields.cells][k],c=l[a.options.cellFields.cid],h=a.getColumnById(c),!h&&k<a.columnList.length&&(h=a.columnList[k]),h&&h[a.options.columnFields.filterParams]&&(e=h[a.options.columnFields.filterParams],e=e.callback?e.callback(l[a.options.cellFields.value]):Fa.match(l[a.options.cellFields.value],e.conditions,e.formula,Na(c))),e);k++);}c=e;for(l=0;l<b[a.options.rowFields.cells].length;l++)b[a.options.rowFields.cells][l].type="cell"}c&&(g?a.fullList.push(b):(a.currentList.push(b),a.indentList.push(d)));return c},B=function(b,d,c,g){var f=!0;if(!b[a.options.rowFields.rows])return f=J(b,d,c,g);if(f=J(b,d,c,g)){c=0;var e=!0;if(g||a.isRowExpanded(b))for(var h=0;h<b[a.options.rowFields.rows].length;h++)(e=B(b[a.options.rowFields.rows][h],d+t,b[a.options.rowFields.id],g))&&c++;g||a.isThereChildRows||!(0<c||!a.isRowExpanded(b)&&b[a.options.rowFields.rows]&&0<b[a.options.rowFields.rows].length)||(a.isThereChildRows=!0)}return f};a.fullList=[];this.getFullList=function(){a.fullList.length=0;for(var b=a.rowsObj.getList(),d=0;d<b.length;d++)B(b[d],0,null,!0);return a.fullList};this.getCurrentList=function(){return a.currentList};this.updateCurrentList=function(){a.currentList.length=0;a.indentList.length=0;a.isThereChildRows=!1;var b=a.rowsObj.getList();if(b)for(var d=0;d<b.length;d++)B(b[d],0,null,!1)};this.getRowFields=function(a){return{content:a.content?a.content:"content",icon:a.icon?a.icon:"icon",id:a.id?a.id:"id",pid:a.pid?a.pid:"pid",objects:a.rows?a.rows:"rows",subobjects:a.cells?a.cells:"cells",text:a.text?a.text:"text"}};a.columnsObj=new T({objects:c.columns,events:{clear:function(a){return angular.isDefined(c.events)&&c.events.clearColumns?c.events.clearColumns({parent:a.e.parent}):c.clearColumns(a)},objAdded:function(a){return angular.isDefined(c.events)&&c.events.columnAdded?c.events.columnAdded({column:a.e.column}):c.columnAdded(a)},objAdding:function(a){return angular.isDefined(c.events)&&c.events.rowAdding?c.events.columnAdding({column:a.e.column}):c.columnAdding(a)},objRemoved:function(a){return angular.isDefined(c.events)&&c.events.rowRemoved?c.events.columnRemoved({column:a.e.column}):c.columnRemoved(a)},objRemoving:function(a){return angular.isDefined(c.events)&&c.events.rowRemoving?c.events.columnRemoving({column:a.e.column}):c.columnRemoving(a)}},fields:a.options.columnFields});a.rowsObj=new T({objects:c.rows,events:{clear:function(a){return angular.isDefined(c.events)&&c.events.clearRows?c.events.clearRows({parent:a.e.parent}):c.clearRows(a)},objAdded:function(a){return angular.isDefined(c.events)&&c.events.rowAdded?c.events.rowAdded({row:a.e.row}):c.rowAdded(a)},objAdding:function(a){return angular.isDefined(c.events)&&c.events.rowAdding?c.events.rowAdding({row:a.e.row}):c.rowAdding(a)},objRemoved:function(a){return angular.isDefined(c.events)&&c.events.rowRemoved?c.events.rowRemoved({row:a.e.row}):c.rowRemoved(a)},objRemoving:function(a){return angular.isDefined(c.events)&&c.events.rowRemoving?c.events.rowRemoving({row:a.e.row}):c.rowRemoving(a)}},fields:a.getRowFields(a.options.rowFields)});c.$on(c.name+"-load-data",function(b,d,c,g,f){a.loadData(d,c,g,f)});c.$on(c.name+"-export-json",function(b,d,c,g,f){l.setTempData(a.exportToJSON(d,c,g,f))});this.exportToJSON=function(b,d,c,g){var f=g,f=f?f:null,e=a.columnsObj.getList();b=JSON.stringify(e,b?b:[a.options.columnFields.allowDrag,a.options.columnFields.allowDrop,a.options.columnFields.contentAlignment,a.options.columnFields.contextMenu,a.options.columnFields.editorType,a.options.columnFields.editorSettings,a.options.columnFields.filterParams,a.options.columnFields.fixedWidth,a.options.columnFields.footerAlignment,a.options.columnFields.footerText,a.options.columnFields.headerAlignment,a.options.columnFields.headerContent,a.options.columnFields.headerText,a.options.columnFields.icon,a.options.columnFields.id,a.options.columnFields.style,a.options.columnFields.width],f);g=g?g:null;f=!1!==c?a.getFullList():a.rowsObj.getList();d=d?d:[a.options.rowFields.allowCellFocus,a.options.rowFields.allowDrag,a.options.rowFields.allowDrop,a.options.rowFields.allowFocus,a.options.rowFields.cells,a.options.rowFields.content,a.options.rowFields.contextMenu,a.options.rowFields.enabled,a.options.rowFields.expanded,a.options.rowFields.hasChildren,a.options.rowFields.icon,a.options.rowFields.id,a.options.rowFields.pid,a.options.rowFields.statusIcon,a.options.rowFields.style,a.options.rowFields.text];0==c&&d.push(a.options.rowFields.rows);c=JSON.stringify(f,d,g);return'[\n{ "columns": '+b+' },\n{ "rows": '+c+" }\n]"};this.loadData=function(b,d,x,g){a.allowEvents=!1;a.updateDataFields(x);var f=[],e=a.options.rowFields;a.rowsObj.clear(d);if(b)if(!1!==g){var h=[];b.forEach(function(a,b){var d=a[e.pid];h[d]?(h[d][e.rows]||(h[d][e.rows]=[]),h[a[e.id]]=a,h[d][e.rows].push(a)):(h[a[e.id]]=a,f.push(a))});h.length=0}else f=b;if(d)for(d[a.options.rowFields.rows]=f,b=0;b<d[a.options.rowFields.rows].length;b++)d[a.options.rowFields.rows][b][a.options.rowFields.pid]=d[a.options.rowFields.id];else angular.isDefined(c.rows)&&(c.rows=f);a.rowsObj=new T({objects:c.rows,events:a.rowEvents,fields:a.getRowFields(a.options.rowFields)});a.updateLayout();a.allowEvents=!0};this.updateDataFields=function(b){b&&(b.column&&(a.options.columnFields={allowDrag:b.column.allowDrag?b.column.allowDrag:"allowDrag",allowDrop:b.column.allowDrop?b.column.allowDrop:"allowDrop",contentAlignment:b.column.contentAlignment?b.column.contentAlignment:"contentAlignment",contextMenu:b.column.contextMenu?b.column.contextMenu:"contextMenu",dataSource:b.column.dataSource,editorType:b.column.editorType?b.column.editorType:"editorType",editorSettings:b.column.editorSettings?b.column.editorSettings:"editorSettings",filterParams:b.column.filterParams?b.column.filterParams:"filterParams",fixedWidth:b.column.fixedWidth?b.column.fixedWidth:"fixedWidth",footerAlignment:b.column.footerAlignment?b.column.footerAlignment:"footerAlignment",footerContent:b.column.footerContent?b.column.footerContent:"footerContent",footerText:b.column.footerText?b.column.footerText:"footerText",headerAlignment:b.column.headerAlignment?b.column.headerAlignment:"headerAlignment",headerContent:b.column.headerContent?b.column.headerContent:"headerContent",headerText:b.column.headerText?b.column.headerText:"headerText",icon:b.column.icon?b.column.icon:"icon",id:b.column.id?b.column.id:"id",style:b.column.style?b.column.style:"style",width:b.column.width?b.column.width:"width"},a.columnsObj&&a.columnsObj.updateDataFields(a.options.columnFields)),b.row&&(a.options.rowFields={allowDrag:b.row.allowDrag?b.row.allowDrag:"allowDrag",allowDrop:b.row.allowDrop?b.row.allowDrop:"allowDrop",allowFocus:b.row.allowFocus?b.row.allowFocus:"allowFocus",cells:b.row.cells?b.row.cells:"cells",content:b.row.content?b.row.content:"content",contextMenu:b.row.contextMenu?b.row.contextMenu:"contextMenu",dataSource:b.row.dataSource,enabled:b.row.enabled?b.row.enabled:"enabled",expanded:b.row.expanded?b.row.expanded:"expanded",hasChildren:b.row.hasChildren?b.row.hasChildren:"hasChildren",icon:b.row.icon?b.row.icon:"icon",id:b.row.id?b.row.id:"id",rows:b.row.rows?b.row.rows:"rows",pid:b.row.pid?b.row.pid:"pid",statusIcon:b.row.statusIcon?b.row.statusIcon:"statusIcon",style:b.row.style?b.row.style:"style",text:b.row.text?b.row.text:"text"},a.rowsObj&&a.rowsObj.updateDataFields(a.options.rowFields)),b.cell&&(a.options.cellFields={cid:b.cell.cid?b.cell.cid:"cid",content:b.cell.content?b.cell.content:"content",contextMenu:b.cell.contextMenu?b.cell.contextMenu:"contextMenu",enabled:b.cell.enabled?b.cell.enabled:"enabled",labelEdit:b.cell.labelEdit?b.cell.labelEdit:"labelEdit",style:b.cell.style?b.cell.style:"style",text:b.cell.text?b.cell.text:"text",value:b.cell.value?b.cell.value:"value"}))};this.updateData=function(){a.options.rowFields.dataSource&&(a.loadData(a.options.rowFields.dataSource),a.rowsObj=new T({objects:c.rows,events:a.rowEvents,fields:a.getRowFields(a.options.rowFields)}))};var G=!1;this.dragDropStatus=function(a){if(a)G=a;else return G};this.getDnDSource=function(a){return{text:a.dataTransfer?a.dataTransfer.getData("text"):a.originalEvent.dataTransfer?a.originalEvent.dataTransfer.getData("text"):""}};var ka=angular.element('<div class="iui-drop-marker" data-element="dropmark"></div>');this.getDropMarkLine=function(){return dropMarkLine};angular.element(h).bind("dragenter",function(b){a.dropMark()});angular.element(h).bind("dragend",function(b){a.removeDropMark();a.dragIcon&&angular.element(a.dragIcon).remove();a.cancelScrollTimer()});a.getMousePos=function(a){return{x:a.pageX?a.pageX:a.originalEvent?a.originalEvent.pageX:0,y:a.pageY?a.pageY:a.originalEvent?a.originalEvent.pageY:0}};this.getTreeName=function(){return angular.isDefined(c.name)?c.name:""};k.bind("dragenter",function(b){b.preventDefault();var d=n.getData();d.source||(d.source=a.getDnDSource(b));b={sourceTree:d.sourceCtrl?d.sourceCtrl.getTreeName():"",dragRow:d.source,targetTree:a.getTreeName(),targetRow:d.target,mousePos:a.getMousePos(b)};a.callDragEnter(b)});k.bind("dragover",function(b){b.preventDefault();var d=!0;b.dataTransfer?d="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(d="none"===b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(d){b.dataTransfer?b.dataTransfer.dropEffect=a.options.allowDrop?"move":"none":b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.dropEffect=a.options.allowDrop?"move":"none");d=n.getData();d.source||(d.source=a.getDnDSource(b));n.setData({source:d.source,sourceCtrl:d.sourceCtrl,target:null,dropPos:-1});d={sourceTree:d.sourceCtrl?d.sourceCtrl.getTreeName():"",dragRow:d.source,targetTree:a.getTreeName(),targetRow:null,isDropAllowed:a.options.allowDrop,dropPos:-1,mousePos:a.getMousePos(b)};a.callDragOver(d);d=a.getMousePos(b);b=d.y+16;var d=d.x+20,x=a.getDropMarkWindow();x.empty();x.append("<span class='iui-drop-marker-move-end'></span><span class='iui-drop-marker-title'>"+(c.name?c.name:"TreeGrid")+"</span>");a.updateDropMarkElem(a.getDropMarkWindow(),{top:b,left:d});a.dropMark(!0)}});k.bind("drop",function(b){b.preventDefault();a.dropMark();var d=!0;b.dataTransfer?d="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(d="none"===b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(d&&(d=n.getData(),d.source||(d.source=a.getDnDSource(b)),d.source)){var x={sourceTree:d.sourceCtrl?d.sourceCtrl.getTreeName():"",dragRow:d.source,targetTree:a.getTreeName(),targetRow:null,isDropAllowed:a.options.allowDrop,dropPos:-1,mousePos:a.getMousePos(b)};!1!==a.callDragDrop(x)&&(a.drop(d),c.$$phase||c.$apply())}n.clearData();b.stopPropagation()});k.bind("dragleave",function(b){b.preventDefault();a.dropMark();var d=n.getData();d.source||(d.source=a.getDnDSource(b));b={sourceTree:d.sourceCtrl?d.sourceCtrl.getTreeName():"",dragRow:d.source,targetTree:a.getTreeName(),targetRow:d.target,mousePos:a.getMousePos(b)};a.callDragLeave(b);a.cancelScrollTimer()});k.bind("dragend",function(b){b.preventDefault();a.dropMark();n.getData().source||n.clearData()});k.bind("mouseleave",function(b){b.preventDefault();a.dropMark();a.hoverColumn=null;a.hoverRow=null;a.hoverCell=null});this.containsMousePos=function(a,d){return n.hitTest(a,d,{left:0,top:0,right:k[0].clientWidth,bottom:k[0].clientHeight})};this.isPopupActive=function(){return!1};var M=function(b,d){var c=a.options.rowFields;if(!b[c.cells]){b[c.cells]=[];var g={};g[a.options.cellFields.text]=b[d.text];b[c.cells].push(g)}b[c.rows]||(b[c.rows]=[]);b[c.rows].length=0;if(b[d.items]&&0<b[d.items].length)for(g=0;g<b[d.items].length;g++)b[c.rows].push(M(b[d.items][g],d));return b},K=function(b,d){var c=!1;d.sourceCtrl&&(c=d.sourceCollection.removeAt(b,-1,null,d.sourceCtrl.objIsRemoved));c&&("item"==b.type&&(b=M(b,d.sourceCtrl.options.dataFields)),0===d.dropPos?a.rowsObj.insertAt(b,-1,d.target,a.rowIsAdded):1===d.dropPos||2===d.dropPos?1===d.dropPos?a.rowsObj.insertByRef(b,d.target,!1,a.rowIsAdded):a.rowsObj.insertByRef(b,d.target,!0,a.rowIsAdded):a.rowsObj.insertAt(b,-1,null,a.rowIsAdded))};this.drop=function(b){if(b&&b.sourceCtrl){b.sourceCtrl.suppressProcess=!0;b.sourceCtrl.suspendLayout();a.suspendLayout();var d=b.source;if(Array.isArray(b.source)){for(var x=[],g=0;g<b.source.length;g++){for(var f=!1,h=b.sourceCollection.getParent(b.source[g]);h;){if(b.sourceCtrl.isObjInSelList(h)){f=!0;break}h=b.sourceCollection.getParent(h)}f||x.push(b.source[g])}if(0<x.length)if(d=x[x.length-1],g=b.sourceCtrl.getObjCurrentIndex(x[0]),f=b.sourceCtrl.getObjCurrentIndex(d),g<=f)for(g=0;g<x.length;g++)K(x[g],b);else for(g=x.length-1;0<=g;g--)K(x[g],b)}else K(b.source,b);b.sourceCtrl!==a?(a.resumeLayout(),b.sourceCtrl.resumeLayout()):a.resumeLayout();b.sourceCtrl.multiSelection(!1);var l=e(function(){if(d){b.sourceCtrl.clearPrevSelection(d);a.rowSelection(d);var g=a.getElemFromRow(d);g&&(g=a.getElement(g))&&g[0].focus();c.$apply();e.cancel(l)}},1);b.sourceCtrl.suppressProcess=!1}};this.isDragAllowed=function(b){return a.options.allowDrag?b&&(b[a.options.rowFields.allowDrag]||void 0===b[a.options.rowFields.allowDrag])?!0:!1:!1};this.isChildOf=function(b,d){var c=!1;if(b&&d){var g=d[a.options.rowFields.rows];if(g&&0<g.length)for(var e=0;e<g.length;e++){if(f.isEqual(b[a.options.rowFields.id],g[e][a.options.rowFields.id])){c=!0;break}else c=a.isChildOf(b,g[e]);if(c)break}}return c};this.isParentOf=function(b,d){var c=a.rowsObj.getParent(d);return b&&d&&c&&f.isEqual(b[a.options.rowFields.id],c[a.options.rowFields.id])?!0:!1};this.isDropAllowed=function(b,d,c){var g=a.options.allowDrop;if(g&&b&&d&&(g=d[a.options.rowFields.allowDrop]||void 0===d[a.options.rowFields.allowDrop]?!0:!1))if(Array.isArray(b))for(var e=0;e<b.length;e++){if(f.isEqual(b[e][a.options.rowFields.id],d[a.options.rowFields.id])||0===c&&a.isParentOf(d,b[e])||a.isChildOf(d,b[e])){g=!1;break}if(!g)break}else if(f.isEqual(b[a.options.rowFields.id],d[a.options.rowFields.id])||0===c&&a.isParentOf(d,b)||a.isChildOf(d,b))g=!1;return g};this.getDropMarkWindow=function(){for(var a=ka,d=angular.element(document.body).children(),c=0;c<d.length;c++){var g=angular.element(d[c]);if(g[0].attributes&&g[0].attributes["data-element"]&&"dropmark"===g[0].attributes["data-element"].value){a=g;break}}return a};this.dropMark=function(b,d){d||(d=a.getDropMarkWindow());if(d){var c="none";this.options.allowDrop&&(c=b?"block":"none");angular.element(d).css("display",c)}};this.updateDropMarkElem=function(a,d){a&&d&&(a.css("top",d.top+"px"),a.css("left",d.left+"px"),a.css("width",d.width+"px"))};var aa=!1,r=angular.element('<input type="text" style="width:98%" />');this.labelEditStatus=function(a){if(a)aa=a;else return aa};this.getEditBox=function(){return r};this.updateEditBox=function(a){r&&a&&(r.css("top",a.top+"px"),r.css("left",a.left+"px"),r.css("width",a.width+"px"))};this.allowEvents=!0;this.callAfterCollapse=function(a){angular.isDefined(c.events)&&c.events.afterCollapse&&c.events.afterCollapse({row:a});c.afterCollapse({e:{row:a}})};this.callAfterExpand=function(a){angular.isDefined(c.events)&&c.events.afterExpand&&c.events.afterExpand({row:a});c.afterExpand({e:{row:a}})};this.callAfterEdit=function(a){angular.isDefined(c.events)&&c.events.afterLabelEdit&&c.events.afterLabelEdit({cell:a});c.afterLabelEdit({e:{cell:a}})};this.callAfterSelect=function(a){angular.isDefined(c.events)&&c.events.afterSelect?c.events.afterSelect({object:a}):c.afterSelect({e:{object:a}});angular.isDefined(c.events)&&c.events.selectionChanged?c.events.selectionChanged({object:a}):c.selectionChanged({e:{object:a}})};this.callBeforeCollapse=function(a){var d=!0;return d=angular.isDefined(c.events)&&c.events.beforeCollapse?c.events.beforeCollapse({row:a}):c.beforeCollapse({e:{row:a}})};this.callBeforeExpand=function(a){var d=!0;return d=angular.isDefined(c.events)&&c.events.beforeExpand?c.events.beforeExpand({row:a}):c.beforeExpand({e:{row:a}})};this.callBeforeEdit=function(a){var d=!0;return d=angular.isDefined(c.events)&&c.events.beforeLabelEdit?c.events.beforeLabelEdit({cell:a}):c.beforeLabelEdit({e:{cell:a}})};this.callCellValueChanging=function(b,d,x){var g=!0;a.allowEvents&&(g=angular.isDefined(c.events)&&c.events.cellvalueChanging?c.events.cellvalueChanging({row:b,cell:d,value:x}):c.cellvalueChanging({e:{row:b,cell:d,value:x}}));return g};this.callCellValueChanged=function(b,d,x){a.allowEvents&&(angular.isDefined(c.events)&&c.events.cellvalueChanged?c.events.cellvalueChanged({row:b,cell:d,value:x}):c.cellvalueChanged({e:{row:b,cell:d,value:x}}))};this.callColumnClick=function(a,d){angular.isDefined(c.events)&&c.events.columnClick&&c.events.columnClick({column:a,mousePos:d});c.columnClick({e:{column:a,mousePos:d}})};this.callColumnDblClick=function(a,d){angular.isDefined(c.events)&&c.events.columnDblclick&&c.events.columnDblclick({column:a,mousePos:d});c.columnDblclick({e:{column:a,mousePos:d}})};this.callColumnHover=function(a){angular.isDefined(c.events)&&c.events.columnHover&&c.events.columnHover({column:a});c.columnHover({e:{column:a}})};this.callColumnPosChanging=function(a,d){var x=!0;return x=angular.isDefined(c.events)&&c.events.columnPoschanging?c.events.columnPoschanging({sourceColumn:a,targetColumn:d}):c.columnPoschanging({e:{sourceColumn:a,targetColumn:d}})};this.callColumnPosChanged=function(a,d){angular.isDefined(c.events)&&c.events.columnPoschanged&&c.events.columnPoschanged({sourceColumn:a,targetColumn:d});c.columnPoschanged({e:{sourceColumn:a,targetColumn:d}})};this.callColumnRightClick=function(a,d){angular.isDefined(c.events)&&c.events.columnRightclick&&c.events.columnRightclick({column:a,mousePos:d});c.columnRightclick({e:{column:a,mousePos:d}})};this.callColumnSizeChanged=function(a,d){angular.isDefined(c.events)&&c.events.columnSizechanged&&c.events.columnSizechanged({column:a});c.columnSizechanged({e:{column:a}})};this.callDragEnter=function(a){angular.isDefined(c.events)&&c.events.dragEnter?c.events.dragEnter({sourceTree:a.sourceTree,dragRow:a.dragRow,targetTree:a.targetTree,targetRow:a.targetRow,mousePos:a.mousePos}):c.dragEnter({e:{sourceTree:a.sourceTree,dragRow:a.dragRow,targetTree:a.targetTree,targetRow:a.targetRow,mousePos:a.mousePos}})};this.callDragOver=function(a){var d=!0;return d=angular.isDefined(c.events)&&c.events.dragOver?c.events.dragOver({sourceTree:a.sourceTree,dragRow:a.dragRow,targetTree:a.targetTree,targetRow:a.targetRow,isDropAllowed:a.isDropAllowed,dropPos:a.dropPos,mousePos:a.mousePos}):c.dragOver({e:{sourceTree:a.sourceTree,dragRow:a.dragRow,targetTree:a.targetTree,targetRow:a.targetRow,isDropAllowed:a.isDropAllowed,dropPos:a.dropPos,mousePos:a.mousePos}})};this.callDragDrop=function(a){var d=!0;return d=angular.isDefined(c.events)&&c.events.dragDrop?c.events.dragDrop({sourceTree:a.sourceTree,dragRow:a.dragRow,targetTree:a.targetTree,targetRow:a.targetRow,isDropAllowed:a.isDropAllowed,dropPos:a.dropPos,mousePos:a.mousePos}):c.dragDrop({e:{sourceTree:a.sourceTree,dragRow:a.dragRow,targetTree:a.targetTree,targetRow:a.targetRow,isDropAllowed:a.isDropAllowed,dropPos:a.dropPos,mousePos:a.mousePos}})};this.callDragLeave=function(a){angular.isDefined(c.events)&&c.events.dragLeave?c.events.dragLeave({sourceTree:a.sourceTree,dragRow:a.dragRow,targetTree:a.targetTree,targetRow:a.targetRow,mousePos:a.mousePos}):c.dragLeave({e:{sourceTree:a.sourceTree,dragRow:a.dragRow,targetTree:a.targetTree,targetRow:a.targetRow,mousePos:a.mousePos}})};this.callCellClick=function(a,d,x){angular.isDefined(c.events)&&c.events.cellClick&&c.events.cellClick({row:a,cell:d,mousePos:x});c.cellClick({e:{row:a,cell:d,mousePos:x}})};this.callRowClick=function(a,d){angular.isDefined(c.events)&&c.events.rowClick&&c.events.rowClick({row:a,mousePos:d});c.rowClick({e:{row:a,mousePos:d}})};this.callRowDblClick=function(a,d){angular.isDefined(c.events)&&c.events.rowDblClick&&c.events.rowDblClick({row:a,mousePos:d});c.rowDblclick({e:{row:a,mousePos:d}})};this.callRowHover=function(a){angular.isDefined(c.events)&&c.events.rowHover&&c.events.rowHover({row:a});c.rowHover({e:{row:a}})};this.callRowRightClick=function(a,d){angular.isDefined(c.events)&&c.events.rowRightClick&&c.events.rowRightClick({row:a,mousePos:d});c.rowRightclick({e:{row:a,mousePos:d}})};this.callKeyDown=function(a,d){angular.isDefined(c.events)&&c.events.keyDown?c.events.keyDown({event:a,row:d}):c.keyDown({e:{event:a,row:d}})};this.callKeyPress=function(a,d){angular.isDefined(c.events)&&c.events.keyPress?c.events.keyPress({event:a,row:d}):c.keyPress({e:{event:a,row:d}})};this.callKeyUp=function(a,d){angular.isDefined(c.events)&&c.events.keyUp?c.events.keyUp({event:a,row:d}):c.keyUp({e:{event:a,row:d}})};this.callScrollPosChanged=function(){angular.isDefined(c.events)&&c.events.scrollPosChanged?c.events.scrollPosChanged({scrollPos:a.scrollPos}):c.scrollposChanged({e:{scrollPos:a.scrollPos}})};k.bind("click",function(b){1===b.which&&a.callRowClick(null,a.getMousePos(b))});k.bind("dblclick",function(b){b.preventDefault();1===b.which&&a.callRowDblClick(null,a.getMousePos(b));b.stopPropagation()});k.bind("mousedown",function(b){3===b.which&&a.callRowRightClick(null,a.getMousePos(b));b.stopPropagation()});this.toggle=function(b,d){if(b){if(b[a.options.rowFields.hasChildren]||b[a.options.rowFields.rows]&&0!==b[a.options.rowFields.rows].length){if(d&&!1!==b[a.options.rowFields.expanded]||!1===d&&!1===b[a.options.rowFields.expanded])return}else return;a.updateType="view";var c=void 0!==d?d:!1!==b[a.options.rowFields.expanded]?!0:!1,g=!0,g=void 0!==d?d?a.callBeforeExpand(b):a.callBeforeCollapse(b):c?a.callBeforeCollapse(b):a.callBeforeExpand(b);!1!==g&&(g=b[a.options.rowFields.expanded],b[a.options.rowFields.expanded]=void 0!==d?d:!c,b[a.options.rowFields.expanded]?a.callAfterExpand(b):a.callAfterCollapse(b),g!==b[a.options.rowFields.expanded]&&a.updateLayout())}else{a.suspendLayout();c=a.getFullList();for(g=0;g<c.length;g++)a.toggle(c[g],d);a.resumeLayout()}a.updateType="all"};c.$on(c.name+"-begin-load",function(b,d){a.options.loadRow=d});c.$on(c.name+"-collapse",function(b,d){a.toggle(d,!1)});c.$on(c.name+"-end-load",function(b){a.options.loadRow=null});c.$on(c.name+"-expand",function(b,d){a.toggle(d,!0)});c.$on(c.name+"-expand-col-index",function(b,d){0<=d&&d<a.columnList.length&&(a.options.expandColIndex=d)});c.$on(c.name+"-toggle",function(b,d){a.toggle(d)});c.$on(c.name+"-filter",function(b,d){l.setTempData(a.filter(d))});this.filter=function(a){};this.getTabIndex=function(){return k[0].attributes&&k[0].attributes.tabindex?k[0].attributes.tabindex.value:""};this.updateFocus=function(b,d){if(1==a.options.allowFocus)var c=e(function(){if(a.isRowIndexInRange(b)){var g=a.getElemFromRow(a.currentList[b]);g&&(1==a.options.allowCellFocus&&0<=d&&d<a.columnList.length?(g=a.getElemFromCell(b,d))&&g[0].focus():g[0].focus())}else k[0].focus();e.cancel(c)},5)};c.$on(c.name+"-focus",function(b,d,c){a.updateFocus(d,c)});var la=!1;this.getCell=function(b,d){if(0<=b&&b<a.currentList.length){var c=a.currentList[b],g=d;0<=d&&d<a.columnList.length&&(g=a.getCellIndexById(c[a.options.rowFields.cells],b,d,a.columnList[d].id));if(c[a.options.rowFields.cells]&&0<=g&&g<c[a.options.rowFields.cells].length)return c[a.options.rowFields.cells][g]}return null};this.getCellObject=function(b,d){if(0<=b&&b<a.currentList.length){var c=a.currentList[b],g=d;0<=d&&d<a.columnList.length&&(g=a.getCellIndexById(c[a.options.rowFields.cells],b,d,a.columnList[d].id));if(c[a.options.rowFields.cells]&&0<=g&&g<c[a.options.rowFields.cells].length)return c[a.options.rowFields.cells][g]}return null};this.getCellIndexById=function(b,d,c,g){b=-1;if(d=a.currentList[d][a.options.rowFields.cells])for(var f=0;f<d.length;f++)if(void 0==d[f][a.options.cellFields.cid]){b=c;break}else if(d[f][a.options.cellFields.cid]==g){b=f;break}return b};this.getCellIndexFromRow=function(b,d){var c=-1;if(b&&d&&d[a.options.rowFields.cells])for(var g=0;g<d[a.options.rowFields.cells].length;g++)if(d[a.options.rowFields.cells][g]==b){c=g;break}return c};this.getColumnById=function(b){for(var d=null,c=0;c<a.columnList.length;c++)if(a.columnList[c][a.options.columnFields.id]==b){d=a.columnList[c];break}return d};this.getColumnObject=function(b){return 0<=b&&b<a.columnList.length?a.columnList[b]:null};this.getRowObject=function(b){return 0<=b&&b<a.currentList.length?a.currentList[b]:null};this.isRowExpanded=function(b){return b?b[a.options.rowFields.expanded]||void 0===b[a.options.rowFields.expanded]?!0:!1:!0};this.getContentElement=function(a,d){d||(d="cell-content");if(a&&0<a.children().length){var c=angular.element(a.children().eq(0));if(c&&c[0].attributes&&c[0].attributes["data-element"]&&c[0].attributes["data-element"].value==d)return c}return null};this.getElement=function(a,d){var c=null;d||(d="cell-content");if(a&&0<a.children().length){a=a.children().eq(0);for(var g=a.children(),f=0;f<g.length;f++){var e=angular.element(g.eq(f));if(e[0].attributes&&e[0].attributes["data-element"]&&e[0].attributes["data-element"].value==d){c=e;break}}}return c};this.getChildElement=function(a,d){var c=null;d||(d="content");if(a&&0<a.children().length)for(var g=a.children(),f=0;f<g.length;f++){var e=angular.element(g.eq(f));if(e[0].attributes&&e[0].attributes["data-element"]&&e[0].attributes["data-element"].value==d){c=e;break}}return c};this.getElemFromColumn=function(b,d){var c=null;if(b){var g=a.getColumnCurrentIndex(b),f=a.getHeaderElem();"footer"==d&&(f=a.getFooterElem());if(f&&(f=f.find("td"))&&0<f.length)for(var e=0;e<f.length;e++){var h=angular.element(f[e]);if(h[0].attributes["data-index"]&&h[0].attributes["data-index"].value.toString()===g.toString()){c=h;break}}}return c};this.getElemFromRow=function(b){var c=null;if(b){b=a.getRowCurrentIndex(b);var f=a.getRowElems();if(f&&0<f.length)for(var g=0;g<f.length;g++){var e=angular.element(f[g]);if(e[0].attributes["data-index"]&&e[0].attributes["data-index"].value.toString()===b.toString()){c=e;break}}}return c};this.getElemFromCell=function(b,c){var f=null;if(0<=b&&b<a.currentList.length){var g=a.getElemFromRow(a.currentList[b]);if(g&&(g=g.find("td"))&&0<g.length)for(var e=0;e<g.length;e++){var h=angular.element(g[e]);if(h[0].attributes["data-index"]&&h[0].attributes["data-index"].value.toString()===c.toString()){f=h;break}}}return f};this.getIndent=function(b){var c=0;if(b)for(parent=a.rowsObj.getParent(b);parent;)c+=a.options.indent,parent=a.rowsObj.getParent(parent);return c};this.getObjState=function(b){if(b)switch(b.type){case "column":if(1==b.selected)return"selected";if(b==a.hoverColumn)return"hovered";break;case "row":if(0==b[a.options.rowFields.enabled])return"disabled";if(1==b.selected)return"selected";if(b==a.hoverRow)return"hovered";break;case "cell":if(0==b[a.options.cellFields.enabled])return"disabled";if(1==b.selected)return"selected";if(b==a.hoverCell)return"hovered"}return"normal"};this.getRowAt=function(b,c){var e=null,g=null,h=null,l=a.getRowElems();if(l&&0<l.length)for(var k=0;k<l.length;k++)if(e=angular.element(l[k]),g=f.getPageRect(e),f.checkHit(b,c,g)){h=a.getRowFromElem(e);break}return h};this.getRowCurrentIndex=function(b){return b&&a.currentList?a.currentList.indexOf(b):-1};this.getObjCurrentIndex=function(b){return a.getRowCurrentIndex(b)};this.getRowFromChildElem=function(b){if(b&&(b=angular.element(b))){for(b=b.parent();b&&b[0].tagName&&"tr"!==b[0].tagName.toLowerCase();)b=b.parent();return b?a.getRowFromElem(b):null}return null};this.getColumnCurrentIndex=function(b){return b&&a.columnList?a.columnList.indexOf(b):-1};this.getColumnFromChildElem=function(b){return b?a.getColumnFromElem(b):null};this.getColumnFromElem=function(b){return b&&(b=angular.element(b))&&b[0].attributes["data-index"]&&(b=b[0].attributes["data-index"].value,0<=b&&b<a.columnList.length)?a.columnList[b]:null};this.getIndexFromElem=function(a){return a&&(a=angular.element(a))&&a[0].attributes["data-index"]?a[0].attributes["data-index"].value:-1};this.getRowFromElem=function(b){if(b&&(b=angular.element(b))&&b[0].attributes["data-index"]&&(b=b[0].attributes["data-index"].value,a.isRowIndexInRange(b)))return a.currentList[b]};this.isRowIndexInRange=function(b){return 0<=b&&b<a.currentList.length};this.isColIndexInRange=function(b){return 0<=b&&b<a.columnList.length};this.isRowEnabled=function(b){return f.isEnabled(b[a.options.rowFields.enabled])};this.mouseButtonStatus=function(a){la=a};c.$on(c.name+"-ensure-visible",function(b,c){a.ensureVisible(c)});c.$on(c.name+"-find-row-by-id",function(b,c){l.setTempData(a.findRowById(c))});c.$on(c.name+"-find-row-by-text",function(b,c){l.setTempData(a.findRowByText(c))});c.$on(c.name+"-get-full-path",function(b,c){l.setTempData(a.getFullPath(c))});c.$on(c.name+"-get-row-level",function(b,c){l.setTempData(a.getLevel(c))});c.$on(c.name+"-get-row-parent",function(b,c){l.setTempData(a.getParent(c))});c.$on(c.name+"-get-flat-list",function(b,c){c?l.setTempData(a.getFullList()):l.setTempData(a.currentList)});c.$on(c.name+"-get-list",function(b,c){l.setTempData(a.getList(c))});this.ensureVisible=function(b){if(b){a.suspendLayout();for(var c=[],f=a.getParent(b);f;)c.push(f),f=a.getParent(f);for(f=c.length-1;0<=f;f--)a.toggle(c[f],!0);a.resumeLayout();a.scrollTo(b,"center")}};this.findRowById=function(b){return a.rowsObj.findObjectById(b)};this.findRowByText=function(b){return a.rowsObj.findObjectByText(b)};this.getFullPath=function(b){var c="";if(b)for(c=b[a.options.rowFields.text],b=a.getParent(b);b;)c=[b[a.options.rowFields.text],a.options.pathSeparator,c].join(""),b=a.getParent(b);return c};this.getLevel=function(a){var c=0;for(a=this.getParent(a);a;)c++,a=this.getParent(a);return c};this.getParent=function(b){return a.rowsObj.getParent(b)};this.getList=function(b){return a.rowsObj.getList(b)};this.getFirstRow=function(){for(var b=null,c=0;c<a.currentList.length;c++)if(f.isEnabled(a.currentList[c][a.options.rowFields.enabled])){b=a.currentList[c];break}return b};this.getPrevRow=function(b){var c=null;if(0<=b&&b<a.currentList.length)for(--b;0<=b;b--)if(f.isEnabled(a.currentList[b][a.options.rowFields.enabled])){c=a.currentList[b];break}return c};this.getNextRow=function(b){var c=null;for(b+=1;b<a.currentList.length;b++)if(f.isEnabled(a.currentList[b][a.options.rowFields.enabled])){c=a.currentList[b];break}return c};this.getLastRow=function(){for(var b=null,c=a.currentList.length-1;0<=c;c--)if(f.isEnabled(a.currentList[c][a.options.rowFields.enabled])){b=a.currentList[c];break}return b};this.updateSelectionStatus=function(b){switch(b){case "shift":switch(a.options.selectionMode){case "multi-simple":a.multiSelection(!0);a.shiftKeyStatus(!1);break;case "multi-extended":a.multiSelection(!0);a.shiftKeyStatus(!0);break;default:a.multiSelection(!1),a.shiftKeyStatus(!1)}break;case "ctrl":switch(a.options.selectionMode){case "multi-simple":a.multiSelection(!0);break;case "multi-extended":a.multiSelection(!0);break;default:a.multiSelection(!1)}}};k.bind("keydown",function(b){switch(b.keyCode){case 16:a.updateSelectionStatus("shift");break;case 17:a.updateSelectionStatus("ctrl");break;default:(b.ctrlKey||b.metaKey)&&a.updateSelectionStatus("ctrl"),b.shiftKey&&a.updateSelectionStatus("shift")}});this.allowUpdate=!0;this.updateType="all";this.suspendLayout=function(){a.allowUpdate=!1};this.resumeLayout=function(){a.allowUpdate=!0;a.updateLayout()};c.$on(c.name+"-refresh",function(b,c,f){a.refresh(c,f)});c.$on(c.name+"-resume-layout",function(b){a.resumeLayout()});c.$on(c.name+"-suspend-layout",function(b){a.suspendLayout()});c.$on(c.name+"-update-layout",function(b){a.updateLayout()});c.$on(c.name+"-update-view",function(b){a.updateView()});c.$on(c.name+"-get-scroll-pos",function(b){l.setTempData(a.getScrollPos())});c.$on(c.name+"-set-scroll-pos",function(b,c){a.setScrollPos(c)});c.$on(c.name+"-scroll-to",function(b,c,f){a.scrollTo(c,f)});var ba=!1,U=!1;this.shiftKeyStatus=function(a){if(void 0!=a)ba=a;else return ba};this.multiSelection=function(a){if(void 0!=a)U=a;else return U};this.columnSelection=function(b,d){if(b){var e=!0;a.options.selectedColumn&&(e=!f.isEqual(a.options.selectedColumn[a.options.columnFields.id],b[a.options.columnFields.id]));var g=!0,g=angular.isDefined(c.events)&&c.events.beforeSelect?c.events.beforeSelect({object:b}):c.beforeSelect({e:{object:b}});e&&!1!==g&&(a.options.selectedColumn&&(a.options.selectedColumn.selected=!1,a.refresh(a.options.selectedColumn)),a.options.selectedColumn=b,b.selected=!0,angular.isDefined(c.selectedColumn)&&(c.selectedColumn=b),a.callAfterSelect(b),a.refresh(a.options.selectedColumn))}else return a.options.selectedColumn};this.isRowSelected=function(a){return f.isSelected(a)};this.clearPrevSelection=function(b){for(var c=0;c<a.options.selectedRows.length;c++)b&&!f.isEqual(a.options.selectedRows[c][a.options.rowFields.id],b[a.options.rowFields.id])?a.options.selectedRows[c].selected=!1:b||(a.options.selectedRows[c].selected=!1);a.options.selectedRows.length=0;b&&0!=b[a.options.rowFields.enabled]&&a.options.selectedRows.push(b);a.refresh()};this.markSelColumn=function(){for(var b=0;b<a.columnList.length;b++)a.refresh(a.columnList[b])};this.rowSelection=function(b,d){if(b){if("none"!==a.options.selectionMode)if(0==b[a.options.rowFields.enabled])a.clearPrevSelection();else{var e=a.rowSelection(),g=!0;e&&(g=!f.isEqual(e[a.options.rowFields.id],b[a.options.rowFields.id]));var h=!0,h=angular.isDefined(c.events)&&c.events.beforeSelect?c.events.beforeSelect({object:b}):c.beforeSelect({e:{object:b}});if(!1!==h)if(g){g=!0;"multi-extended"===a.options.selectionMode&&(g=!a.isObjInSelList(b));g&&(la&&ba?a.clearPrevSelection():U||"multi-simple"===a.options.selectionMode||a.clearPrevSelection());a.options.selectedRow=b;if(la&&ba){if(g=a.getRowCurrentIndex(e),e=a.getRowCurrentIndex(b),g>e&&(h=g,g=e,e=h),a.isRowIndexInRange(g)&&a.isRowIndexInRange(e))for(;g<=e;g++)a.currentList[g].selected=!0,a.options.selectedRows.push(a.currentList[g])}else la&&(U||"multi-simple"===a.options.selectionMode)?(e=null===b.selected||"undefined"===b.selected?!1:b.selected,b.selected=!e,b.selected?a.isObjInSelList(b)||a.options.selectedRows.push(b):a.options.selectedRows=a.options.selectedRows.filter(function(a){return a!=b})):(b.selected=!0,a.isObjInSelList(b)||a.options.selectedRows.push(b));angular.isDefined(c.selectedRow)&&(c.selectedRow=b);a.callAfterSelect(b);a.refresh()}else if(U||"multi-simple"===a.options.selectionMode)e=null===b.selected||"undefined"===b.selected?!1:b.selected,d&&"undefined"!==d&&(e=d),b.selected=!e,b.selected?a.isObjInSelList(b)||a.options.selectedRows.push(b):a.options.selectedRows=a.options.selectedRows.filter(function(a){return a!=b}),a.callAfterSelect(b),a.refresh()}}else return a.options.selectedRow};this.updateSelection=function(b){"multi-simple"!==a.options.selectionMode&&0<a.options.selectedRows.length&&!ba&&!U&&a.clearPrevSelection(b)};this.selectFirstRow=function(){for(var b=null,c=0;c<a.currentList.length;c++)if(a.isRowEnabled(a.currentList[c])){b=a.currentList[c];break}this.rowSelection(b);return a.options.selectedRow};this.isObjInSelList=function(b){var c=!1,e=a.options.selectedRows;if(b&&e)for(var g=0;g<e.length;g++)if(f.isEqual(e[g][a.options.rowFields.id],b[a.options.rowFields.id])){c=!0;break}return c};this.markSelRows=function(){var b=a.getRowElems();if(b&&0<b.length)for(var c=0;c<b.length;c++){var f=a.getRowFromElem(b[c]);f&&a.refresh(f)}};c.$on(c.name+"-get-selected-column",function(b){l.setTempData(a.columnSelection())});c.$on(c.name+"-set-selected-column",function(b,c){a.columnSelection(c)});c.$on(c.name+"-get-selected-row",function(b){l.setTempData(a.rowSelection())});c.$on(c.name+"-set-selected-row",function(b,c){a.rowSelection(c)});c.$on(c.name+"-get-selected-rows",function(b){l.setTempData(a.options.selectedRows)});c.$watch("options.allowCellFocus",function(b,c){b!==c&&(a.options.allowCellFocus=b)});c.$watch("allowCellFocus",function(b,c){b!==c&&(a.options.allowCellFocus=b)});c.$watch("options.allowColumnReorder",function(b,c){b!==c&&(a.options.allowColumnReorder=b)});c.$watch("allowColumnReorder",function(b,c){b!==c&&(a.options.allowColumnReorder=b)});c.$watch("options.allowFocus",function(b,c){b!==c&&(a.options.allowFocus=b)});c.$watch("allowFocus",function(b,c){b!==c&&(a.options.allowFocus=b)});c.$watch("options.allowDrag",function(b,c){b!==c&&(a.options.allowDrag=b,a.updateView())});c.$watch("allowDrag",function(b,c){b!==c&&(a.options.allowDrag=b,a.updateView())});c.$watch("options.allowDrop",function(b,c){b!==c&&(a.options.allowDrop=b,a.updateView())});c.$watch("allowDrop",function(b,c){b!==c&&(a.options.allowDrop=b,a.updateView())});c.$watch("controlStyle",function(b,c){b!==c&&a.updateControlStyle(b)});c.$watch("fields",function(b,c){b!==c&&(a.updateDataFields(b),a.UpdateData())});c.$watch("options.fillSpace",function(b,c){b!==c&&(a.options.fillSpace=b)});c.$watch("fillSpace",function(b,c){b!==c&&(a.options.fillSpace=b)});c.$watch("options.gridLines",function(b,c){b!==c&&(a.options.gridLines=b,a.updateView())});c.$watch("gridLines",function(b,c){b!==c&&(a.options.gridLines=b,a.updateView())});c.$watch("options.hoverSelection",function(b,c){b!==c&&(a.options.hoverSelection=b)});c.$watch("hoverSelection",function(b,c){b!==c&&(a.options.hoverSelection=b)});c.$watch("options.rowIcon",function(b,c){b!==c&&(a.options.rowIcon=b,a.updateLayout())});c.$watch("rowIcon",function(b,c){b!==c&&(a.options.rowIcon=b,a.updateLayout())});c.$watch("options.labelEdit",function(b,c){b!==c&&(a.options.labelEdit=b)});c.$watch("labelEdit",function(b,c){b!==c&&(a.options.labelEdit=b)});c.$watch("options.pathSeparator",function(b,c){b!==c&&(a.options.pathSeparator=b)});c.$watch("pathSeparator",function(b,c){b!==c&&(a.options.pathSeparator=b)});c.$watch("options.rtl",function(b,c){b!==c&&(a.options.rtl=b,a.updateLayout())});c.$watch("rtl",function(b,c){b!==c&&(a.options.rtl=b,a.updateLayout())});a.resetSelection=function(){switch(a.options.selectionMode){case "none":a.clearPrevSelection();break;default:a.clearPrevSelection(a.rowSelection())}};c.$watch("options.selectionMode",function(b,c){b!==c&&(a.options.selectionMode=b,a.resetSelection())});c.$watch("selectionMode",function(b,c){b!==c&&(a.options.selectionMode=b,a.resetSelection())});c.$watch("options.showFooter",function(b,c){b!==c&&(a.options.showFooter=b,a.updateLayout())});c.$watch("showFooter",function(b,c){b!==c&&(a.options.showFooter=b,a.updateLayout())});c.$watch("options.showHeader",function(b,c){b!==c&&(a.options.showHeader=b,a.updateLayout())});c.$watch("showHeader",function(b,c){b!==c&&(a.options.showHeader=b,a.updateLayout())});c.$watch("options.showIcons",function(b,c){b!==c&&(a.options.showIcons=b,a.updateLayout())});c.$watch("showIcons",function(b,c){b!==c&&(a.options.showIcons=b,a.updateLayout())});c.$watch("options.selectedRow",function(b,c){b!==c&&(c&&(c.selected=!1),a.options.selectedRow=b,a.callAfterSelect(b))});c.$watch("selectedRow",function(b,c){b!==c&&(c&&(c.selected=!1),a.options.selectedRow=b,a.callAfterSelect(b))});var pa=function(b){if(b){var c=f.isFieldAvailable(b.general,"iui-treegrid-column"),e;e=(e=b.header)?{content:f.isFieldAvailable(e.content,"iui-treegrid-column-header-cell-content"),disabled:f.isFieldAvailable(e.disabled,"iui-treegrid-column-header-disabled"),normal:f.isFieldAvailable(e.normal,"iui-treegrid-column-header"),hovered:f.isFieldAvailable(e.hovered,"iui-treegrid-column-header-hovered"),selected:f.isFieldAvailable(e.selected,"iui-treegrid-column-header-selected")}:a.options.controlStyle.column.header;b=(b=b.footer)?{content:f.isFieldAvailable(b.content,"iui-treegrid-column-footer-cell-content"),disabled:f.isFieldAvailable(b.disabled,"iui-treegrid-column-footer-disabled"),normal:f.isFieldAvailable(b.normal,"iui-treegrid-column-footer"),hovered:f.isFieldAvailable(b.hovered,"iui-treegrid-column-footer-hovered"),selected:f.isFieldAvailable(b.selected,"iui-treegrid-column-footer-selected")}:a.options.controlStyle.column.footer;return{general:c,header:e,footer:b}}return a.options.controlStyle.column};this.getExpandBoxStyle=function(b){return b?{general:f.isFieldAvailable(b.general,"iui-treegrid-expand-box"),animated:f.isFieldAvailable(b.animated,"iui-treegrid-expand-box-load"),expanded:f.isFieldAvailable(b.expanded,"iui-treegrid-expand-box-open"),collapsed:f.isFieldAvailable(b.collapsed,"iui-treegrid-expand-box-close")}:a.options.controlStyle.row.expandBox};var qa=function(b){if(b){var c;c=(c=b.general)?{disabled:f.isFieldAvailable(c.disabled,"iui-treegrid-row-disabled"),focused:f.isFieldAvailable(c.focused,"iui-treegrid-row-focused"),normal:f.isFieldAvailable(c.normal,"iui-treegrid-row"),hovered:f.isFieldAvailable(c.hovered,"iui-treegrid-row-hovered"),selected:f.isFieldAvailable(c.selected,"iui-treegrid-row-selected")}:a.options.controlStyle.row.general;var e;var g=b.checkBox;g?(e=f.isFieldAvailable(g.general,"iui-checkbox"),g=(g=g.box)?{general:f.isFieldAvailable(g.general,"iui-checkbox-box"),disabled:f.isFieldAvailable(g.disabled,"iui-checkbox-disabled"),checked:f.isFieldAvailable(g.checked,"iui-checkbox-checked"),indeterminate:f.isFieldAvailable(g.indeterminate,"iui-checkbox-indeterminate"),unchecked:f.isFieldAvailable(g.unchecked,"iui-checkbox-unchecked")}:a.options.controlStyle.row.checkBox.box,e={general:e,box:g}):e=a.options.controlStyle.row.checkBox;g=a.getExpandBoxStyle(b.expandBox);b=(b=b.cell)?{content:f.isFieldAvailable(b.content,"iui-treegrid-row-cell-content"),general:f.isFieldAvailable(b.general,"iui-treegrid-row-cell"),disabled:f.isFieldAvailable(b.disabled,"iui-treegrid-row-cell-disabled"),focused:f.isFieldAvailable(b.focused,"iui-treegrid-row-cell-focused"),normal:f.isFieldAvailable(b.normal,"iui-treegrid-row-cell"),hovered:f.isFieldAvailable(b.hovered,"iui-treegrid-row-cell-hovered"),selected:f.isFieldAvailable(b.selected,"iui-treegrid-row-cell-selected")}:a.options.controlStyle.row.cell;return{general:c,checkBox:e,expandBox:g,cell:b}}return a.options.controlStyle.row},y=function(b){return b?{content:f.isFieldAvailable(b.content,"iui-treegrid-row-cell-content"),general:f.isFieldAvailable(b.general,"iui-treegrid-row-cell"),disabled:f.isFieldAvailable(b.disabled,"iui-treegrid-row-cell-disabled"),focused:f.isFieldAvailable(b.focused,"iui-treegrid-row-cell-focused"),normal:f.isFieldAvailable(b.normal,"iui-treegrid-row-cell"),hovered:f.isFieldAvailable(b.hovered,"iui-treegrid-row-cell-hovered"),selected:f.isFieldAvailable(b.selected,"iui-treegrid-row-cell-selected")}:a.options.controlStyle.cell};this.updateControlStyle=function(b){a.options.controlStyle=b?{general:f.isFieldAvailable(b.general,"iui-treegrid"),column:pa(b.column),row:qa(b.row),cell:y(b.cell)}:{general:f.isFieldAvailable(a.defaultStyle.general,"iui-treegrid"),column:pa(a.defaultStyle.column),row:qa(a.defaultStyle.row),cell:y(a.defaultStyle.cell)}};this.getCurrentColumnStyle=function(b,c,e){var f=a.options.controlStyle.column;b&&b.style&&(f=b.style);b=a.options.controlStyle.column.body;var h=f.body;switch(c){case "header":b=a.options.controlStyle.column.header;h=f.header;break;case "footer":b=a.options.controlStyle.column.footer,h=f.footer}if(e)switch(e){case "content":return h&&h.content?h.content:b.content;case "disabled":return h&&h.disabled?h.disabled:b.disabled;case "hovered":return h&&h.hovered?h.hovered:b.hovered;case "selected":return h&&h.selected?h.selected:b.selected;default:return h&&h.normal?h.normal:b.normal}else return c?h?h:b:f?f:a.options.controlStyle.column};this.getCurrentRowStyle=function(b,c){var e=a.options.controlStyle.row;if(b)switch(b.style){case "initial":break;case "parent":return a.getCurrentRowStyle(a.getParent(b),c);default:null!=b.style&&(e=b.style)}if(c){if(f.isString(e.general))return e.general;switch(c){case "disabled":return e.general&&e.general.disabled?e.general.disabled:a.options.controlStyle.row.general.disabled;case "focused":return e.general&&e.general.focused?e.general.focused:a.options.controlStyle.row.general.focused;case "hovered":return e.general&&e.general.hovered?e.general.hovered:a.options.controlStyle.row.general.hovered;case "selected":return e.general&&e.general.selected?e.general.selected:a.options.controlStyle.row.general.selected;default:return e.general&&e.general.normal?e.general.normal:a.options.controlStyle.row.general.normal}}else return e?e:a.options.controlStyle.row};this.getDefaultCellContentClass=function(){return"iui-treegrid-row-cell-content"};this.getDefaultCellLabelClass=function(){return"iui-treegrid-row-cell-label"};this.getDefaultCellBorderClass=function(){return"iui-treegrid-lines-both"};this.getCurrentCellStyle=function(b,c,e){var f=a.options.controlStyle.row.cell;if(c)switch(c.style){case "initial":break;case "parent":b&&(f=y(a.getCurrentRowStyle(b)));break;default:c.style&&(f=c.style)}if(e)switch(e){case "content":return f.content?f.content:a.options.controlStyle.cell.content;case "disabled":return f.disabled?f.disabled:a.options.controlStyle.cell.disabled;case "focused":return f.focused?f.focused:a.options.controlStyle.cell.focused;case "hovered":return f.hovered?f.hovered:a.options.controlStyle.cell.hovered;case "selected":return f.selected?f.selected:a.options.controlStyle.cell.selected;default:return f.normal?f.normal:a.options.controlStyle.cell.normal}else return f?f:a.options.controlStyle.row.cell}}]).directive("iuiTreegrid",["$compile","$timeout","$interval","IntegralUIInternalService","IntegralUIDragDrop","$window",function(c,k,e,h,f,T){return{restrict:"EA",controller:"IntegralUITreeGridController",transclude:!0,replace:!0,template:'<div class="iui-treegrid" data-element="treegrid"><div class="iui-treegrid-block"></div></div>',scope:{allowAnimation:"=",allowCellFocus:"=",allowColumnReorder:"=",allowFocus:"=",allowDrag:"=",allowDrop:"=",animationSpeed:"=",columns:"=",controlStyle:"=",fields:"=",fillSpace:"=",gridLines:"=",hoverSelection:"=",labelEdit:"=",name:"@",options:"=?",pathSeparator:"@",rowIcon:"=",rows:"=",selectedIndex:"=",selectedRow:"=",selectionMode:"@",showFooter:"=",showHeader:"=",showIcons:"=",afterCollapse:"&",afterExpand:"&",afterLabelEdit:"&",afterSelect:"&",beforeCollapse:"&",beforeExpand:"&",beforeLabelEdit:"&",beforeSelect:"&",cellClick:"&",cellvalueChanged:"&",cellvalueChanging:"&",clearColumns:"&",clearRows:"&",columnAdded:"&",columnAdding:"&",columnClick:"&",columnDblclick:"&",columnHover:"&",columnPoschanging:"&",columnPoschanged:"&",columnRemoved:"&",columnRemoving:"&",columnRightclick:"&",columnSizechanged:"&",dragDrop:"&",dragEnter:"&",dragLeave:"&",dragOver:"&",events:"=?",keyDown:"&",keyPress:"&",keyUp:"&",rowAdded:"&",rowAdding:"&",rowClick:"&",rowDblclick:"&",rowHover:"&",rowRemoved:"&",rowRemoving:"&",rowRightclick:"&",scrollposChanged:"&",selectionChanged:"&"},link:function(l,n,Fa,a,Na){var t=this,J=n.children().eq(0),B=angular.element('<div class="iui-scrollbar-vertical"><div class="iui-scroll-button-thumb-vertical"></div></div>'),G=angular.element('<div class="iui-scrollbar-horizontal"><div class="iui-scroll-button-thumb-horizontal"></div></div>'),ka=angular.element('<div class="iui-scrollbar-corner"></div>'),M=null,K=null,aa=null,r=a.getEditBox(),la=function(){var b="iui-treegrid-block";a.options.showStatusIcons&&(b+=" "+b+"-shift-left");a.options.rtl&&(b+=" "+b+"-rtl");return b};l.$on("destroy",function(a){t.s2t();n.unbind("click dblclick dragenter dragleave dragend drop keydown mousedown mouseleave mousemove mousewheel scroll");angular.element(T).unbind("dragenter dragover dragend mousemove mouseup");r&&r.unbind("keydown blur");qa();ca&&ca.$destroy();V&&V.$destroy()});a.dragIcon=document.createElement("img");a.dragIcon.width=1;n.append(a.getDropMarkWindow());a.dropMark();a.addDropMark=function(){var b;b=n[0];for(var c=null;b;){if(b===document.getElementsByTagName("body")[0]){c=b;break}b=b.offsetParent}if(b=c)angular.element(b).append(a.getDropMarkWindow()),a.dropMark()};a.removeDropMark=function(){a.getDropMarkWindow().remove()};var ba=function(b,c){a.options.labelEdit&&(void 0===c&&(c=500),K=k(function(){if(K)var a=k(function(){U(b,!0);k.cancel(a)},c);k.cancel(K)},c/3))},U=function(b,c){var d=a.getRowFromChildElem(b);if(d){var d=a.getRowCurrentIndex(d),q=a.getIndexFromElem(b),F=a.getCellObject(d,q);if(F)if(c){if(!1!==a.callBeforeEdit(F)){a.labelEditStatus(!0);r.unbind("keydown blur");d=b.children().eq(0);d.empty();d.append(r);r[0].value=F[a.options.cellFields.text];r.bind("keydown",function(c){switch(c.keyCode){case 13:F[a.options.cellFields.text]=r[0].value?r[0].value:"null";l.$apply();U(b,!1);break;case 27:U(b,!1)}c.stopPropagation()});r.bind("blur",function(a){U()});var e=k(function(){r[0].focus();r[0].select();k.cancel(e)},10)}}else a.labelEditStatus(!1),r.unbind("keydown blur"),r.remove(),a.updateView(),a.updateFocus(d,q),a.callAfterEdit(F)}else a.labelEditStatus(!1),r.unbind("keydown blur"),r.remove(),a.callAfterEdit(),a.updateView()},pa=function(b){var c="",d=a.defaultStyle.row.expandBox.general;a.options.controlStyle.row.expandBox.general!=d&&(d+=" "+a.options.controlStyle.row.expandBox.general);var q=a.getCurrentRowStyle(b),q=a.getExpandBoxStyle(q.expandBox);if(a.isThereChildRows||b&&b[a.options.rowFields.hasChildren])c=d;b&&(b[a.options.rowFields.hasChildren]||b[a.options.rowFields.rows]&&0<b[a.options.rowFields.rows].length)&&(a.options.loadRow&&h.isEqual(b[a.options.rowFields.id],a.options.loadRow[a.options.rowFields.id])?c+=" "+q.animated:(c=b[a.options.rowFields.hasChildren]&&void 0===b[a.options.rowFields.expanded]?c+(" "+q.expanded):!1!==b[a.options.rowFields.expanded]?c+(" "+q.collapsed):c+(" "+q.expanded),!0===a.options.rtl&&(c+="-rtl"),a.isRowEnabled(b)||(c+="-disabled")));return c};n.bind("mousemove",function(c){if(0===c.button&&y&&b){a.getColumnCurrentIndex(b);var d=a.getMousePos(c),N=d.y+16,d=d.x+20;X.empty();X.append("<span>"+b[a.options.columnFields.headerText]+"</span>");X.css("top",N+"px");X.css("left",d+"px");X.css("display","block");Qa();c.stopPropagation()}});var qa=function(){var b=J.find("tr");if(0<b.length)for(var c=0;c<b.length;c++){(currentElem=angular.element(b[c]))&&currentElem.unbind("dragover dragend keydown keyup keypress mouseenter mouseleave");for(var d=currentElem.find("td"),q=0;q<d.length;q++){var F=angular.element(d[q]),e=a.getElement(F,"expandbox");e&&e.unbind("click");F&&F.unbind("click dragstart dragover drop dragenter dragleave dblclick keydown keypress keyup mouseenter mouseleave mousemove mousedown mouseup")}}},y=!1,b=null,d=-1,x=function(c){c=c.find("td");for(var e=0;e<c.length;e++)currentElem=angular.element(c[e]),currentElem.bind("click",function(b){if(1===b.which){var c=a.getColumnFromElem(this);c&&a.callColumnClick(c,a.getMousePos(b))}b.stopPropagation()}),currentElem.bind("dblclick",function(b){b.preventDefault();if(1===b.which){var c=a.getColumnFromElem(this);c&&a.callColumnDblClick(c,a.getMousePos(b))}b.stopPropagation()}),currentElem.bind("mouseenter",function(c){var q=a.getColumnFromElem(this);if(q){var d=angular.element(this),w=a.getCurrentColumnStyle(q,"header","normal");w!=a.options.controlStyle.column.header.normal&&d.removeClass(w);w=a.getCurrentColumnStyle(q,"header","hovered");d.addClass(w);a.callColumnHover(q)}a.hoverColumn=q;1===c.which&&y&&b&&a.hoverColumn&&0!=a.hoverColumn[a.options.columnFields.allowDrop]&&A&&(A.remove(),a.hoverColumn!=b&&(d.append(A),c=parseInt(getComputedStyle(d[0]).height,10),q=parseInt(getComputedStyle(A[0]).height,10),d=h.getPadding(d[0]),A.css("top",(c+d.top+d.bottom-q)/2+"px")))}),currentElem.bind("mouseleave",function(b){b=angular.element(this);var c=a.getColumnFromElem(this);if(c){var d=a.getCurrentColumnStyle(c,"header","hovered");b.removeClass(d);c=a.getCurrentColumnStyle(c,"header","normal");c!=a.options.controlStyle.column.header.normal&&b.addClass(c)}a.hoverColumn=null;A&&A.remove();Y||n.css("cursor","default")}),currentElem.bind("mousemove",function(c){var q=angular.element(this);if(1===c.which&&y&&b&&a.hoverColumn&&a.hoverColumn!=b&&0!=a.hoverColumn[a.options.columnFields.allowDrop])q=parseInt(getComputedStyle(q[0]).width,10),A.empty(),d=-1,c.offsetX>q/2?(d=2,A.append('<span class="iui-treegrid-column-reorder-mark-right"></span>'),A.css("left","auto"),A.css("right","0")):(d=1,A.append('<span class="iui-treegrid-column-reorder-mark-left"></span>'),A.css("left","0"),A.css("right","auto"));else{c=h.getClientMousePos(c,this);var q=a.getIndexFromElem(this),F=a.getColumnWidth(a.columnList[q]);10>c.x&&0<q&&!a.isColumnWithFixedWidth(q-1)?(n.css("cursor","ew-resize"),Z="left"):c.x>F-10&&!a.isColumnWithFixedWidth(q)?(n.css("cursor","ew-resize"),Z="right"):Y||(n.css("cursor","default"),Z="none")}}),currentElem.bind("mouseup",function(c){if(1===c.which&&y&&b&&a.hoverColumn&&a.hoverColumn!=b&&0!=a.hoverColumn[a.options.columnFields.allowDrop]&&0!=a.callColumnPosChanging(b,a.hoverColumn)){c=a.columnList[0];0<=a.options.expandColIndex&&a.options.expandColIndex<a.columnList.length&&(c=a.columnList[a.options.expandColIndex]);var q=a.getColumnCurrentIndex(b),F=a.getColumnCurrentIndex(a.hoverColumn);q!=F&&(q<F?1==d&&F--:q>F&&2==d&&F++,a.columnsObj.moveObject(q,F),a.updateColumnList(),a.options.expandColIndex=a.getColumnCurrentIndex(c),a.updateView(),a.callColumnPosChanged(b,a.hoverColumn))}b=null;d=-1;y=!1;a.updateColumnWidth()&&(a.updateView(),a.updateView());Y=!1;n.css("cursor","default")}),currentElem.bind("mousedown",function(c){h.getClientMousePos(c,this);var q=a.getIndexFromElem(this);if(0===c.button&&!Y){switch(Z){case "left":q--;0<=q&&(Y=!0);break;case "right":Y=!0}!a.isColumnWithFixedWidth(q)&&Y?a.setColumnResizingParams(q,Z,a.getMousePos(c).x):Y=!1}if(q=a.getColumnFromChildElem(this))switch(a.columnSelection(q),c.which){case 1:a.options.allowColumnReorder&&0!=q[a.options.columnFields.allowDrag]&&0==y&&(b=q,a.getMousePos(c),y=!0,(q=h.getBodyElem(n[0]))&&angular.element(q).append(X));break;case 3:a.callColumnRightClick(q,a.getMousePos(c))}c.stopPropagation()})},g=function(b){if(b){if(1==a.options.allowFocus&&0==a.options.allowCellFocus){var c=a.getTabIndex().toString()+(a.getRowCurrentIndex(a.getRowFromElem(b))+1).toString();b.attr("tabindex",c)}b.bind("dragover",function(b){if(a.isScrollBarVisible()){var c=a.getMousePos(b),d=n[0].getBoundingClientRect();c.y<d.top+25?xa(!1):c.y>d.bottom-25?xa(!0):ma()}else ma();b.stopPropagation()});b.bind("dragend",function(b){b.preventDefault();a.dragDropStatus(!1);a.dropMark();f.getData().source||f.clearData()});b.bind("mouseenter",function(b){if(!y){angular.element(this);var c=a.getRowFromElem(this);c&&(a.hoverRow=c,a.refresh(c),a.callRowHover(c),a.options.hoverSelection&&(aa=k(function(){aa&&a.rowSelection(c)},500)))}});b.bind("mouseleave",function(b){a.hoverRow=null;(b=a.getRowFromElem(this))&&a.refresh(b);aa&&(k.cancel(aa),aa=null)});b.bind("keydown",function(b){var c=a.getRowFromElem(this);if(c){var d=a.getRowCurrentIndex(c);switch(b.keyCode){case 9:Oa(b,c,d);break;case 16:a.updateSelectionStatus("shift");break;case 17:a.updateSelectionStatus("ctrl");break;case 33:Ra(b,d);break;case 34:Sa(b,d);break;case 35:Ta(b,d);break;case 36:Ua(b,d);break;case 37:Va(b,c,d);break;case 32:b.preventDefault();a.rowSelection(c,c.selected);l.$apply();break;case 38:Ha(b,d);break;case 39:Pa(b,c,d);break;case 40:Ga(b,d);break;default:(b.ctrlKey||b.metaKey)&&a.updateSelectionStatus("ctrl"),b.shiftKey&&a.updateSelectionStatus("shift")}}a.callKeyDown(b,c)});b.bind("keyup",function(b){switch(b.keyCode){case 16:a.multiSelection(!1);a.shiftKeyStatus(!1);break;case 17:a.multiSelection(!1);break;default:b.ctrlKey||b.metaKey||a.multiSelection(!1),b.shiftKey||(a.multiSelection(!1),a.shiftKeyStatus(!1))}var c=a.getRowFromElem(this);a.callKeyUp(b,c)});b.bind("keypress",function(b){var c=a.getRowFromElem(this);a.callKeyPress(b,c)})}},Ya=function(b){b&&b.bind("click",function(b){var c=angular.element(this);if(c=a.getRowFromChildElem(c))a.toggle(c),a.updateFocus(a.getRowCurrentIndex(c),a.options.expandColIndex);b.stopPropagation()})},Za=function(b,c,d){b&&(a.isDragAllowed(c)&&b.attr("draggable",!0),1==a.options.allowFocus&&1==a.options.allowCellFocus&&(c=a.getTabIndex().toString()+(a.getRowCurrentIndex(c)+1).toString()+d.toString(),b.attr("tabindex",c)),b.bind("dragstart",function(b){f.clearData();var c=a.getRowFromChildElem(this);if(c)if(K&&(k.cancel(K),K=null),a.isDragAllowed(c)){a.dragDropStatus(!0);a.addDropMark();b.dataTransfer?(b.dataTransfer.effectAllowed="move",b.dataTransfer.setData("text",c[a.options.rowFields.id]?c[a.options.rowFields.id].toString():"")):b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.effectAllowed="move",b.originalEvent.dataTransfer.setData("text",c[a.options.rowFields.id]?c[a.options.rowFields.id].toString():""));b={source:c,sourceCtrl:a,sourceCollection:a.rowsObj};switch(a.options.selectionMode){case "multi-simple":b.source=a.options.selectedRows;break;case "multi-extended":b.source=a.options.selectedRows}f.setData(b)}else b.dataTransfer?b.dataTransfer.effectAllowed="none":b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.effectAllowed="none")}),b.bind("dragover",function(b){var c=angular.element(this);b.preventDefault();var d=!0;b.dataTransfer?d="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(d="none"===b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(d){var e=a.getRowFromChildElem(c);if(e){var d=c[0].getBoundingClientRect(),w=angular.element(T)[0].pageXOffset,N=angular.element(T)[0].pageYOffset,g=a.getMousePos(b);g.x-=d.left+w;g.y-=d.top+N;c=f.getDropPos(g,{x:0,y:0,width:c[0].offsetWidth,height:c[0].offsetHeight});w=f.getData();d=a.isDropAllowed(w.source,e,c);N={sourceTree:w.sourceCtrl?w.sourceCtrl.getTreeName():"",dragRow:w.source,targetTree:a.getTreeName(),targetRow:e,isDropAllowed:d,dropPos:c,mousePos:a.getMousePos(b)};N=a.callDragOver(N);if(d&&!1!==N){N=a.getMousePos(b);b=N.y+16;N=N.x+20;g=a.getDropMarkWindow();g.empty();var h="iui-drop-marker-move-in";switch(c){case 1:h="iui-drop-marker-move-up";break;case 2:h="iui-drop-marker-move-down"}g.append("<span class='"+h+"'></span><span class='iui-drop-marker-title'>"+e[a.options.rowFields.text]+"</span>");a.updateDropMarkElem(a.getDropMarkWindow(),{top:b,left:N});a.dropMark(d);f.setData({source:w.source,sourceList:w.sourceList,target:e,dropPos:c})}else b.dataTransfer?b.dataTransfer.dropEffect="none":b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.dropEffect="none"),a.dropMark()}}}),b.bind("drop",function(b){var c=angular.element(this);b.preventDefault();M&&(k.cancel(M),M=null);a.dropMark();var d=!0;b.dataTransfer?d="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(d="none"===b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(d){var e=a.getRowFromChildElem(c);if(e){var c=f.getData(),w=c.source;w||(w=a.getDnDSource(b));if(d=a.isDropAllowed(w,e,c.dropPos))a.toggle(e,!0),w&&(d={sourceTree:c.sourceCtrl?c.sourceCtrl.getTreeName():"",dragRow:w,targetTree:a.getTreeName(),targetRow:e,isDropAllowed:d,dropPos:c.dropPos,mousePos:a.getMousePos(b)},!1!==a.callDragDrop(d)&&(a.drop(c),l.$$phase||l.$apply()))}}f.clearData();b.stopPropagation()}),b.bind("dragenter",function(b){b.preventDefault();var c=angular.element(this),d=a.getRowFromChildElem(c);if(d)var e=k(function(){M||(M=k(function(){M&&a.toggle(d,!0)},750));k.cancel(e)},1);c=f.getData();c.source||(c.source=a.getDnDSource(b));c={sourceTree:c.sourceCtrl?c.sourceCtrl.getTreeName():"",dragRow:c.source,targetTree:a.getTreeName(),targetRow:c.target,mousePos:a.getMousePos(b)};a.callDragEnter(c);b.stopPropagation()}),b.bind("dragleave",function(b){b.preventDefault();a.hoverRow=null;var c=angular.element(this);a.getRowFromChildElem(c);M&&(k.cancel(M),M=null);c=f.getData();c.source||(c.source=a.getDnDSource(b));c={sourceTree:c.sourceCtrl?c.sourceCtrl.getTreeName():"",dragRow:c.source,targetTree:a.getTreeName(),targetRow:c.target,mousePos:a.getMousePos(b)};a.callDragLeave(c);b.stopPropagation()}),b.bind("dblclick",function(b){b.preventDefault();if(1===b.which){var c=a.getRowFromChildElem(this);if(c){var d=a.getRowCurrentIndex(c),e=parseInt(a.getIndexFromElem(this),10);switch(a.columnList[e][a.options.columnFields.editorType]){case "checkbox":break;default:a.callRowDblClick(c,a.getMousePos(b)),a.toggle(c),a.updateFocus(d,e)}}}b.stopPropagation()}),b.bind("mouseenter",function(b){if(!y&&(b=a.getRowFromChildElem(this))){var c=a.getRowCurrentIndex(b),d=parseInt(a.getIndexFromElem(this),10);if(c=a.getCell(c,d)){a.hoverCell=c;a.refresh(c,b);var d=angular.element(this),e=a.getCurrentCellStyle(b,c,"normal");e!=a.options.controlStyle.cell.normal&&d.removeClass(e);e=a.getCurrentCellStyle(b,c,"hovered");d.addClass(e)}}}),b.bind("mouseleave",function(b){a.hoverCell=null;if(b=a.getRowFromChildElem(this)){var c=a.getRowCurrentIndex(b),d=parseInt(a.getIndexFromElem(this),10);if(d=a.getCell(c,d)){a.refresh(d,b);var c=angular.element(this),e=a.getCurrentCellStyle(b,d,"hovered");c.removeClass(e);b=a.getCurrentCellStyle(b,d,"normal");b!=a.options.controlStyle.cell.normal&&c.addClass(b)}}}),b.bind("keydown",function(c){var d=a.getRowFromChildElem(this);if(d){var e=a.getRowCurrentIndex(d),f=parseInt(a.getIndexFromElem(this),10);switch(c.keyCode){case 9:Oa(c,d,e,f);break;case 13:ba(b,0);break;case 16:a.updateSelectionStatus("shift");break;case 17:a.updateSelectionStatus("ctrl");break;case 33:Ra(c,e,f);break;case 34:Sa(c,e,f);break;case 35:Ta(c,e,f);break;case 36:Ua(c,e,f);break;case 37:Va(c,d,e,f);break;case 32:c.preventDefault();a.rowSelection(d,d.selected);l.$apply();break;case 38:Ha(c,e,f);break;case 39:Pa(c,d,e,f);break;case 40:Ga(c,e,f);break;default:(c.ctrlKey||c.metaKey)&&a.updateSelectionStatus("ctrl"),c.shiftKey&&a.updateSelectionStatus("shift")}}a.callKeyDown(c,d);c.stopPropagation()}),b.bind("keyup",function(b){switch(b.keyCode){case 16:a.multiSelection(!1);a.shiftKeyStatus(!1);break;case 17:a.multiSelection(!1);break;default:b.ctrlKey||b.metaKey||a.multiSelection(!1),b.shiftKey||(a.multiSelection(!1),a.shiftKeyStatus(!1))}var c=a.getRowFromChildElem(this);a.callKeyUp(b,c);b.stopPropagation()}),b.bind("keypress",function(b){var c=a.getRowFromChildElem(this);a.callKeyPress(b,c);b.stopPropagation()}),b.bind("click",function(b){if(1===b.which){var c=a.getRowFromChildElem(this);if(c){var d=a.getRowCurrentIndex(c),e=parseInt(a.getIndexFromElem(this),10),d=a.getCell(d,e);a.callCellClick(c,d,a.getMousePos(b));a.callRowClick(c,a.getMousePos(b))}}b.stopPropagation()}),b.bind("mousedown",function(b){a.mouseButtonStatus(!0);var c=a.getRowFromChildElem(this);if(c)switch(a.rowSelection(c),b.which){case 1:ba(angular.element(this));break;case 3:a.callRowRightClick(c,a.getMousePos(b))}b.stopPropagation()}),b.bind("mouseup",function(b){a.mouseButtonStatus(!1);var c=a.getRowFromChildElem(this);c&&a.updateSelection(c);1===b.which&&K&&(k.cancel(K),K=null)}))};a.getFooterElem=function(){return O};a.getHeaderElem=function(){return H};a.getRowElems=function(){return I?I.find("tr"):null};var Oa=function(b,c,d,e){var f=a.currentList.length;0<f&&(b.shiftKey?h.isEqual(c[a.options.rowFields.id],a.currentList[0][a.options.rowFields.id])||Ha(b,d,e):h.isEqual(c[a.options.rowFields.id],a.currentList[f-1][a.options.rowFields.id])||Ga(b,d,e))},Ga=function(b,c,d){b.preventDefault();focusDelayTime=0;b=c;var e=C+W-2;a.options.showHeader&&e--;a.options.showFooter&&e--;e=e<a.currentList.length-1?e:a.currentList.length-1;b===e&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+Math.floor(n[0].clientHeight/4)}),focusDelayTime=1);if(b=a.getNextRow(b)){a.rowSelection(b);c=a.getRowCurrentIndex(b);var f=k(function(){a.updateFocus(c,d);k.cancel(f)},focusDelayTime)}},Ha=function(b,c,d){b.preventDefault();focusDelayTime=0;b=C;c===(0<b?b:0)&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y-Math.floor(n[0].clientHeight/4)}),focusDelayTime=1);if(b=a.getPrevRow(c)){a.rowSelection(b);c=a.getRowCurrentIndex(b);var e=k(function(){a.updateFocus(c,d);k.cancel(e)},focusDelayTime)}},Pa=function(b,c,d,e){b.preventDefault();if((void 0===e||0<=e&&e==a.options.expandColIndex)&&!a.isRowExpanded(c)&&c[a.options.rowFields.rows]&&0<c[a.options.rowFields.rows].length)a.toggle(c,!0),a.updateFocus(d,e);else if(0<=e){focusDelayTime=0;var f=e+1;b=a.columnList.length-1;f===b&&(focusDelayTime=1);if(0<=f&&f<=b)var g=k(function(){a.updateFocus(d,f);k.cancel(g)},focusDelayTime)}},Va=function(b,c,d,e){b.preventDefault();if((void 0===e||0<=e&&e==a.options.expandColIndex)&&a.isRowExpanded(c)&&c[a.options.rowFields.rows]&&0<c[a.options.rowFields.rows].length)a.toggle(c,!1),a.updateFocus(d,e);else if(0<=e){focusDelayTime=0;var f=1<e?e-1:0;if(0<=f)var g=k(function(){a.updateFocus(d,f);k.cancel(g)},focusDelayTime)}},Ra=function(b,c,d){b.preventDefault();b=c-W;b=0<b?b:0;if(b!==c){focusDelayTime=1;var e=a.getPrevRow(b+1);if(e){a.scrollTo(e);a.rowSelection(e);l.$apply();var f=k(function(){a.updateFocus(a.getRowCurrentIndex(e),d);k.cancel(f)},focusDelayTime)}}},Sa=function(b,c,d){b.preventDefault();b=c+W-1;a.options.showHeader&&b--;a.options.showFooter&&b--;b=b<a.currentList.length-1?b:a.currentList.length-1;if(b!==c){focusDelayTime=1;var e=a.getNextRow(b-1);if(e){a.scrollTo(e,"bottom");a.rowSelection(e);l.$apply();var f=k(function(){a.updateFocus(a.getRowCurrentIndex(e),d);k.cancel(f)},focusDelayTime)}}},Ta=function(b,c,d){b.preventDefault();a.setScrollPos({x:a.scrollPos.x,y:P.y});var e=a.getLastRow();if(e){a.rowSelection(e);var f=k(function(){a.updateFocus(a.getRowCurrentIndex(e),d);k.cancel(f)},1)}},Ua=function(b,c,d){b.preventDefault();a.setScrollPos({x:a.scrollPos.x,y:0});var e=a.getFirstRow();if(e){a.rowSelection(e);var f=k(function(){a.updateFocus(a.getRowCurrentIndex(e),d);k.cancel(f)},1)}},I=null,H=null,O=null,C=0,ca=null,V=null,D=100,Q=0,W=0,da=0,ra=0,ha=0,na=0,ia=0,ya=!1,sa=!1,ta=9,ua=9,za=0,ea=0,ja=0,va=1,Aa=0,wa=0,fa=0,oa=0,Ba=1,u=null,v=null,L=!1,R=!1;this.scrollMousePos=null;var P={x:0,y:0},wa=0,S=null;a.getColumnWidth=function(b){return b&&0<=b[a.options.columnFields.width]?b[a.options.columnFields.width]:100};a.updateViewSize=function(){var b=k(function(){ia=0;L=!1;if(0<a.columnList.length){var c=a.getHeaderElem();if(c&&(c=c.find("td"))&&0<c.length)for(var d=0;d<c.length;d++){var e=angular.element(c[d]);ia+=e[0].offsetWidth}ia>n[0].clientWidth&&(G.unbind("mousedown"),n.append(G),G.bind("mousedown",function(b){b=h.getClientMousePos(b,this);var c=Math.floor(n[0].clientWidth);u&&(b.x<u[0].offsetLeft?a.setScrollPos({x:a.scrollPos.x-c,y:a.scrollPos.y}):b.x>u[0].offsetLeft+u[0].offsetWidth&&a.setScrollPos({x:a.scrollPos.x+c,y:a.scrollPos.y}))}),u=angular.element(G.children().eq(0)),L=!0,u.bind("mousedown",function(b){1===b.which&&(t.scrollMousePos=a.getMousePos(b),ya=!0);b.stopPropagation()}))}R=!1;0<a.currentList.length&&D<a.currentList.length+1&&(B.unbind("mousedown"),n.append(B),B.bind("mousedown",function(b){b=h.getClientMousePos(b,this);var c=Math.floor(n[0].clientHeight);v&&(b.y<v[0].offsetTop?(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y-c}),xa(!1,c)):b.y>v[0].offsetTop+v[0].offsetHeight&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+c}),xa(!0,c)))}),v=angular.element(B.children().eq(0)),R=!0,v.bind("mousedown",function(b){1===b.which&&(t.scrollMousePos=a.getMousePos(b),sa=!0);b.stopPropagation()}));L||(G.unbind("mousedown"),G.remove());R||(B.unbind("mousedown"),B.remove());L&&R?n.append(ka):ka.remove();k.cancel(b);!L&&0<a.scrollPos.x&&a.setScrollPos({x:0,y:a.scrollPos.y});!R&&0<a.scrollPos.y&&a.setScrollPos({x:a.scrollPos.x,y:0})},1)};var Ca=function(){var b=k(function(){da=n[0].offsetWidth-2;ra=n[0].offsetHeight-2;L&&(ra-=G[0].offsetHeight);R&&(da-=B[0].offsetWidth);J.css("width",da+"px");J.css("height",ra+"px");L&&(G.css("left","0px"),G.css("bottom","0px"),G.css("width",da-2+"px"));R&&(B.css("top","0px"),B.css("right","0px"),B.css("height",ra-2+"px"));L&&R&&(ka.css("left","auto"),ka.css("right","0px"));var c=k(function(){L&&da<ia&&(ea=2,ja=G[0].clientWidth-4,za=0,ja>ea&&(za=ja-ea),ta=Math.floor(za*da/ia),9>ta&&(ta=9),u.css("width",ta+"px"),P.x=ia-da,va=P.x/(za-ta-2));var b=a.currentList.length+1;R&&0<a.currentList.length&&D<b&&(fa=2,oa=B[0].clientHeight-4,Aa=0,oa>fa&&(Aa=oa-fa),ua=Math.floor(Aa*D/b),9>ua&&(ua=9),v.css("height",ua+"px"),Ba=(b-D+1)/(Aa-ua-2),P.y=Math.floor((b-D+1)*Q),0>P.y&&(P.y=0),0==C?v.css("top",fa+"px"):C+D-1==a.currentList.length&&v.css("top",oa-v[0].offsetHeight+"px"));k.cancel(c)},1);k.cancel(b)},5)};a.updateLayout=function(b){if(a.allowUpdate){n.removeClass("iui-treegrid-block-rtl");a.options.rtl&&n.addClass("iui-treegrid-block-rtl");J.removeClass("iui-treegrid-block-shift-left iui-treegrid-block-rtl");J.addClass(la());"view"!==a.updateType&&(Q=0,D=30,na=ha=0,D=Math.floor(n[0].clientHeight/20),a.updateColumnList());a.updateCurrentList();a.updateView(b);a.updateView(b);var c=k(function(){a.updateViewSize();a.updateViewSize();Ca();k.cancel(c)},1)}};a.updateColumnWidth=function(){if(a.options.fillSpace){for(var b=0,c=0;c<a.columnList.length;c++)b+=a.getColumnWidth(a.columnList[c])+4;if(b<n[0].clientWidth){for(var b=(n[0].clientWidth-b)/a.columnList.length,d=0,c=0;c<a.columnList.length;c++)d=a.getColumnWidth(a.columnList[c])+b,a.columnList[c][a.options.columnFields.width]=d;return!0}}return!1};var Wa=function(b){for(var c="left",d=0,e=null,f='<table cellpadding="0" cellspacing="0" style="position:absolute;',f=(b?f+'bottom:0;">':f+'top:0;">')+"<tr>",g=0;g<a.columnList.length;g++){var e=a.columnList[g],d=a.getColumnWidth(e),d=0<=d?d:0,h=b?a.options.controlStyle.column.footer.normal:a.options.controlStyle.column.header.normal,c=a.getCurrentColumnStyle(e,b?"footer":"header"),l=c.normal?c.normal:"",c=b?e[a.options.columnFields.footerAlignment]:e[a.options.columnFields.headerAlignment],f=f+('<td class="'+h);l!=h&&(f+=" "+l);b?(f+='" data-index="'+g+'" data-element="column-footer">',f+='<div class="iui-treegrid-column-footer-cell" data-element="column-footer-cell"'):(f+='" data-index="'+g+'" data-element="column-header">',f+='<div class="iui-treegrid-column-header-cell" data-element="column-header-cell"');e[a.options.columnFields.contextMenu]&&(f+=' iui-contextmenu menu-items="data['+g+"]."+a.options.columnFields.contextMenu+'"');f+=' style="overflow:hidden;width:'+d+"px;text-align:"+c+'">';f=b?f+'<span class="iui-treegrid-column-footer-cell-content" data-element="cell-content">':f+'<span class="iui-treegrid-column-header-cell-content" data-element="cell-content">';b?a.columnList[g][a.options.columnFields.footerText]&&(f+="{{data["+g+"]."+a.options.columnFields.footerText+"}}"):a.columnList[g][a.options.columnFields.headerText]&&(f+="{{data["+g+"]."+a.options.columnFields.headerText+"}}");f+="</span>";f+="</div>";f+="</td>"}return f+="</tr></table>"};l.onCellValueChanging=function(b,c,d){var e=!0,f=a.getColumnObject(d),g="label",h=null;f&&(g=f[a.options.columnFields.editorType],h=f[a.options.columnFields.editorSettings]);f=null;switch(g){case "checkbox":f=h&&1==h.threeState?b.checkState:b.checked,e=a.callCellValueChanging(a.getRowObject(c),a.getCellObject(c,d),f)}return e};l.onCellValueChanged=function(b,c,d){var e=a.getColumnObject(d),f="label",g=null;e&&(f=e[a.options.columnFields.editorType],g=e[a.options.columnFields.editorSettings]);e=null;switch(f){case "checkbox":e=g&&1==g.threeState?b.checkState:b.checked,a.callCellValueChanged(a.getRowObject(c),a.getCellObject(c,d),e)}};a.updateView=function(b){k(function(){ya||sa||Ca();qa();J.empty();O=I=H=null;ca&&ca.$destroy();V&&V.$destroy();Xa(!1);a.currentList.length>=D&&C+D-1>a.currentList.length&&(C=a.currentList.length-D+1);if(0<a.columnList.length){var b="";na=ha=0;a.updateColumnWidth();ca=l.$new();ca.data=a.columnList;a.options.showHeader&&(b=Wa(),H=c(b)(ca),J.append(H),ha=H[0].offsetHeight,x(H));a.options.showFooter&&(b=Wa(!0),O=c(b)(ca),J.append(O),na=O[0].offsetHeight);V=l.$new();V.data=a.currentList;V.rows=[];for(var d=b=null,e=V.data,f=0;f<e.length;f++){for(var b={index:f,cells:[]},w=0;w<a.columnList.length;w++){var k=a.columnList[w][a.options.columnFields.editorSettings],d={index:w};k&&k.style&&(d.editorStyle=k.style);b.cells.push(d)}V.rows.push(b)}d="";W=0;for(b=C;b<C+D&&b<a.currentList.length;b++){var e=b,t="left",r=0,v=0,z=null,f=a.currentList[e],u=-1,w=a.indentList[e],E=-1,B="label",k=a.defaultStyle.row.general.normal,p='<tr class="'+k;a.options.controlStyle.row.general.normal!=k&&(p+=" "+a.options.controlStyle.row.general.normal);E=a.getCurrentRowStyle(f,a.getObjState(f));E!=k&&(p+=" "+E);p+='" data-index="'+e+'">';for(k=0;k<a.columnList.length;k++){var m=null,z=a.columnList[k],t=z[a.options.columnFields.contentAlignment],E=z[a.options.columnFields.id],B=z[a.options.columnFields.editorType],r=v=a.getColumnWidth(z);k==a.options.expandColIndex&&(r-=w);r=0<=r?r:0;u=k;E&&(u=a.getCellIndexById(f[a.options.rowFields.cells],e,k,E));var m=f[a.options.rowFields.cells][u],y=a.defaultStyle.row.cell.general;a.options.controlStyle.row.cell.normal!=y&&(y+=" "+a.options.controlStyle.row.cell.normal);var A=a.getCurrentCellStyle(f,m),A=A.normal?A.normal:"",p=p+('<td class="'+y);A!=y&&(p+=" "+A);switch(a.options.gridLines){case "none":p=e==C+D-1||e==a.currentList.length-1?p+' iui-treegrid-lines-horizontal"':p+' iui-treegrid-lines-none"';break;case "horizontal":p+=' iui-treegrid-lines-horizontal"';break;case "vertical":p=e==C+D-1||e==a.currentList.length-1?p+' iui-treegrid-lines-both"':p+' iui-treegrid-lines-vertical"';break;default:p+=' iui-treegrid-lines-both"'}p+=' data-element="cell" data-index="'+k+'">';y=a.defaultStyle.row.cell.content;m=a.getCurrentCellStyle(f,m,"content");m!=y&&(m+=" "+y);p+='<div class="'+m+'" data-element="cell-content"';f[a.options.rowFields.cells]&&0<=u&&u<f[a.options.rowFields.cells].length&&f[a.options.rowFields.cells][u].contextMenu?p+=' iui-contextmenu menu-items="data['+e+"]."+a.options.rowFields.cells+"["+u+"]."+a.options.cellFields.contextMenu+'"':f.contextMenu&&(p+=' iui-contextmenu menu-items="data['+e+"]."+a.options.rowFields.contextMenu+'"');p+=' style="width:'+r+"px;";t&&(p+="text-align:"+t+";");k===a.options.expandColIndex&&(t={top:0,right:0,bottom:0,left:0},(z=a.getElemFromColumn(z))&&(z=a.getChildElement(z,"column-header-cell"))&&(t=h.getPadding(z[0])),z=0,a.options.rtl?(z=t.right+w,p=0==r?p+("padding-right:"+v+"px;"):p+("padding-right:"+z+"px;")):(z=t.left+w,p=0==r?p+("padding-left:"+v+"px;"):p+("padding-left:"+z+"px;")));p+='">';r=f;v=e;z=k;m="";t=a.currentList[v][a.options.rowFields.cells];u=z;E&&(u=a.getCellIndexById(t,v,z,E));if(0<=u&&(z===a.options.expandColIndex&&(m+='<span class="'+pa(r)+'" data-element="expandbox"></span>',!1!==a.options.showIcons&&(r.icon||a.options.rowIcon)&&(E=m,m="",r.icon?m=r.icon:a.options.rowIcon&&(m=a.options.rowIcon),m=E+('<span class="'+m+'" data-element="icon"></span>'))),u<t.length)){E=a.columnList[z][a.options.columnFields.editorSettings];y=t[u];if(void 0==y[a.options.cellFields.value]){A=void 0;switch(B){case "checkbox":A=E&&1==E.threeState?"unchecked":!1;break;case "image":A=""}void 0!=A&&(y[a.options.cellFields.value]=A)}switch(B){case "checkbox":m+='<iui-checkbox name="cb-'+h.getUniqueId(4)+'"';E&&1==E.threeState?(m+=' check-state="data['+v+"]."+a.options.rowFields.cells+"["+u+"]."+a.options.cellFields.value+'"',m+=' checkstate-changing="onCellValueChanging(e, '+v+", "+z+')"',m+=' checkstate-changed="onCellValueChanged(e, '+v+", "+z+')"',m+=' three-state="true"'):(m+=' checked="data['+v+"]."+a.options.rowFields.cells+"["+u+"]."+a.options.cellFields.value+'"',m+=' checked-changing="onCellValueChanging(e, '+v+", "+z+')"',m+=' checked-changed="onCellValueChanged(e, '+v+", "+z+')"');E&&E.style&&V.rows[v].cells[z].editorStyle&&(m+=' control-style="rows['+v+"].cells["+z+'].editorStyle"');0==t[u][a.options.cellFields.enabled]&&(m+=' enabled="false"');m+=' style="vertical-align:middle;"></iui-checkbox>';break;case "image":void 0==t[a.options.cellFields.value]&&(t[a.options.cellFields.value]="");m+='<img data-element="image" style="vertical-align:middle" src="';m+="{{data["+v+"]."+a.options.rowFields.cells+"["+u+"]."+a.options.cellFields.value+"}}";m+='" />';break;default:r.content?(m+='<div class="'+a.getDefaultCellLabelClass()+'" data-element="content">',m+=r[a.options.rowFields.content],m+="</div>"):(m+='<span class="'+a.getDefaultCellLabelClass()+'" data-element="content">',m+="{{data["+v+"]."+a.options.rowFields.cells+"["+u+"]."+a.options.cellFields.text+"}}",m+="</span>")}}p+=m;p+="</div>";p+="</td>"}p+="</tr>";d+=p;W++}if(0<W){I=angular.element('<table class="iui-treegrid-table" cellpadding="0" cellspacing="0" style="position:absolute;top:'+ha+'px;"></table>');I.append(c(d)(V));H?H.after(I):J.append(I);b=J.find("tr");if(0<b.length)for(w=e=null,e=0,d=b.length-1,a.options.showHeader&&e++,a.options.showFooter&&d--,f=e;f<=d;f++)if(e=angular.element(b[f]),(w=a.getRowFromElem(e))&&0!=w[a.options.rowFields.enabled])for(g(e),w=e.find("td"),k=0;k<w.length;k++)E=angular.element(w[k]),Ya(a.getElement(E,"expandbox")),Za(E,a.getRowFromElem(e),k);b=I[0].offsetHeight;d=n[0].offsetHeight-2;L&&G&&(d-=G[0].offsetHeight);H&&(b+=ha,d-=ha,2<ha&&W++);O&&(b+=na,d-=na,2<na&&W++);Q=b/W;D=Math.floor(d/Q)+1;Ca()}Ia();a.markSelColumn();a.markSelRows()}},1)};a.refresh=function(b,c){if(b){var d=null;switch(b.type){case "column":if(1==a.options.showHeader&&(d=a.getElemFromColumn(b))){d.removeAttr("class");d.addClass(a.defaultStyle.column.header.normal);d.addClass(a.options.controlStyle.column.header.normal);var e=a.getCurrentColumnStyle(b,"header",a.getObjState(b));e!=a.options.controlStyle.column.header.normal&&d.addClass(e);if(d=a.getContentElement(d))d.removeAttr("class"),d.addClass(a.defaultStyle.column.header.content),d.addClass(a.defaultStyle.column.header.content),e=a.getCurrentColumnStyle(b,"header","content"),e!=a.options.controlStyle.column.header.content&&d.addClass(e)}1==a.options.showFooter&&(d=a.getElemFromColumn(b,"footer"))&&(d.removeAttr("class"),d.addClass(a.defaultStyle.column.footer.normal),d.addClass(a.options.controlStyle.column.footer.normal),e=a.getCurrentColumnStyle(b,"footer",a.getObjState(b)),e!=a.options.controlStyle.column.footer.normal&&d.addClass(e),d=a.getContentElement(d))&&(d.removeAttr("class"),d.addClass(a.defaultStyle.column.footer.content),d.addClass(a.defaultStyle.column.footer.content),e=a.getCurrentColumnStyle(b,"footer","content"),e!=a.options.controlStyle.column.footer.content&&d.addClass(e));break;case "row":if(d=a.getElemFromRow(b))for(d.removeAttr("class"),d.addClass(a.defaultStyle.row.general.normal),d.addClass(a.options.controlStyle.row.general.normal),e=a.getCurrentRowStyle(b,a.getObjState(b)),e!=a.options.controlStyle.row.general.normal&&d.addClass(e),d=0;d<b[a.options.rowFields.cells].length;d++)a.refresh(b[a.options.rowFields.cells][d],b);break;case "cell":if(c&&(e=-1,e=(e=b[a.options.cellFields.cid])?a.getColumnCurrentIndex(a.getColumnById(e)):a.getCellIndexFromRow(b,c),0<=e&&(rowElem=a.getElemFromRow(c)))){var f=rowElem.find("td");if(f&&0<f.length)for(var g=0;g<f.length;g++){var h=angular.element(f[g]);if(h[0].attributes["data-index"]&&h[0].attributes["data-index"].value.toString()===e.toString()){d=h;break}}if(d){e=a.getDefaultCellBorderClass();if(d[0].classList)for(f=0;f<d[0].classList.length;f++)switch(d[0].classList[f]){case "iui-treegrid-lines-none":e=d[0].classList[f];break;case "iui-treegrid-lines-vertical":e=d[0].classList[f];break;case "iui-treegrid-lines-horizontal":e=d[0].classList[f];break;case "iui-treegrid-lines-both":e=d[0].classList[f]}d.removeAttr("class");d.addClass(a.defaultStyle.row.cell.normal);d.addClass(a.options.controlStyle.row.cell.normal);d.addClass(e);e=a.getCurrentCellStyle(c,b,a.getObjState(b));e!=a.options.controlStyle.row.cell.normal&&d.addClass(e);if(d=a.getContentElement(d))if(d.removeAttr("class"),d.addClass(a.defaultStyle.row.cell.content),d.addClass(a.options.controlStyle.row.cell.content),e=a.getCurrentCellStyle(c,b,"content"),e!=a.options.controlStyle.row.cell.content&&d.addClass(e),d=a.getChildElement(d,"expandbox"))d.removeAttr("class"),d.addClass(pa(c))}}}}else{for(d=0;d<a.columnList.length;d++)a.refresh(a.columnList[d]);for(d=C;d<C+D&&d<a.currentList.length;d++)a.refresh(a.currentList[d])}};var Z="none",Y=!1,Da=-1,Z="none",Ja=0,Ka=0;a.isColumnWithFixedWidth=function(b){var c=a.columnList;return c&&0<=b&&b<c.length?c[b][a.options.columnFields.fixedWidth]?c[b][a.options.columnFields.fixedWidth]:!1:!1};a.setColumnResizingParams=function(b,c,d){0<=b&&b<a.columnList.length&&(Da=b,Z=c,Ka=d,Ja=a.getColumnWidth(a.columnList[b]))};a.resizeColumn=function(b,c){0>c&&(c=0);var d=null;H&&(d=angular.element(H.find("tr")),a.resizeColumnCells(d,b,c));if(I){var d={top:0,right:0,bottom:0,left:0},e=a.getElemFromColumn(a.columnList[b]);e&&(e=a.getChildElement(e,"column-header-cell"))&&(d=h.getPadding(e[0]));for(var e=I.find("tr"),f=0;f<e.length;f++)angular.element(e[f]),a.resizeColumnCells(angular.element(e[f]),b,c,!0,d)}O&&(d=angular.element(O.find("tr")),a.resizeColumnCells(d,b,c));0<=b&&b<a.columnList.length&&a.callColumnSizeChanged(a.columnList[b])};a.resizeColumnCells=function(b,c,d,e,f){if(b){var g=-1;e&&(g=a.getRowCurrentIndex(a.getRowFromElem(b)));e=e=0;0<=g&&(e=a.indentList[g]);b=b.find("td");0<=c&&c<b.length&&(b=angular.element(b[c]),0<b.children().length&&(b=b.children().eq(0)))&&(e=a.options.rtl?f?f.right+e:e:f?f.left+e:e,f=d,0<=g&&c==a.options.expandColIndex&&(f-=e),f=0<=f?f:0,b.css("width",f+"px"),c==a.options.expandColIndex&&(a.options.rtl?0==f?b.css("padding-right",d+"px"):b.css("padding-right",e+"px"):0==f?b.css("padding-left",d+"px"):b.css("padding-left",e+"px")))}};angular.element(T).bind("dragover",function(a){ma()});var A=angular.element('<div class="iui-treegrid-column-reorder-mark"><span></span></div>'),X=angular.element('<div class="iui-treegrid-column-reorder-tooltip"><span></span></div>'),Qa=function(c){var d="initial";y&&b&&(!a.hoverColumn||b==a.hoverColumn||a.hoverColumn&&0==a.hoverColumn.allowDrop)&&(d="not-allowed",c&&X&&X.css("display","none"));n.css("cursor",d);document.body.style.cursor=d};angular.element(T).bind("mousemove",function(b){if(0===b.button&&0<=Da&&"none"!==Z){var c=a.getMousePos(b),d=Da,c=Ja+c.x-Ka,c=0<=c?c:0,e=a.columnList;0<=d&&d<e.length&&(e[d][a.options.columnFields.width]=c,a.resizeColumn(d,c),a.updateViewSize(),Ca())}ya?1===b.which&&(u[0].getBoundingClientRect(),b=a.getMousePos(b),t.scrollMousePos||(t.scrollMousePos=b),d=u[0].offsetLeft+(b.x-t.scrollMousePos.x),d<ea?d=ea:d+u[0].offsetWidth>ja&&(d=ja-u[0].offsetWidth),u.css("left",d+"px"),t.scrollMousePos=b,a.scrollPos.x=!1!==a.options.rtl?parseInt((ja-u[0].offsetLeft-u[0].offsetWidth)*va,10):parseInt((u[0].offsetLeft-ea)*va,10),Ia(),a.callScrollPosChanged()):sa&&1===b.which&&(v[0].getBoundingClientRect(),b=a.getMousePos(b),t.scrollMousePos||(t.scrollMousePos=b),d=v[0].offsetTop+(b.y-t.scrollMousePos.y),d<fa?d=fa:d+v[0].offsetHeight>oa&&(d=oa-v[0].offsetHeight),v.css("top",d+"px"),t.scrollMousePos=b,wa=d-fa,a.scrollPos.y=Math.floor(wa*Ba*Q),newIndex=0<Q?Math.floor(a.scrollPos.y/Q):0,newIndex+D-1>a.currentList.length&&(newIndex=a.currentList.length-D+1),0>newIndex&&(newIndex=0),newIndex!==C&&(C=newIndex,b="",0<=C&&C<a.currentList.length&&(b=a.currentList[C][a.options.rowFields.text]),b||(b="Index: "+C),S&&S.remove(),S=angular.element('<div class="iui-scroll-marker"><span>'+b+"</span></div>"),n.append(S),b=v[0].offsetTop+Math.floor((v[0].offsetHeight-S[0].offsetHeight)/2),0>b&&(b=0),b+S[0].offsetHeight>n[0].clientHeight&&(b=n[0].clientHeight-S[0].offsetHeight),S.css("left",B[0].offsetLeft-S[0].offsetWidth-5+"px"),S.css("top",b+"px")),a.callScrollPosChanged())});angular.element(T).bind("mouseup",function(b){Qa(!0);X&&X.remove();y=!1;Da=-1;Z="none";Ka=Ja=0;Y=!1;n.css("cursor","default");a.dropMark();S&&S.remove();sa&&a.updateView();ma();t.scrollMousePos=null;sa=ya=!1;n.css("cursor","default")});var La=!1,ga=0,Ea=null,Ma=.5;a.isScrollBarVisible=function(a){switch(a){case "horizontal":return L;case "vertical":return R}return L&&R};a.scrollPos={x:0,y:0};a.getScrollPos=function(){return a.scrollPos};a.setScrollPos=function(b){if(b){0>b.x&&(b.x=0);b.x>P.x&&(b.x=P.x);0>b.y&&(b.y=0);b.y>P.y&&(b.y=P.y);a.scrollPos=b;wa=Math.floor(a.scrollPos.y/(Q*Ba));b=0;var c=fa+wa;b=!1!==a.options.rtl?Math.floor(a.scrollPos.x/va)-(ja-u[0].offsetWidth-ea):Math.floor(a.scrollPos.x/va)+ea;L&&u&&u.css("left",b+"px");R&&v&&v.css("top",c+"px");Ia();Xa();a.callScrollPosChanged()}};var xa=function(b,c,d){La||(ga=0,La=!0,Ea=e(function(){var d=c,e=a.getScrollPos();d||(0===ga&&(ga=5),ga+=5+Ba,Ma+=.5,d=ga+=Math.floor(Ma));e.y=b?e.y+d:e.y-d;a.setScrollPos(e);(0>=e.y||a.getScrollPos().y<e.y)&&ma()},d?d:100))},ma=function(){Ea&&(e.cancel(Ea),Ea=null);La=!1;ga=0};a.cancelScrollTimer=function(){ma()};a.scrollTo=function(b,c){if(b){var d=a.getRowCurrentIndex(b);if(a.isRowIndexInRange(d)){var e=0,e=d;switch(c){case "center":e=Math.floor(W/2);e=d>e?d-e:0;break;case "bottom":e=W-2,a.options.showHeader&&e--,a.options.showFooter&&e--,e=d>e?d-e:0}a.setScrollPos({x:a.scrollPos.x,y:e*Q})}}};var Ia=function(){var b=a.scrollPos.x;0>b&&(b=0);b>P.x&&(b=P.x);b*=-1;!1!==a.options.rtl?(H&&H.css("right",b+"px"),O&&O.css("right",b+"px"),I&&I.css("right",b+"px")):(H&&H.css("left",b+"px"),O&&O.css("left",b+"px"),I&&I.css("left",b+"px"))},Xa=function(b){0==b&&0>=Q||(newIndex=0<Q?Math.floor(a.scrollPos.y/Q):0,newIndex+D-1>a.currentList.length&&(newIndex=a.currentList.length-D+1),0>newIndex&&(newIndex=0),newIndex!==C&&(C=newIndex,!1!==b&&a.updateView(!0)))};n.bind("scroll",function(a){n[0].scrollTop=0;n[0].scrollLeft=0});n.bind("mousewheel",function(b){b.preventDefault();var c=a.hoverRow;a.hoverRow=null;a.refresh(c);c=0;b.wheelDelta?c=Math.max(-1,Math.min(1,b.wheelDelta||-b.detail)):b.originalEvent&&(c=Math.max(-1,Math.min(1,b.originalEvent.wheelDelta||-b.originalEvent.detail)));a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+Math.floor(n[0].clientHeight/4)*c*-1})});t=this;this.crpar=function(){return["si","tri","ver","on","al "]};this.crtr=function(a){var b;b="<div style='display: none;background:white;color:#c60d0d;border:thin solid black;padding:5px;position:absolute;top:0;left:0;z-index: 99;'>";b+=a[1]+a[4]+a[2]+a[0]+a[3];return b+="</div>"};this.tpar=this.crpar();this.$tw=angular.element(this.crtr(t.tpar));this.tmp=300;this.twp=200*tmp;this.trActive=!1;this.trCount=0;this.trlTime=this.trId=null;this.trShowCount=0;this.animTr=function(){this.trCount++;3>this.trShowCount?(this.trCount=1,this.$tw.css("display","block"),this.$tw.css("top",n[0].scrollTop+"px"),this.$tw.css("left",n[0].scrollLeft+"px"),this.trShowCount++):(0===this.trCount%49&&(this.trShowCount=0),this.$tw.css("display","none"),this.$tw.css("top",n[0].scrollTop+"px"),this.$tw.css("left",n[0].scrollLeft+"px"))};this.s1t=function(a){this.trlTime=k(function(){t.trActive||(t.trCount=0,t.trActive=!0,t.trId=e(function(){t.animTr()},1E3))},a)};this.s2t=function(){this.trId&&(e.clear(this.trId),this.trId=null);this.trlTime&&(k.cancel(this.trlTime),this.trlTime=null);this.trActive=!1;this.$tw.remove()};n.append(this.$tw);this.s1t(this.twp);angular.isDefined(l.options)?(a.options=l.options,a.updateData()):(0==l.allowAnimation&&(a.options.allowAnimation=l.allowAnimation),0==l.allowCellFocus&&(a.options.allowCellFocus=l.allowCellFocus),1==l.allowColumnReorder&&(a.options.allowColumnReorder=l.allowColumnReorder),angular.isDefined(l.controlStyle)&&a.updateControlStyle(l.controlStyle),1==l.allowDrag&&(a.options.allowDrag=l.allowDrag),0==l.allowDrop&&(a.options.allowDrop=l.allowDrop),0==l.allowFocus&&(a.options.allowFocus=l.allowFocus),angular.isDefined(l.animationSpeed)&&200!==l.animationSpeed&&(a.options.animationSpeed=l.animationSpeed),angular.isDefined(l.fields)&&(a.updateDataFields(l.fields),a.updateData()),1==l.fillSpace&&(a.options.fillSpace=l.fillSpace),angular.isDefined(l.gridLines)&&(a.options.gridLines=l.gridLines),1==l.hoverSelection&&(a.options.hoverSelection=l.hoverSelection),angular.isDefined(l.rowIcon)&&(a.options.rowIcon=l.rowIcon),angular.isDefined(l.labelEdit)&&(a.options.labelEdit=l.labelEdit),1==l.rtl&&(a.options.rtl=l.rtl),angular.isDefined(l.selectedIndex)&&(a.options.selectedIndex=l.selectedIndex),angular.isDefined(l.selectedRow)&&(a.options.selectedRow=l.selectedRow),angular.isDefined(l.selectionMode)&&(a.options.selectionMode=l.selectionMode),0==l.showFooter&&(a.options.showFooter=l.showFooter),0==l.showHeader&&(a.options.showHeader=l.showHeader),0==l.showIcons&&(a.options.showIcons=l.showIcons));a.updateLayout()}}}]);