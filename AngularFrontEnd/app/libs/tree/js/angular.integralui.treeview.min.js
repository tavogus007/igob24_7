/*
  filename: angular.integralui.treeview.min.js
  version : 2.0.0
  Copyright © 2014-2015 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Studio for Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
angular.module("integralui").factory("IntegralUITreeViewService",["$rootScope",function(d){var e=null;return{addItem:function(h,m,f){d.$broadcast(h+"-add-item",m,f)},clearItems:function(h,m){d.$broadcast(h+"-clear-items",m)},insertItemAt:function(h,m,f,e){d.$broadcast(h+"-insert-item-at",m,f,e)},insertItemBefore:function(h,m,f){d.$broadcast(h+"-insert-item-before",m,f)},insertItemAfter:function(h,m,f){d.$broadcast(h+"-insert-item-after",m,f)},removeItem:function(h,m){d.$broadcast(h+"-remove-item",m)},removeItemAt:function(h,m,f){d.$broadcast(h+"-remove-item-at",m,f)},exportToJSON:function(h,m,f,e){d.$broadcast(h+"-export-json",m,f,e);h=this.getTempData();this.clearTempData();return h?h:""},loadData:function(h,e,f,B,g){d.$broadcast(h+"-load-data",e,f,B,g)},beginLoad:function(h,e){d.$broadcast(h+"-begin-load",e)},collapse:function(h,e){d.$broadcast(h+"-collapse",e)},endLoad:function(h){d.$broadcast(h+"-end-load")},expand:function(h,e){d.$broadcast(h+"-expand",e)},toggle:function(h,e){d.$broadcast(h+"-toggle",e)},findItemById:function(h,e){d.$broadcast(h+"-find-item-by-id",e);var f=this.getTempData();this.clearTempData();return f?f:null},findItemByText:function(h,e){d.$broadcast(h+"-find-item-by-text",e);var f=this.getTempData();this.clearTempData();return f?f:null},getItemParent:function(h,e){d.$broadcast(h+"-get-item-parent",e);var f=this.getTempData();this.clearTempData();return f?f:null},focus:function(h,e){d.$broadcast(h+"-focus",e)},clearTempData:function(){e=null},ensureVisible:function(h,e,f){d.$broadcast(h+"-ensure-visible",e,f)},getCheckList:function(h,e){d.$broadcast(h+"-get-check-list",e);var f=this.getTempData();this.clearTempData();return f?f:[]},getItemLevel:function(h,e){d.$broadcast(h+"-get-item-level",e);var f=this.getTempData();this.clearTempData();return f?f:0},getFullPath:function(h,e){d.$broadcast(h+"-get-full-path",e);var f=this.getTempData();this.clearTempData();return f?f:""},getList:function(e,m,f){d.$broadcast(e+"-get-list",m,f);e=this.getTempData();this.clearTempData();return e?e:[]},getTempData:function(){return e},setTempData:function(d){e=d},selectedItem:function(e,m){if(m)d.$broadcast(e+"-set-selected-item",m);else{d.$broadcast(e+"-get-selected-item");var f=this.getTempData();this.clearTempData();return f?f:null}},selectedItems:function(e){d.$broadcast(e+"-get-selected-items");e=this.getTempData();this.clearTempData();return e?e:null},getScrollPos:function(e){d.$broadcast(e+"-get-scroll-pos");e=this.getTempData();this.clearTempData();return e?e:{x:0,y:0}},setScrollPos:function(e,m){d.$broadcast(e+"-set-scroll-pos",m)},scrollTo:function(e,m,f){d.$broadcast(e+"-scroll-to",m,f)},updateCheckValues:function(e,m){d.$broadcast(e+"-update-check",m)},refresh:function(e,m,f){d.$broadcast(e+"-refresh",m,f)},resumeLayout:function(e){d.$broadcast(e+"-resume-layout")},suspendLayout:function(e){d.$broadcast(e+"-suspend-layout")},updateLayout:function(e){d.$broadcast(e+"-update-layout")},updateView:function(e){d.$broadcast(e+"-update-view")}}}]).controller("IntegralUITreeViewController",["$scope","$element","$timeout","$window","IntegralUIInternalService","IntegralUIDataService","IntegralUITreeViewService","IntegralUIDragDrop","IntegralUIFilter",function(d,e,h,m,f,B,g,k,ta){var a=this;a.hoverItem=null;this.suppressProcess=!1;a.defaultCheckBoxStyle={general:"iui-checkbox",box:{general:"iui-checkbox-box",disabled:"iui-checkbox-box-disabled",checked:"iui-checkbox-checked",indeterminate:"iui-checkbox-indeterminate",unchecked:"iui-checkbox-unchecked"}};a.defaultStyle={general:"iui-treeview",item:{general:{disabled:"iui-treeview-item-disabled",focused:"iui-treeview-item-focused",normal:"iui-treeview-item",hovered:"iui-treeview-item-hovered",selected:"iui-treeview-item-selected"},checkBox:{general:"iui-checkbox",box:{general:"iui-checkbox-box",disabled:"iui-checkbox-box-disabled",checked:"iui-checkbox-checked",indeterminate:"iui-checkbox-indeterminate",unchecked:"iui-checkbox-unchecked"}},expandBox:{general:"iui-treeview-expand-box",animated:"iui-treeview-expand-box-load",expanded:"iui-treeview-expand-box-open",collapsed:"iui-treeview-expand-box-close"},content:{disabled:"iui-treeview-item-content-disabled",focused:"iui-treeview-item-content-focused",normal:"iui-treeview-item-content",hovered:"iui-treeview-item-content-hovered",selected:"iui-treeview-item-content-selected"}}};a.defaultCheckBoxSettings={autoCheck:!1,style:a.defaultCheckBoxStyle,threeState:!1};a.options={allowAnimation:!0,allowDrag:!1,allowDrop:!0,allowFocus:!0,animationSpeed:200,autoCheck:!1,checkBoxSettings:a.defaultCheckBoxSettings,controlStyle:a.defaultStyle,dataFields:{allowDrag:"allowDrag",allowDrop:"allowDrop",checkBoxSettings:"checkBoxSettings",checked:"checked",checkState:"checkState",content:"content",dataSource:null,enabled:"enabled",expanded:"expanded",hasChildren:"hasChildren",icon:"icon",id:"id",items:"items",pid:"pid",statusIcon:"statusIcon",style:"style",styleFromParent:"styleFromParent",text:"text"},hoverSelection:!1,indent:15,itemIcon:"",itemSpacing:1,labelEdit:!1,loadItem:null,pathSeparator:"\\",rtl:!1,selectedIndex:-1,selectedItem:null,selectedItems:[],selectionMode:"one",showCheckBoxes:!1,showIcons:!0,showStatusIcons:!1};d.$on(d.name+"-add-item",function(b,c,d){a.dataObj.insertAt(c,-1,d,a.itemIsAdded)});d.$on(d.name+"-clear-items",function(b,c){a.dataObj.clear(c,a.itemIsRemoved);c||a.setScrollPos({x:0,y:0})});d.$on(d.name+"-insert-item-at",function(b,c,d,l){a.dataObj.insertAt(c,d,l,a.itemIsAdded)});d.$on(d.name+"-insert-item-after",function(b,c,d){a.dataObj.insertByRef(c,d,!0,a.itemIsAdded)});d.$on(d.name+"-insert-item-before",function(b,c,d){a.dataObj.insertByRef(c,d,!1,a.itemIsAdded)});d.$on(d.name+"-remove-item",function(b,c){a.dataObj.removeAt(c,-1,null,a.itemIsRemoved)});d.$on(d.name+"-remove-item-at",function(b,c,d){a.dataObj.removeAt(null,c,d,a.itemIsRemoved)});this.itemIsAdded=function(){a.updateLayout()};this.itemIsRemoved=function(b,c,d){a.updateLayout()};this.objIsRemoved=function(b,c,d){a.updateLayout()};this.getCheckValue=function(b){return"checked"==b[a.options.dataFields.checkState]?"checked":1==a.options.checkBoxSettings.threeState&&"indeterminate"==b[a.options.dataFields.checkState]?"indeterminate":"unchecked"};this.changeCheckValue=function(b){if(1==a.options.autoCheck||1==a.options.checkBoxSettings.autoCheck){var c=a.getCheckValue(b),p=!1,p=1==a.options.checkBoxSettings.threeState?a.callCheckValueChanging(b,c):a.callCheckValueChanging(b,"checked"==c?!0:!1);if(!1!==p){if(1==a.options.checkBoxSettings.threeState)switch(c){case "checked":c="unchecked";break;case "indeterminate":c="checked";break;case "unchecked":c="indeterminate"}else c="unchecked"==c||"indeterminate"==c?"checked":"unchecked";b[a.options.dataFields.checkState]=c;b[a.options.dataFields.checked]="checked"==c?!0:!1;d.$apply()}}};this.callCheckValueChanging=function(b,c){var p=!0;a.allowEvents&&(p=1==a.options.checkBoxSettings.threeState?angular.isDefined(d.events)&&d.events.itemCheckstateChanging?d.events.itemCheckstateChanging({item:b,value:c}):d.itemCheckstateChanging({e:{item:b,value:c}}):angular.isDefined(d.events)&&d.events.itemCheckedChanging?d.events.itemCheckedChanging({item:b,value:c}):d.itemCheckedChanging({e:{item:b,value:c}}));return p};this.callCheckValueChanged=function(b,c){a.allowEvents&&(retValue=1==a.options.checkBoxSettings.threeState?angular.isDefined(d.events)&&d.events.itemCheckstateChanged?d.events.itemCheckstateChanged({item:b,value:c}):d.itemCheckstateChanged({e:{item:b,value:c}}):angular.isDefined(d.events)&&d.events.itemCheckedChanged?d.events.itemCheckedChanged({item:b,value:c}):d.itemCheckedChanged({e:{item:b,value:c}}))};var D=[],t=!1;this.fillCheckList=function(b){if(b&&1==a.options.checkBoxSettings.threeState&&!t){t=!0;D.length=0;D.push({item:b,value:b[a.options.dataFields.checkState]});a.updateListChildItemCheckValue(b);a.updateListParentItemCheckValue(b);for(var c=0,c=0;c<D.length;c++)D[c].item[a.options.dataFields.checkState]=D[c].value;var d=h(function(){c==D.length&&(t=!1);h.cancel(d)},1)}};this.getItemCheckValue=function(b){for(var c="unchecked",d=!1,l=0;l<D.length;l++)if(D[l].item==b){d=!0;c=D[l].value;break}d||(c=b[a.options.dataFields.checkState]);return c};this.updateListParentItemCheckValue=function(b){for(b=a.getParent(b);b;){var c=b[a.options.dataFields.items];if(c){for(var d=0,l=0,e=0;e<c.length;e++){var f=a.getItemCheckValue(c[e]);"checked"==f?d++:"indeterminate"==f&&l++}e={item:b};e.value=d==c.length?"checked":0<d||0<l?"indeterminate":"unchecked";D.push(e)}b=a.getParent(b)}};this.updateListChildItemCheckValue=function(b){if(b){var c=b[a.options.dataFields.items];if(c)for(var d=0;d<c.length;d++){var l={item:c[d]};"checked"==a.getItemCheckValue(b)?l.value="checked":l.value="unchecked";D.push(l);a.updateListChildItemCheckValue(c[d])}}};this.updateParentItemCheckValue=function(b){for(b=a.getParent(b);b;){var c=b[a.options.dataFields.items];if(c){for(var d=0,l=0,e=0;e<c.length;e++)"checked"==c[e][a.options.dataFields.checkState]?d++:"indeterminate"==c[e][a.options.dataFields.checkState]&&l++;b[a.options.dataFields.checkState]=d==c.length?"checked":0<d||0<l?"indeterminate":"unchecked"}b=a.getParent(b)}};this.updateItemCheckValue=function(b,c){if("checked"==c||"unchecked"==c)b[a.options.dataFields.checkState]=c;var d=b[a.options.dataFields.items];if(d&&0<d.length)for(var e=0;e<d.length;e++)a.updateItemCheckValue(d[e],b[a.options.dataFields.checkState]);void 0!=b[a.options.dataFields.checkState]&&(d=a.getParent(b))&&d[a.options.dataFields.checkState]!=b[a.options.dataFields.checkState]&&a.updateParentItemCheckValue(b)};this.updateCheckValues=function(b){if(1==a.options.checkBoxSettings.threeState){b=a.dataObj.getList(b);for(var c=0;c<b.length;c++)a.updateItemCheckValue(b[c])}};d.$on(d.name+"-update-check",function(b,c){a.updateCheckValues(c)});d.$on(d.name+"-get-check-list",function(b,c){a.updateCheckValues();void 0==c&&(c=1==a.options.checkBoxSettings.threeState?"checked":!0);var d=1==a.options.checkBoxSettings.threeState?a.options.dataFields.checkState:a.options.dataFields.checked,e={operation:"=",value:c},d=ta.filter(a.getFullList(),d,e);g.setTempData(d)});this.updateCheckBoxSettings=function(b){a.options.checkBoxSettings=b?{autoCheck:f.isFieldAvailable(b.autoCheck,!1),style:Z(b.style),threeState:f.isFieldAvailable(b.threeState,!1)}:{autoCheck:!1,style:a.defaultCheckBoxStyle,threeState:!1}};var w=a.options.indent,r=0;a.currentList=[];a.indentList=[];a.longestItem=null;a.isThereChildItems=!1;var v=function(b,c,d,e){b.type="item";b[a.options.dataFields.id]||(b[a.options.dataFields.id]=f.getUniqueId());d&&(b[a.options.dataFields.pid]=d);e?a.fullList.push(b):(a.currentList.push(b),a.indentList.push(c),b[a.options.dataFields.text]&&(c=b[a.options.dataFields.text].length+c/w,r<c&&(r=c,a.longestItem=b)))};this.isThereChildItems=!1;var G=function(b,c,d,e){if(b[a.options.dataFields.items]){if(v(b,c,d,e),!e&&!a.isThereChildItems&&b[a.options.dataFields.items]&&0<b[a.options.dataFields.items].length&&(a.isThereChildItems=!0),e||(b?b[a.options.dataFields.expanded]||void 0===b[a.options.dataFields.expanded]:1))for(d=0;d<b[a.options.dataFields.items].length;d++)G(b[a.options.dataFields.items][d],c+w,b[a.options.dataFields.id],e)}else v(b,c,d,e)};a.fullList=[];this.getFullList=function(b){a.fullList.length=0;b=a.dataObj.getList(b);for(var c=0;c<b.length;c++)G(b[c],0,null,!0);return a.fullList};this.getCurrentList=function(){return a.currentList};this.updateCurrentList=function(){a.currentList.length=0;a.indentList.length=0;a.isThereChildItems=!1;r=0;var b=a.dataObj.getList();if(b)for(var c=0;c<b.length;c++)G(b[c],0,null,!1)};this.getDataFields=function(a){return{content:a.content?a.content:"content",icon:a.icon?a.icon:"icon",id:a.id?a.id:"id",pid:a.pid?a.pid:"pid",objects:a.items?a.items:"items",statusIcon:a.statusIcon?a.statusIcon:"statusIcon",text:a.text?a.text:"text"}};a.dataObj=new B({objects:d.items,events:{clear:function(a){return angular.isDefined(d.events)&&d.events.clear?d.events.clear({parent:a.e.parent}):d.clear(a)},objAdded:function(a){return angular.isDefined(d.events)&&d.events.itemAdded?d.events.itemAdded({item:a.e.item}):d.itemAdded(a)},objAdding:function(a){return angular.isDefined(d.events)&&d.events.itemAdding?d.events.itemAdding({item:a.e.item}):d.itemAdding(a)},objRemoved:function(a){return angular.isDefined(d.events)&&d.events.itemRemoved?d.events.itemRemoved({item:a.e.item}):d.itemRemoved(a)},objRemoving:function(a){return angular.isDefined(d.events)&&d.events.itemRemoving?d.events.itemRemoving({item:a.e.item}):d.itemRemoving(a)}},fields:a.getDataFields(a.options.dataFields)});d.$on(d.name+"-load-data",function(b,c,d,e,f){a.loadData(c,d,e,f)});d.$on(d.name+"-export-json",function(b,c,d,e){g.setTempData(a.exportToJSON(c,d,e))});this.exportToJSON=function(b,c,d){d=d?d:null;var e=!1!==c?a.getFullList():a.dataObj.getList();b=b?b:[a.options.dataFields.allowDrag,a.options.dataFields.allowDrop,a.options.dataFields.allowFocus,a.options.dataFields.autoCheck,a.options.dataFields.checkBoxSettings,a.options.dataFields.checked,a.options.dataFields.checkState,a.options.dataFields.content,a.options.dataFields.enabled,a.options.dataFields.expanded,a.options.dataFields.hasChildren,a.options.dataFields.icon,a.options.dataFields.id,a.options.dataFields.pid,a.options.dataFields.statusIcon,a.options.dataFields.style,a.options.dataFields.text];!1===c&&b.push(a.options.dataFields.items);return JSON.stringify(e,b,d)};this.loadData=function(b,c,p,e){a.allowEvents=!1;a.updateDataFields(p);var f=[],g=a.options.dataFields;a.dataObj.clear(c);if(b)if(!1!==e){var h=[];b.forEach(function(a,b){var c=a[g.pid];h[c]?(h[c][g.items]||(h[c][g.items]=[]),h[a[g.id]]=a,h[c][g.items].push(a)):(h[a[g.id]]=a,f.push(a))});h.length=0}else f=b;if(c)for(c[a.options.dataFields.items]=f,b=0;b<c[a.options.dataFields.items].length;b++)c[a.options.dataFields.items][b][a.options.dataFields.pid]=c[a.options.dataFields.id];else angular.isDefined(d.items)&&(d.items=f);a.dataObj=new B({objects:d.items,events:a.dataEvents,fields:a.getDataFields(a.options.dataFields)});a.updateLayout();a.allowEvents=!0};this.updateDataFields=function(b){b&&(a.options.dataFields={allowDrag:b.allowDrag?b.allowDrag:"allowDrag",allowDrop:b.allowDrop?b.allowDrop:"allowDrop",allowFocus:b.allowFocus?b.allowFocus:"allowFocus",autoCheck:b.autoCheck?b.autoCheck:"autoCheck",checkBoxSettings:b.checkBoxSettings?b.checkBoxSettings:"checkBoxSettings",checked:b.checked?b.checked:"checked",checkState:b.checkState?b.checkState:"checkState",content:b.content?b.content:"content",dataSource:b.dataSource,enabled:b.enabled?b.enabled:"enabled",expanded:b.expanded?b.expanded:"expanded",hasChildren:b.hasChildren?b.hasChildren:"hasChildren",icon:b.icon?b.icon:"icon",id:b.id?b.id:"id",items:b.items?b.items:"items",pid:b.pid?b.pid:"pid",statusIcon:b.statusIcon?b.statusIcon:"statusIcon",style:b.style?b.style:"style",text:b.text?b.text:"text"},a.dataObj&&a.dataObj.updateDataFields(a.options.dataFields))};this.updateData=function(){a.options.dataFields.dataSource&&(a.loadData(a.options.dataFields.dataSource),a.dataObj=new B({objects:d.items,events:a.dataEvents,fields:a.getDataFields(a.options.dataFields)}))};var F=!1;this.dragDropStatus=function(a){if(a)F=a;else return F};this.getDnDSource=function(a){return{text:a.dataTransfer?a.dataTransfer.getData("text"):a.originalEvent.dataTransfer?a.originalEvent.dataTransfer.getData("text"):""}};var H=angular.element('<div class="iui-drop-marker" data-element="dropmark"></div>');this.getDropMarkLine=function(){return dropMarkLine};angular.element(m).bind("dragenter",function(b){a.dropMark()});angular.element(m).bind("dragend",function(b){a.removeDropMark();a.dragIcon&&angular.element(a.dragIcon).remove();a.cancelScrollTimer()});a.getMousePos=function(a){return{x:a.pageX?a.pageX:a.originalEvent?a.originalEvent.pageX:0,y:a.pageY?a.pageY:a.originalEvent?a.originalEvent.pageY:0}};this.getTreeName=function(){return angular.isDefined(d.name)?d.name:""};e.bind("dragenter",function(b){b.preventDefault();var c=k.getData();c.source||(c.source=a.getDnDSource(b));b={sourceTree:c.sourceCtrl?c.sourceCtrl.getTreeName():"",dragItem:c.source,targetTree:a.getTreeName(),targetItem:c.target,mousePos:a.getMousePos(b)};a.callDragEnter(b)});e.bind("dragover",function(b){b.preventDefault();var c=!0;b.dataTransfer?c="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(c="none"===b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(c){b.dataTransfer?b.dataTransfer.dropEffect=a.options.allowDrop?"move":"none":b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.dropEffect=a.options.allowDrop?"move":"none");c=k.getData();c.source||(c.source=a.getDnDSource(b));k.setData({source:c.source,sourceCtrl:c.sourceCtrl,target:null,dropPos:-1});c={sourceTree:c.sourceCtrl?c.sourceCtrl.getTreeName():"",dragItem:c.source,targetTree:a.getTreeName(),targetItem:null,isDropAllowed:a.options.allowDrop,dropPos:-1,mousePos:a.getMousePos(b)};a.callDragOver(c);c=a.getMousePos(b);b=c.y+16;var c=c.x+20,p=a.getDropMarkWindow();p.empty();p.append("<span class='iui-drop-marker-move-end'></span><span class='iui-drop-marker-title'>"+(d.name?d.name:"TreeView")+"</span>");a.updateDropMarkElem(a.getDropMarkWindow(),{top:b,left:c});a.dropMark(!0)}});e.bind("drop",function(b){b.preventDefault();a.dropMark();var c=!0;b.dataTransfer?c="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(c="none"===b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(c&&(c=k.getData(),c.source||(c.source=a.getDnDSource(b)),c.source)){var p={sourceTree:c.sourceCtrl?c.sourceCtrl.getTreeName():"",dragItem:c.source,targetTree:a.getTreeName(),targetItem:null,isDropAllowed:a.options.allowDrop,dropPos:-1,mousePos:a.getMousePos(b)};!1!==a.callDragDrop(p)&&(a.drop(c),d.$$phase||d.$apply())}k.clearData();b.stopPropagation()});e.bind("dragleave",function(b){b.preventDefault();a.dropMark();var c=k.getData();c.source||(c.source=a.getDnDSource(b));b={sourceTree:c.sourceCtrl?c.sourceCtrl.getTreeName():"",dragItem:c.source,targetTree:a.getTreeName(),targetItem:c.target,mousePos:a.getMousePos(b)};a.callDragLeave(b);a.cancelScrollTimer()});e.bind("dragend",function(b){b.preventDefault();a.dropMark();k.getData().source||k.clearData()});e.bind("mouseleave",function(b){b.preventDefault();a.dropMark();a.hoverItem=null});this.containsMousePos=function(a,c){return k.hitTest(a,c,{left:0,top:0,right:e[0].clientWidth,bottom:e[0].clientHeight})};this.isPopupActive=function(){return!1};var M=function(b,c){var d=a.options.dataFields;b[d.items]||(b[d.items]=[]);b[d.items].length=0;if(b[c.rows]&&0<b[c.rows].length)for(var e=0;e<b[c.rows].length;e++)b[d.items].push(M(b[c.rows][e],c));return b},z=function(b,c){var d=!1;c.sourceCtrl&&(d=c.sourceCollection.removeAt(b,-1,null,c.sourceCtrl.objIsRemoved));d&&("row"==b.type&&(b=M(b,c.sourceCtrl.options.rowFields)),0===c.dropPos?a.dataObj.insertAt(b,-1,c.target,a.itemIsAdded):1===c.dropPos||2===c.dropPos?1===c.dropPos?a.dataObj.insertByRef(b,c.target,!1,a.itemIsAdded):a.dataObj.insertByRef(b,c.target,!0,a.itemIsAdded):a.dataObj.insertAt(b,-1,null,a.itemIsAdded))};this.drop=function(b){if(b&&b.sourceCtrl){b.sourceCtrl.suppressProcess=!0;b.sourceCtrl.suspendLayout();a.suspendLayout();var c=b.source;if(Array.isArray(b.source)){for(var e=[],l=0;l<b.source.length;l++){for(var f=!1,g=b.sourceCollection.getParent(b.source[l]);g;){if(b.sourceCtrl.isObjInSelList(g)){f=!0;break}g=b.sourceCollection.getParent(g)}f||e.push(b.source[l])}if(0<e.length)if(c=e[e.length-1],l=b.sourceCtrl.getObjCurrentIndex(e[0]),f=b.sourceCtrl.getObjCurrentIndex(c),l<=f)for(l=0;l<e.length;l++)z(e[l],b);else for(l=e.length-1;0<=l;l--)z(e[l],b)}else z(b.source,b);b.sourceCtrl!==a?(a.resumeLayout(),b.sourceCtrl.resumeLayout()):a.resumeLayout();b.sourceCtrl.multiSelection(!1);var k=h(function(){if(c){b.sourceCtrl.clearPrevSelection(c);a.itemSelection(c);var e=a.getElemFromItem(c);e&&(e=a.getElement(e))&&e[0].focus();d.$apply();h.cancel(k)}},1);b.sourceCtrl.suppressProcess=!1}};this.isDragAllowed=function(b){return a.options.allowDrag?b&&(b[a.options.dataFields.allowDrag]||void 0===b[a.options.dataFields.allowDrag])?!0:!1:!1};this.isChildOf=function(b,c){var d=!1;if(b&&c){var e=c[a.options.dataFields.items];if(e&&0<e.length)for(var g=0;g<e.length;g++){if(f.isEqual(b[a.options.dataFields.id],e[g][a.options.dataFields.id])){d=!0;break}else d=a.isChildOf(b,e[g]);if(d)break}}return d};this.isParentOf=function(b,c){var d=a.dataObj.getParent(c);return b&&c&&d&&f.isEqual(b[a.options.dataFields.id],d[a.options.dataFields.id])?!0:!1};this.isDropAllowed=function(b,c,d){var e=a.options.allowDrop;if(e&&b&&c&&(e=c[a.options.dataFields.allowDrop]||void 0===c[a.options.dataFields.allowDrop]?!0:!1))if(Array.isArray(b))for(var g=0;g<b.length;g++){if(f.isEqual(b[g][a.options.dataFields.id],c[a.options.dataFields.id])||0===d&&a.isParentOf(c,b[g])||a.isChildOf(c,b[g])){e=!1;break}if(!e)break}else if(f.isEqual(b[a.options.dataFields.id],c[a.options.dataFields.id])||0===d&&a.isParentOf(c,b)||a.isChildOf(c,b))e=!1;return e};this.getDropMarkWindow=function(){for(var a=H,c=angular.element(document.body).children(),d=0;d<c.length;d++){var e=angular.element(c[d]);if(e[0].attributes&&e[0].attributes["data-element"]&&"dropmark"===e[0].attributes["data-element"].value){a=e;break}}return a};this.dropMark=function(b,c){c||(c=a.getDropMarkWindow());if(c){var d="none";this.options.allowDrop&&(d=b?"block":"none");angular.element(c).css("display",d)}};this.updateDropMarkElem=function(a,c){a&&c&&(a.css("top",c.top+"px"),a.css("left",c.left+"px"),a.css("width",c.width+"px"))};var ga=!1,N=angular.element('<input type="text" style="position:absolute" />');this.labelEditStatus=function(a){if(a)ga=a;else return ga};this.getEditBox=function(){return N};this.updateEditBox=function(a){N&&a&&(N.css("top",a.top+"px"),N.css("left",a.left+"px"),N.css("width",a.width+"px"))};this.allowEvents=!0;this.callAfterCollapse=function(a){angular.isDefined(d.events)&&d.events.afterCollapse&&d.events.afterCollapse({item:a});d.afterCollapse({e:{item:a}})};this.callAfterExpand=function(a){angular.isDefined(d.events)&&d.events.afterExpand&&d.events.afterExpand({item:a});d.afterExpand({e:{item:a}})};this.callAfterEdit=function(a){angular.isDefined(d.events)&&d.events.afterLabelEdit&&d.events.afterLabelEdit({item:a});d.afterLabelEdit({e:{item:a}})};this.callAfterSelect=function(a){angular.isDefined(d.events)&&d.events.afterSelect?d.events.afterSelect({item:a}):d.afterSelect({e:{item:a}});angular.isDefined(d.events)&&d.events.selectionChanged?d.events.selectionChanged({item:a}):d.selectionChanged({e:{item:a}})};this.callBeforeCollapse=function(a){var c=!0;return c=angular.isDefined(d.events)&&d.events.beforeCollapse?d.events.beforeCollapse({item:a}):d.beforeCollapse({e:{item:a}})};this.callBeforeExpand=function(a){var c=!0;return c=angular.isDefined(d.events)&&d.events.beforeExpand?d.events.beforeExpand({item:a}):d.beforeExpand({e:{item:a}})};this.callBeforeEdit=function(a){var c=!0;return c=angular.isDefined(d.events)&&d.events.beforeLabelEdit?d.events.beforeLabelEdit({item:a}):d.beforeLabelEdit({e:{item:a}})};this.callDragEnter=function(a){angular.isDefined(d.events)&&d.events.dragEnter?d.events.dragEnter({sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,mousePos:a.mousePos}):d.dragEnter({e:{sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,mousePos:a.mousePos}})};this.callDragOver=function(a){var c=!0;return c=angular.isDefined(d.events)&&d.events.dragOver?d.events.dragOver({sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,isDropAllowed:a.isDropAllowed,dropPos:a.dropPos,mousePos:a.mousePos}):d.dragOver({e:{sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,isDropAllowed:a.isDropAllowed,dropPos:a.dropPos,mousePos:a.mousePos}})};this.callDragDrop=function(a){var c=!0;return c=angular.isDefined(d.events)&&d.events.dragDrop?d.events.dragDrop({sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,isDropAllowed:a.isDropAllowed,dropPos:a.dropPos,mousePos:a.mousePos}):d.dragDrop({e:{sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,isDropAllowed:a.isDropAllowed,dropPos:a.dropPos,mousePos:a.mousePos}})};this.callDragLeave=function(a){angular.isDefined(d.events)&&d.events.dragLeave?d.events.dragLeave({sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,mousePos:a.mousePos}):d.dragLeave({e:{sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,mousePos:a.mousePos}})};this.callItemClick=function(a,c){angular.isDefined(d.events)&&d.events.itemClick&&d.events.itemClick({item:a,mousePos:c});d.itemClick({e:{item:a,mousePos:c}})};this.callItemDblClick=function(a,c){angular.isDefined(d.events)&&d.events.itemDblClick&&d.events.itemDblClick({item:a,mousePos:c});d.itemDblclick({e:{item:a,mousePos:c}})};this.callItemHover=function(a){angular.isDefined(d.events)&&d.events.itemHover&&d.events.itemHover({item:a});d.itemHover({e:{item:a}})};this.callItemRightClick=function(a,c){angular.isDefined(d.events)&&d.events.itemRightClick&&d.events.itemRightClick({item:a,mousePos:c});d.itemRightclick({e:{item:a,mousePos:c}})};this.callKeyDown=function(a,c){angular.isDefined(d.events)&&d.events.keyDown?d.events.keyDown({event:a,item:c}):d.keyDown({e:{event:a,item:c}})};this.callKeyPress=function(a,c){angular.isDefined(d.events)&&d.events.keyPress?d.events.keyPress({event:a,item:c}):d.keyPress({e:{event:a,item:c}})};this.callKeyUp=function(a,c){angular.isDefined(d.events)&&d.events.keyUp?d.events.keyUp({event:a,item:c}):d.keyUp({e:{event:a,item:c}})};e.bind("click",function(b){1===b.which&&a.callItemClick(null,a.getMousePos(b))});e.bind("dblclick",function(b){b.preventDefault();1===b.which&&a.callItemDblClick(null,a.getMousePos(b));b.stopPropagation()});e.bind("mousedown",function(b){3===b.which&&a.callItemRightClick(null,a.getMousePos(b));b.stopPropagation()});this.toggle=function(b,c){if(b){if(b[a.options.dataFields.hasChildren]||b[a.options.dataFields.items]&&0!==b[a.options.dataFields.items].length)if(!c||!1===b[a.options.dataFields.expanded])if(!1!==c||!1!==b[a.options.dataFields.expanded]){var d=void 0!==c?c:!1!==b[a.options.dataFields.expanded]?!0:!1,e=!0,e=void 0!==c?c?a.callBeforeExpand(b):a.callBeforeCollapse(b):d?a.callBeforeCollapse(b):a.callBeforeExpand(b);!1!==e&&(e=b[a.options.dataFields.expanded],b[a.options.dataFields.expanded]=void 0!==c?c:!d,b[a.options.dataFields.expanded]?a.callAfterExpand(b):a.callAfterCollapse(b),e!==b[a.options.dataFields.expanded]&&a.updateLayout())}}else{a.suspendLayout();d=a.getFullList();for(e=0;e<d.length;e++)a.toggle(d[e],c);a.resumeLayout()}};d.$on(d.name+"-begin-load",function(b,c){a.options.loadItem=c});d.$on(d.name+"-collapse",function(b,c){a.toggle(c,!1)});d.$on(d.name+"-end-load",function(b){a.options.loadItem=null});d.$on(d.name+"-expand",function(b,c){a.toggle(c,!0)});d.$on(d.name+"-toggle",function(b,c){a.toggle(c)});this.getTabIndex=function(){return e[0].attributes&&e[0].attributes.tabindex?e[0].attributes.tabindex.value:""};this.updateFocus=function(b){if(1==a.options.allowFocus)var c=h(function(){if(b){var d=a.getElemFromItem(b);d&&(d=a.getElement(d))&&d[0].focus()}else e[0].focus();h.cancel(c)},5)};d.$on(d.name+"-focus",function(b,c){a.updateFocus(c)});var W=!1;this.getElement=function(a,c){var d=null;c||(c="content");if(a)for(var e=a.children(),f=0;f<e.length;f++){var g=angular.element(e.eq(f));if(g[0].attributes&&g[0].attributes["data-element"]&&g[0].attributes["data-element"].value===c){d=g;break}}return d};this.getElemFromItem=function(b){var c=null;if(b){b=a.getItemCurrentIndex(b);var d=e.find("li");if(d&&0<d.length)for(var f=0;f<d.length;f++){var g=angular.element(d[f]);if(g[0].attributes["data-index"]&&g[0].attributes["data-index"].value.toString()===b.toString()){c=g;break}}}return c};this.getIndent=function(b){var c=0;if(b)for(parent=a.dataObj.getParent(b);parent;)c+=a.options.indent,parent=a.dataObj.getParent(parent);return c};this.getItemCurrentIndex=function(b){return b&&a.currentList?a.currentList.indexOf(b):-1};this.getObjCurrentIndex=function(b){return a.getItemCurrentIndex(b)};this.getObjState=function(b){if(b)switch(b.type){case "item":if(0==b[a.options.dataFields.enabled])return"disabled";if(1==b.selected&&a.isObjInSelList(b))return"selected";if(b==a.hoverItem)return"hovered"}return"normal"};this.getItemFromChildElem=function(b){return b?(b=angular.element(b))?a.getItemFromElem(b[0].parentElement):null:null};this.getItemFromElem=function(b){if(b&&(b=angular.element(b))&&b[0].attributes["data-index"]&&(b=b[0].attributes["data-index"].value,a.isIndexInRange(b)))return a.currentList[b]};this.isIndexInRange=function(b){return 0<=b&&b<a.currentList.length};this.isItemEnabled=function(b){return f.isEnabled(b[a.options.dataFields.enabled])};this.mouseButtonStatus=function(a){W=a};d.$on(d.name+"-ensure-visible",function(b,c,d){a.ensureVisible(c,d)});d.$on(d.name+"-find-item-by-id",function(b,c){g.setTempData(a.findItemById(c))});d.$on(d.name+"-find-item-by-text",function(b,c){g.setTempData(a.findItemByText(c))});d.$on(d.name+"-get-full-path",function(b,c){g.setTempData(a.getFullPath(c))});d.$on(d.name+"-get-item-level",function(b,c){g.setTempData(a.getLevel(c))});d.$on(d.name+"-get-item-parent",function(b,c){g.setTempData(a.getParent(c))});d.$on(d.name+"-get-list",function(b,c,d){1==d?g.setTempData(a.getFullList(c)):g.setTempData(a.getList(c))});this.ensureVisible=function(b,c){if(b){a.suspendLayout();for(var d=[],e=a.getParent(b);e;)d.push(e),e=a.getParent(e);for(e=d.length-1;0<=e;e--)a.toggle(d[e],!0);a.resumeLayout();c||(c="center");a.scrollTo(b,c)}};this.findItemById=function(b){return a.dataObj.findObjectById(b)};this.findItemByText=function(b){return a.dataObj.findObjectByText(b)};this.getFullPath=function(b){var c="";if(b)for(c=b[a.options.dataFields.text],b=a.getParent(b);b;)c=[b[a.options.dataFields.text],a.options.pathSeparator,c].join(""),b=a.getParent(b);return c};this.getLevel=function(a){var c=0;for(a=this.getParent(a);a;)c++,a=this.getParent(a);return c};this.getParent=function(b){return a.dataObj.getParent(b)};this.getList=function(b){return a.dataObj.getList(b)};this.getFirstItem=function(){for(var b=null,c=0;c<a.currentList.length;c++)if(a.isItemEnabled(a.currentList[c])){b=a.currentList[c];break}return b};this.getPrevItem=function(b){var c=null;if(0<=b&&b<a.currentList.length)for(--b;0<=b;b--)if(a.isItemEnabled(a.currentList[b])){c=a.currentList[b];break}return c};this.getNextItem=function(b){var c=null;for(b+=1;b<a.currentList.length;b++)if(a.isItemEnabled(a.currentList[b])){c=a.currentList[b];break}return c};this.getLastItem=function(){for(var b=null,c=a.currentList.length-1;0<=c;c--)if(a.isItemEnabled(a.currentList[c])){b=a.currentList[c];break}return b};this.updateSelectionStatus=function(b){switch(b){case "shift":switch(a.options.selectionMode){case "multi-simple":a.multiSelection(!0);a.shiftKeyStatus(!1);break;case "multi-extended":a.multiSelection(!0);a.shiftKeyStatus(!0);break;default:a.multiSelection(!1),a.shiftKeyStatus(!1)}break;case "ctrl":switch(a.options.selectionMode){case "multi-simple":a.multiSelection(!0);break;case "multi-extended":a.multiSelection(!0);break;default:a.multiSelection(!1)}}};e.bind("keydown",function(b){switch(b.keyCode){case 16:a.updateSelectionStatus("shift");break;case 17:a.updateSelectionStatus("ctrl");break;default:(b.ctrlKey||b.metaKey)&&a.updateSelectionStatus("ctrl"),b.shiftKey&&a.updateSelectionStatus("shift")}});a.allowUpdate=!0;this.suspendLayout=function(){a.allowUpdate=!1};this.resumeLayout=function(){a.allowUpdate=!0;a.updateLayout()};d.$on(d.name+"-refresh",function(b,c,d){a.refresh(c,d)});d.$on(d.name+"-resume-layout",function(b){a.resumeLayout()});d.$on(d.name+"-suspend-layout",function(b){a.suspendLayout()});d.$on(d.name+"-update-layout",function(b){a.updateLayout()});d.$on(d.name+"-update-view",function(b){a.updateView()});d.$on(d.name+"-get-scroll-pos",function(b){g.setTempData(a.getScrollPos())});d.$on(d.name+"-set-scroll-pos",function(b,c){a.setScrollPos(c)});d.$on(d.name+"-scroll-to",function(b,c,d){a.scrollTo(c,d)});var T=!1,O=!1;this.shiftKeyStatus=function(a){if(void 0!=a)T=a;else return T};this.multiSelection=function(a){if(void 0!=a)O=a;else return O};this.isItemSelected=function(a){return f.isSelected(a)};this.clearPrevSelection=function(b){for(var c=0;c<a.options.selectedItems.length;c++)b&&!f.isEqual(a.options.selectedItems[c][a.options.dataFields.id],b[a.options.dataFields.id])?a.options.selectedItems[c].selected=!1:b||(a.options.selectedItems[c].selected=!1);a.options.selectedItems.length=0;b&&a.isItemEnabled(b)&&a.options.selectedItems.push(b);a.refresh()};this.itemSelection=function(b,c){if(b){if("none"!==a.options.selectionMode)if(a.isItemEnabled(b)){var e=a.itemSelection(),g=!0;e&&(g=!f.isEqual(e[a.options.dataFields.id],b[a.options.dataFields.id]));var h=!0,h=angular.isDefined(d.events)&&d.events.beforeSelect?d.events.beforeSelect({item:b}):d.beforeSelect({e:{item:b}});if(!1!==h)if(g){g=!0;"multi-extended"===a.options.selectionMode&&(g=!a.isObjInSelList(b));g&&(W&&T?a.clearPrevSelection():O||"multi-simple"===a.options.selectionMode||a.clearPrevSelection());a.options.selectedItem=b;if(W&&T){if(g=a.getItemCurrentIndex(e),e=a.getItemCurrentIndex(b),g>e&&(h=g,g=e,e=h),a.isIndexInRange(g)&&a.isIndexInRange(e))for(;g<=e;g++)a.currentList[g].selected=!0,a.options.selectedItems.push(a.currentList[g])}else W&&(O||"multi-simple"===a.options.selectionMode)?(e=null===b.selected||"undefined"===b.selected?!1:b.selected,b.selected=!e,b.selected?a.isObjInSelList(b)||a.options.selectedItems.push(b):a.options.selectedItems=a.options.selectedItems.filter(function(a){return a!=b})):(b.selected=!0,a.isObjInSelList(b)||a.options.selectedItems.push(b));angular.isDefined(d.selectedItem)&&(d.selectedItem=b);a.callAfterSelect(b);a.refresh()}else if(O||"multi-simple"===a.options.selectionMode)e=null===b.selected||"undefined"===b.selected?!1:b.selected,c&&"undefined"!==c&&(e=c),b.selected=!e,b.selected?a.isObjInSelList(b)||a.options.selectedItems.push(b):a.options.selectedItems=a.options.selectedItems.filter(function(a){return a!=b}),a.callAfterSelect(b),a.refresh()}else a.clearPrevSelection()}else return a.options.selectedItem};this.updateSelection=function(b){"multi-simple"!==a.options.selectionMode&&0<a.options.selectedItems.length&&!T&&!O&&a.clearPrevSelection(b)};this.selectFirstItem=function(){for(var b=null,c=0;c<a.currentList.length;c++)if(a.isItemEnabled(a.currentList[c])){b=a.currentList[c];break}this.itemSelection(b);return a.options.selectedItem};this.isObjInSelList=function(b){var c=!1,d=a.options.selectedItems;if(b&&d)for(var e=0;e<d.length;e++)if(f.isEqual(d[e][a.options.dataFields.id],b[a.options.dataFields.id])){c=!0;break}return c};this.getItemAt=function(b,c){var d=null,g=null,h=null,k=e.find("li");if(k&&0<k.length)for(var m=0;m<k.length;m++)if(d=angular.element(k[m]),g=f.getPageRect(d),f.checkHit(b,c,g)){h=a.getItemFromElem(d);break}return h};this.resetSelection=function(){switch(a.options.selectionMode){case "none":a.clearPrevSelection();break;default:a.clearPrevSelection(a.itemSelection())}};d.$on(d.name+"-get-selected-item",function(b){g.setTempData(a.itemSelection())});d.$on(d.name+"-set-selected-item",function(b,c){a.itemSelection(c)});d.$on(d.name+"-get-selected-items",function(b){g.setTempData(a.options.selectedItems)});d.$watch("options.allowDrag",function(b,c){b!==c&&(a.options.allowDrag=b,a.updateView())});d.$watch("allowDrag",function(b,c){b!==c&&(a.options.allowDrag=b,a.updateView())});d.$watch("options.allowDrop",function(b,c){b!==c&&(a.options.allowDrop=b,a.updateView())});d.$watch("allowDrop",function(b,c){b!==c&&(a.options.allowDrop=b,a.updateView())});d.$watch("options.allowFocus",function(b,c){b!==c&&(a.options.allowFocus=b)});d.$watch("allowFocus",function(b,c){b!==c&&(a.options.allowFocus=b)});d.$watch("options.autoCheck",function(b,c){b!==c&&(a.options.autoCheck=b,a.updateView())});d.$watch("autoCheck",function(b,c){b!==c&&(a.options.autoCheck=b,a.updateView())});d.$watch("checkBoxSettings",function(b,c){b!==c&&a.updateCheckBoxSettings(b)});d.$watch("controlStyle",function(b,c){b!==c&&a.updateControlStyle(b)});d.$watch("options.dataFields",function(b,c){b!==c&&(a.updateDataFields(b),a.UpdateData())});d.$watch("fields",function(b,c){b!==c&&(a.options.dataFields=b,a.UpdateData())});d.$watch("options.hoverSelection",function(b,c){b!==c&&(a.options.hoverSelection=b)});d.$watch("hoverSelection",function(b,c){b!==c&&(a.options.hoverSelection=b)});d.$watch("options.itemIcon",function(b,c){b!==c&&(a.options.itemIcon=b,a.updateLayout())});d.$watch("itemIcon",function(b,c){b!==c&&(a.options.itemIcon=b,a.updateLayout())});d.$watch("options.labelEdit",function(b,c){b!==c&&(a.options.labelEdit=b)});d.$watch("labelEdit",function(b,c){b!==c&&(a.options.labelEdit=b)});d.$watch("options.pathSeparator",function(b,c){b!==c&&(a.options.pathSeparator=b)});d.$watch("pathSeparator",function(b,c){b!==c&&(a.options.pathSeparator=b)});d.$watch("options.rtl",function(b,c){b!==c&&(a.options.rtl=b,a.updateLayout())});d.$watch("rtl",function(b,c){b!==c&&(a.options.rtl=b,a.updateLayout())});d.$watch("options.selectionMode",function(b,c){b!==c&&(a.options.selectionMode=b,a.resetSelection())});d.$watch("selectionMode",function(b,c){b!==c&&(a.options.selectionMode=b,a.resetSelection())});d.$watch("options.showCheckBoxes",function(b,c){b!==c&&(a.options.showCheckBoxes=b,a.updateLayout())});d.$watch("showCheckBoxes",function(b,c){b!==c&&(a.options.showCheckBoxes=b,a.updateLayout())});d.$watch("options.showIcons",function(b,c){b!==c&&(a.options.showIcons=b,a.updateLayout())});d.$watch("showIcons",function(b,c){b!==c&&(a.options.showIcons=b,a.updateLayout())});d.$watch("options.showStatusIcons",function(b,c){b!==c&&(a.options.showStatusIcons=b,a.updateLayout())});d.$watch("showStatusIcons",function(b,c){b!==c&&(a.options.showStatusIcons=b,a.updateLayout())});d.$watch("options.selectedItem",function(b,c){b!==c&&(c&&(c.selected=!1),a.options.selectedItem=b,a.callAfterSelect(b))});d.$watch("selectedItem",function(b,c){b!==c&&(c&&(c.selected=!1),a.options.selectedItem=b,a.callAfterSelect(b))});var Z=function(b){if(b){var c=f.isFieldAvailable(b.general,"iui-checkbox");b=(b=b.box)?{general:f.isFieldAvailable(b.general,"iui-checkbox-box"),disabled:f.isFieldAvailable(b.disabled,"iui-checkbox-disabled"),checked:f.isFieldAvailable(b.checked,"iui-checkbox-checked"),indeterminate:f.isFieldAvailable(b.indeterminate,"iui-checkbox-indeterminate"),unchecked:f.isFieldAvailable(b.unchecked,"iui-checkbox-unchecked")}:a.options.controlStyle.item.checkBox.box;return{general:c,box:b}}return a.options.controlStyle.item.checkBox};this.getExpandBoxStyle=function(b){return b?{general:f.isFieldAvailable(b.general,"iui-treeview-expand-box"),animated:f.isFieldAvailable(b.animated,"iui-treeview-expand-box-load"),expanded:f.isFieldAvailable(b.expanded,"iui-treeview-expand-box-open"),collapsed:f.isFieldAvailable(b.collapsed,"iui-treeview-expand-box-close")}:a.options.controlStyle.item.expandBox};var U=function(b){if(b){var c;c=b.general;c=f.isString(c)?c:c?{disabled:f.isFieldAvailable(c.disabled,"iui-treeview-item-disabled"),focused:f.isFieldAvailable(c.focused,"iui-treeview-item-focused"),normal:f.isFieldAvailable(c.normal,"iui-treeview-item"),hovered:f.isFieldAvailable(c.hovered,"iui-treeview-item-hovered"),selected:f.isFieldAvailable(c.selected,"iui-treeview-item-selected")}:a.options.controlStyle.item.general;var d=Z(b.checkBox),e=a.getExpandBoxStyle(b.expandBox);b=b.content;b=f.isString(b)?b:b?{disabled:f.isFieldAvailable(b.disabled,"iui-treeview-item-content-disabled"),focused:f.isFieldAvailable(b.focused,"iui-treeview-item-content-focused"),normal:f.isFieldAvailable(b.normal,"iui-treeview-item-content"),hovered:f.isFieldAvailable(b.hovered,"iui-treeview-item-content-hovered"),selected:f.isFieldAvailable(b.selected,"iui-treeview-item-content-selected")}:a.options.controlStyle.item.content;return{general:c,checkBox:d,expandBox:e,content:b}}return a.options.controlStyle.item};this.updateControlStyle=function(b){a.options.controlStyle=b?{general:f.isFieldAvailable(b.general,"iui-treeview"),item:U(b.item)}:{general:f.isFieldAvailable(a.defaultStyle.general,"iui-treeview"),item:U(a.defaultStyle.item)}};this.getCurrentItemStyle=function(b,c){var d=a.options.controlStyle.item;if(b)switch(b.style){case "initial":break;case "parent":return a.getCurrentItemStyle(a.getParent(b),c);default:null!=b.style&&(d=b.style)}if(c){if(f.isString(d.general))return d.general;switch(c){case "disabled":return d.general&&d.general.disabled?d.general.disabled:a.options.controlStyle.item.general.disabled;case "focused":return d.general&&d.general.focused?d.general.focused:a.options.controlStyle.item.general.focused;case "hovered":return d.general&&d.general.hovered?d.general.hovered:a.options.controlStyle.item.general.hovered;case "selected":return d.general&&d.general.selected?d.general.selected:a.options.controlStyle.item.general.selected;default:return d.general&&d.general.normal?d.general.normal:a.options.controlStyle.item.general.normal}}else return d?d:a.options.controlStyle.item};this.getCurrentItemContentStyle=function(b,c){var d=a.options.controlStyle.item.content;if(b)switch(b.style){case "initial":break;case "parent":return a.getCurrentItemContentStyle(a.getParent(b),c);default:null!=b.style&&b.style.content&&(d=b.style.content)}if(c){if(f.isString(d))return d;switch(c){case "disabled":return d&&d.disabled?d.disabled:a.options.controlStyle.item.content.disabled;case "focused":return d&&d.focused?d.focused:a.options.controlStyle.item.content.focused;case "hovered":return d&&d.hovered?d.hovered:a.options.controlStyle.item.content.hovered;case "selected":return d&&d.selected?d.selected:a.options.controlStyle.item.content.selected;default:return d&&d.normal?d.normal:a.options.controlStyle.item.content.normal}}else return d?d:a.options.controlStyle.item.content}}]).directive("iuiTreeview",["$compile","$timeout","$interval","IntegralUIInternalService","IntegralUIDragDrop","$window",function(d,e,h,m,f,B){return{restrict:"EA",controller:"IntegralUITreeViewController",transclude:!0,replace:!0,template:'<div class="iui-treeview" data-element="treeview"><ul class="iui-treeview-block"></ul></div>',scope:{allowAnimation:"=",allowDrag:"=",allowDrop:"=",allowFocus:"=",animationSpeed:"=",autoCheck:"=",checkboxSettings:"=",controlStyle:"=",fields:"=",hoverSelection:"=",itemIcon:"=",items:"=",labelEdit:"=",name:"@",options:"=?",pathSeparator:"@",rtl:"=",selectedIndex:"=",selectedItem:"=",selectionMode:"@",showCheckBoxes:"=",showIcons:"=",showStatusIcons:"=",afterCollapse:"&",afterExpand:"&",afterLabelEdit:"&",afterSelect:"&",beforeCollapse:"&",beforeExpand:"&",beforeLabelEdit:"&",beforeSelect:"&",clear:"&",dragDrop:"&",dragEnter:"&",dragLeave:"&",dragOver:"&",events:"=?",itemAdded:"&",itemAdding:"&",itemCheckedChanging:"&",itemCheckedChanged:"&",itemCheckstateChanging:"&",itemCheckstateChanged:"&",itemClick:"&",itemDblclick:"&",itemHover:"&",keyDown:"&",keyPress:"&",keyUp:"&",itemRemoved:"&",itemRemoving:"&",itemRightclick:"&",scrollposChanged:"&",selectionChanged:"&"},link:function(g,k,ta,a,D){var t=this,w=k.children().eq(0),r=angular.element('<div class="iui-scrollbar-vertical"><div class="iui-scroll-button-thumb-vertical"></div></div>'),v=angular.element('<div class="iui-scrollbar-horizontal"><div class="iui-scroll-button-thumb-horizontal"></div></div>'),G=angular.element('<div class="iui-scrollbar-corner"></div>'),F=null,H=null,M=null,z=a.getEditBox(),ga=function(){var b="iui-treeview-block";a.options.showStatusIcons&&(b+=" "+b+"-shift-left");a.options.rtl&&(b+=" "+b+"-rtl");return b};g.$on("destroy",function(a){t.s2t();k.unbind("click dblclick dragenter dragleave dragend drop keydown mousedown mouseleave mousemove mousewheel scroll");angular.element(B).unbind("dragenter dragover dragend mousemove mouseup");z&&z.unbind("keydown blur");N();c&&c.$destroy()});k.append(a.getDropMarkWindow());a.dropMark();a.addDropMark=function(){var b;b=k[0];for(var c=null;b;){if(b===document.getElementsByTagName("body")[0]){c=b;break}b=b.offsetParent}if(b=c)angular.element(b).append(a.getDropMarkWindow()),a.dropMark()};a.removeDropMark=function(){a.getDropMarkWindow().remove()};var N=function(){var b=w.find("li");if(0<b.length)for(var c=0;c<b.length;c++){currentElem=angular.element(b[c]);currentElem.unbind("dragover drop dragenter dragleave dragend");var d=a.getElement(currentElem,"expandbox");d&&d.unbind("click");(d=a.getElement(currentElem))&&d.unbind("click dragstart dragover drop dragenter dragleave dblclick keydown keypress keyup mouseenter mouseleave mousedown mouseup")}},W=function(b){b&&(b.bind("dragover",function(b){if(a.isScrollBarVisible("vertical")){var c=a.getMousePos(b),d=k[0].getBoundingClientRect();c.y<d.top+25?ha(!1):c.y>d.bottom-25?ha(!0):X()}else X();b.stopPropagation()}),b.bind("dragend",function(b){b.preventDefault();a.dragDropStatus(!1);a.dropMark();f.getData().source||f.clearData()}))},T=function(b){b&&b.bind("click",function(b){var c=angular.element(this);(c=a.getItemFromChildElem(c))&&a.toggle(c);b.stopPropagation()})};a.dragIcon=document.createElement("img");a.dragIcon.width=1;var O=function(c,d){if(c){a.isDragAllowed(d)&&c.attr("draggable",!0);if(1==a.options.allowFocus){var n=a.getTabIndex().toString()+(a.getItemCurrentIndex(a.getItemFromChildElem(c))+1).toString();c.attr("tabindex",n)}c.bind("dragstart",function(b){f.clearData();var c=a.getItemFromChildElem(this);if(c)if(H&&(e.cancel(H),H=null),a.isDragAllowed(c)){a.dragDropStatus(!0);a.addDropMark();b.dataTransfer?(b.dataTransfer.effectAllowed="move",b.dataTransfer.setData("text",c[a.options.dataFields.id]?c[a.options.dataFields.id].toString():"")):b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.effectAllowed="move",b.originalEvent.dataTransfer.setData("text",c[a.options.dataFields.id]?c[a.options.dataFields.id].toString():""));b={source:c,sourceCtrl:a,sourceCollection:a.dataObj};switch(a.options.selectionMode){case "multi-simple":b.source=a.options.selectedItems;break;case "multi-extended":b.source=a.options.selectedItems}f.setData(b)}else b.dataTransfer?b.dataTransfer.effectAllowed="none":b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.effectAllowed="none")});c.bind("dragover",function(b){var c=angular.element(this);b.preventDefault();var d=!0;b.dataTransfer?d="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(d="none"===b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(d){var e=a.getItemFromChildElem(c);if(e){var d=c[0].getBoundingClientRect(),n=angular.element(B)[0].pageXOffset,q=angular.element(B)[0].pageYOffset,g=a.getMousePos(b);g.x-=d.left+n;g.y-=d.top+q;c=f.getDropPos(g,{x:0,y:0,width:c[0].offsetWidth,height:c[0].offsetHeight});n=f.getData();d=a.isDropAllowed(n.source,e,c);q={sourceTree:n.sourceCtrl?n.sourceCtrl.getTreeName():"",dragItem:n.source,targetTree:a.getTreeName(),targetItem:e,isDropAllowed:d,dropPos:c,mousePos:a.getMousePos(b)};q=a.callDragOver(q);if(d&&0!=q){q=a.getMousePos(b);b=q.y+16;q=q.x+20;g=a.getDropMarkWindow();g.empty();var I="iui-drop-marker-move-in";switch(c){case 1:I="iui-drop-marker-move-up";break;case 2:I="iui-drop-marker-move-down"}g.append("<span class='"+I+"'></span><span class='iui-drop-marker-title'>"+e[a.options.dataFields.text]+"</span>");a.updateDropMarkElem(a.getDropMarkWindow(),{top:b,left:q});a.dropMark(d);f.setData({source:n.source,sourceList:n.sourceList,target:e,dropPos:c})}else b.dataTransfer?b.dataTransfer.dropEffect="none":b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.dropEffect="none"),a.dropMark()}}});c.bind("drop",function(b){var c=angular.element(this);b.preventDefault();F&&(e.cancel(F),F=null);a.dropMark();var d=!0;b.dataTransfer?d="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(d="none"===b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(d){var n=a.getItemFromChildElem(c);if(n){var c=f.getData(),q=c.source;q||(q=a.getDnDSource(b));if(d=a.isDropAllowed(q,n,c.dropPos))a.toggle(n,!0),q&&(d={sourceTree:c.sourceCtrl?c.sourceCtrl.getTreeName():"",dragItem:q,targetTree:a.getTreeName(),targetItem:n,isDropAllowed:d,dropPos:c.dropPos,mousePos:a.getMousePos(b)},!1!==a.callDragDrop(d)&&(a.drop(c),g.$$phase||g.$apply()))}}f.clearData();b.stopPropagation()});c.bind("dragenter",function(b){b.preventDefault();var c=angular.element(this),d=a.getItemFromChildElem(c);if(d){a.hoverItem=d;a.refresh();var n=e(function(){F||(F=e(function(){F&&a.toggle(d,!0)},750));e.cancel(n)},1)}c=f.getData();c.source||(c.source=a.getDnDSource(b));c={sourceTree:c.sourceCtrl?c.sourceCtrl.getTreeName():"",dragItem:c.source,targetTree:a.getTreeName(),targetItem:c.target,mousePos:a.getMousePos(b)};a.callDragEnter(c);b.stopPropagation()});c.bind("dragleave",function(b){b.preventDefault();a.hoverItem=null;var c=angular.element(this);a.getItemFromChildElem(c)&&a.refresh();F&&(e.cancel(F),F=null);c=f.getData();c.source||(c.source=a.getDnDSource(b));c={sourceTree:c.sourceCtrl?c.sourceCtrl.getTreeName():"",dragItem:c.source,targetTree:a.getTreeName(),targetItem:c.target,mousePos:a.getMousePos(b)};a.callDragLeave(c);b.stopPropagation()});c.bind("dblclick",function(b){b.preventDefault();if(1===b.which){var c=a.getItemFromChildElem(this);c&&(a.callItemDblClick(c,a.getMousePos(b)),a.toggle(c))}b.stopPropagation()});c.bind("mouseenter",function(b){var c=a.getItemFromChildElem(this);c&&(angular.element(this),a.hoverItem=c,a.refresh(),a.callItemHover(c),a.options.hoverSelection&&(M=e(function(){M&&a.itemSelection(c)},500)))});c.bind("mouseleave",function(b){a.hoverItem=null;a.getItemFromChildElem(this)&&a.refresh();M&&(e.cancel(M),M=null)});var I=function(c,d){c.preventDefault();focusDelayTime=0;var n=a.getItemCurrentIndex(d),q=b+K-2,q=q<a.currentList.length-1?q:a.currentList.length-1;n===q&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+Math.floor(k[0].clientHeight/4)}),focusDelayTime=1);var f=a.getNextItem(n);if(f){a.itemSelection(f);g.$apply();var I=e(function(){a.updateFocus(f);e.cancel(I)},focusDelayTime)}},h=function(c,d){c.preventDefault();focusDelayTime=0;var n=a.getItemCurrentIndex(d),q=b;n===(0<q?q:0)&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y-Math.floor(k[0].clientHeight/4)}),focusDelayTime=1);var f=a.getPrevItem(a.getItemCurrentIndex(d));if(f){a.itemSelection(f);g.$apply();var I=e(function(){a.updateFocus(f);e.cancel(I)},focusDelayTime)}};c.bind("keydown",function(b){var d=a.getItemFromChildElem(this);if(d){var n=0;switch(b.keyCode){case 9:var f=a.currentList.length;0<f&&(b.shiftKey?m.isEqual(d[a.options.dataFields.id],a.currentList[0][a.options.dataFields.id])||h(b,d):m.isEqual(d[a.options.dataFields.id],a.currentList[f-1][a.options.dataFields.id])||I(b,d));break;case 13:Z(c,0);break;case 16:a.updateSelectionStatus("shift");break;case 17:a.updateSelectionStatus("ctrl");break;case 33:b.preventDefault();n=a.getItemCurrentIndex(d);f=n-K;f=0<f?f:0;if(f!==n){var n=1,P=a.getPrevItem(f+1);if(P){a.scrollTo(P);a.itemSelection(P);g.$apply();var k=e(function(){a.updateFocus(P);e.cancel(k)},n)}}break;case 34:b.preventDefault();n=a.getItemCurrentIndex(d);f=n+K;f=f<a.currentList.length-1?f:a.currentList.length-1;f!==n&&(n=1,P=a.getNextItem(f-1))&&(a.scrollTo(P,"bottom"),a.itemSelection(P),g.$apply(),k=e(function(){a.updateFocus(P);e.cancel(k)},n));break;case 35:b.preventDefault();a.setScrollPos({x:a.scrollPos.x,y:C.y});var l=a.getLastItem();l&&(a.itemSelection(l),k=e(function(){a.updateFocus(l);e.cancel(k)},1));break;case 36:b.preventDefault();a.setScrollPos({x:a.scrollPos.x,y:0});var p=a.getFirstItem();p&&(a.itemSelection(p),k=e(function(){a.updateFocus(p);e.cancel(k)},1));break;case 37:b.preventDefault();d[a.options.dataFields.items]&&0<d[a.options.dataFields.items].length&&(a.toggle(d,!1),a.updateFocus(d));break;case 32:b.preventDefault();a.itemSelection(d,d.selected);g.$apply();break;case 38:h(b,d);break;case 39:b.preventDefault();d[a.options.dataFields.items]&&0<d[a.options.dataFields.items].length&&(a.toggle(d,!0),a.updateFocus(d));break;case 40:I(b,d);break;default:(b.ctrlKey||b.metaKey)&&a.updateSelectionStatus("ctrl"),b.shiftKey&&a.updateSelectionStatus("shift")}}a.callKeyDown(b,d)});c.bind("keyup",function(b){switch(b.keyCode){case 16:a.multiSelection(!1);a.shiftKeyStatus(!1);break;case 17:a.multiSelection(!1);break;default:b.ctrlKey||b.metaKey||a.multiSelection(!1),b.shiftKey||(a.multiSelection(!1),a.shiftKeyStatus(!1))}var c=a.getItemFromChildElem(this);a.callKeyUp(b,c)});c.bind("keypress",function(b){var c=a.getItemFromChildElem(this);a.callKeyPress(b,c)});c.bind("click",function(b){if(1===b.which){var c=a.getItemFromChildElem(this);c&&a.callItemClick(c,a.getMousePos(b))}b.stopPropagation()});c.bind("mousedown",function(b){a.mouseButtonStatus(!0);var c=a.getItemFromChildElem(this);if(c)switch(a.itemSelection(c),b.which){case 1:a.changeCheckValue(c);Z(angular.element(this));break;case 3:a.callItemRightClick(c,a.getMousePos(b))}b.stopPropagation()});c.bind("mouseup",function(b){a.mouseButtonStatus(!1);var c=a.getItemFromChildElem(this);c&&a.updateSelection(c);1===b.which&&H&&(e.cancel(H),H=null)})}},Z=function(b,c){a.options.labelEdit&&(void 0===c&&(c=500),H=e(function(){if(H)var a=e(function(){U(b,!0);e.cancel(a)},c);e.cancel(H)},c/3))},U=function(b,c){var d=a.getItemFromChildElem(b);if(d)if(c){if(!1!==a.callBeforeEdit(d)){a.labelEditStatus(!0);k.append(z);var f=b[0].offsetTop+Math.floor((b[0].offsetHeight-z[0].offsetHeight)/2)+2,h=a.scrollPos.x+b[0].offsetLeft,l=k[0].clientWidth-b[0].offsetLeft-6;u&&(l-=16);a.updateEditBox({top:f,left:h,width:l});z[0].value=d[a.options.dataFields.text];z.bind("keydown",function(c){switch(c.keyCode){case 13:d[a.options.dataFields.text]=z[0].value?z[0].value:"null";g.$apply();U(b,!1);a.updateLayout();a.updateFocus(d);break;case 27:U(b,!1)}c.stopPropagation()});z.bind("blur",function(a){U()});var m=e(function(){z[0].focus();z[0].select();e.cancel(m)},10)}}else a.labelEditStatus(!1),z.remove(),a.updateFocus(d),a.callAfterEdit(d);else a.labelEditStatus(!1),z.remove(),a.callAfterEdit()},b=0,c=null,p=100,l=0,J=0,K=0,E=0,L=0,fa=!1,aa=!1,ba=9,ca=9,ia=0,Q=0,V=0,da=1,ja=0,ea=0,R=0,Y=0,ka=1,y=null,A=null,x=!1,u=!1;this.scrollMousePos=null;var C={x:0,y:0},ea=0;a.updateViewSize=function(){var b=e(function(){J=0;u=x=!1;if(a.longestItem&&0<a.currentList.length){var c=a.getItemCurrentIndex(a.longestItem),c=angular.element(d(ua(c,!0))(g));k.append(c);J=c[0].offsetWidth;var n=k[0].offsetWidth-6;u&&r&&(n-=r[0].offsetWidth);J>n&&(v.unbind("mousedown"),k.append(v),v.bind("mousedown",function(b){b=m.getClientMousePos(b,this);var c=Math.floor(k[0].clientWidth);y&&(b.x<y[0].offsetLeft?a.setScrollPos({x:a.scrollPos.x-c,y:a.scrollPos.y}):b.x>y[0].offsetLeft+y[0].offsetWidth&&a.setScrollPos({x:a.scrollPos.x+c,y:a.scrollPos.y}))}),y=angular.element(v.children().eq(0)),x=!0,y.bind("mousedown",function(b){1===b.which&&(t.scrollMousePos=a.getMousePos(b),fa=!0);b.stopPropagation()}));n=m.getMargin(c[0]);l=c[0].offsetHeight+(n.top+n.bottom);n=k[0].offsetHeight-6;x&&v&&(n-=v[0].offsetHeight);p=Math.floor(n/l)+1;pa&&(p=a.currentList.length+1);u=!1;p<a.currentList.length+1&&(r.unbind("mousedown"),k.append(r),r.bind("mousedown",function(b){b=m.getClientMousePos(b,this);var c=Math.floor(k[0].clientHeight);A&&(b.y<A[0].offsetTop?(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y-c}),ha(!1,c)):b.y>A[0].offsetTop+A[0].offsetHeight&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+c}),ha(!0,c)))}),A=angular.element(r.children().eq(0)),u=!0,A.bind("mousedown",function(b){1===b.which&&(t.scrollMousePos=a.getMousePos(b),aa=!0);b.stopPropagation()}));c.remove()}x||(v.unbind("mousedown"),v.remove());u||(r.unbind("mousedown"),r.remove());x&&u?k.append(G):G.remove();e.cancel(b);!x&&0<a.scrollPos.x&&a.setScrollPos({x:0,y:a.scrollPos.y});!u&&0<a.scrollPos.y&&a.setScrollPos({x:a.scrollPos.x,y:0})},1)};var qa=function(){var c=e(function(){E=k[0].offsetWidth-6;L=k[0].offsetHeight-6;L=x?L-v[0].offsetHeight:L-4;E=u?E-r[0].offsetWidth:E-4;E<J?w.css("width",J+"px"):w.css("width",E+"px");w.css("height",L+"px");x&&(v.css("bottom","0px"),u||(E+=3),v.css("width",E+1+"px"));u&&(r.css("top","0px"),x||(L+=3),r.css("height",L+1+"px"));x&&u&&G.css("bottom","0px");!1!==a.options.rtl?(w.css("left","auto"),w.css("right","-"+(a.scrollPos.x-2).toString()+"px"),x&&(v.css("left","auto"),v.css("right","0px")),u&&(r.css("left","0px"),r.css("right","auto")),x&&u&&(G.css("left","0px"),G.css("right","auto"))):(w.css("left","-"+(a.scrollPos.x-2).toString()+"px"),w.css("right","auto"),x&&(v.css("left","0px"),v.css("right","auto")),u&&(r.css("left","auto"),r.css("right","0px")),x&&u&&(G.css("left","auto"),G.css("right","0px")));var d=e(function(){x&&E<J&&(ia=0,Q=2,V=v[0].clientWidth-4,V>Q&&(ia=V-Q),ba=Math.floor(ia*(E-4)/J),9>ba&&(ba=9),y.css("width",ba+"px"),C.x=J-E,0>C.x&&(C.x=0),da=C.x/(ia-ba-2));var c=a.currentList.length+1;u&&0<a.currentList.length&&p<c&&(R=2,Y=r[0].clientHeight-4,ja=0,Y>R&&(ja=Y-R),ca=Math.floor(ja*p/c),9>ca&&(ca=9),A.css("height",ca+"px"),ka=(c-p)/(ja-ca-2),C.y=(c-p)*l,0>C.y&&(C.y=0),0==b?A.css("top",R+"px"):b+p-1==a.currentList.length&&A.css("top",Y-A[0].offsetHeight+"px"));e.cancel(d)},1);e.cancel(c)},5)},va=!1,pa=!1;a.updateLayout=function(b){a.allowUpdate&&(k.removeClass("iui-treeview-block-rtl"),a.options.rtl&&k.addClass("iui-treeview-block-rtl"),w.removeClass("iui-treeview-block-shift-left iui-treeview-block-rtl"),w.addClass(ga()),l=J=0,p=100,8>=k[0].offsetWidth&&(va=!0),8>=k[0].offsetHeight&&(pa=!0),va&&pa&&k.css("overflow","visible"),p=Math.floor(k[0].clientHeight/20),a.updateCurrentList(),wa(),a.updateView(b),a.updateView(b),e(function(){a.updateViewSize();a.updateViewSize();qa()},1))};g.onCheckValueChanging=function(b,c){return a.callCheckValueChanging(a.currentList[c],a.options.checkBoxSettings&&1==a.options.checkBoxSettings.threeState?b.checkState:b.checked)};g.onCheckValueChanged=function(b,c){a.callCheckValueChanged(a.currentList[c],a.options.checkBoxSettings&&1==a.options.checkBoxSettings.threeState?b.checkState:b.checked);a.fillCheckList(a.currentList[c])};var ua=function(b,d){var e=a.currentList[b],f=a.defaultStyle.item.general.normal,g=a.getCurrentItemStyle(e,a.getObjState(e)),e='<li class="'+f;g!=f&&(e+=" "+g);e+='" ';e=d?e+('style="position:absolute;top:-9999px;padding-left:'+a.indentList[b]+'px"'):e+('data-index="'+b+'"');!d&&0<a.indentList[b]&&(e=a.options.rtl?e+(' style="padding-right:'+a.indentList[b]+'px"'):e+(' style="padding-left:'+a.indentList[b]+'px"'));e+=">";!1!==a.options.showStatusIcons&&(f="iui-treeview-status-icon "+a.currentList[b].statusIcon,e+='<span class="'+f+'" data-element="statusicon"></span>');var f=a.currentList[b],g="",h=a.defaultStyle.item.expandBox.general;a.options.controlStyle.item.expandBox.general!=h&&(h+=" "+a.options.controlStyle.item.expandBox.general);var k=a.getCurrentItemStyle(f),k=a.getExpandBoxStyle(k.expandBox);if(a.isThereChildItems||f&&f[a.options.dataFields.hasChildren])g=h;f&&(f[a.options.dataFields.hasChildren]||f[a.options.dataFields.items]&&0<f[a.options.dataFields.items].length)&&(a.options.loadItem&&m.isEqual(f[a.options.dataFields.id],a.options.loadItem[a.options.dataFields.id])?g+=" "+k.animated:(g=f[a.options.dataFields.hasChildren]&&void 0===f[a.options.dataFields.expanded]?g+(" "+k.expanded):0!=f[a.options.dataFields.expanded]?g+(" "+k.collapsed):g+(" "+k.expanded),!0===a.options.rtl&&(g+="-rtl"),a.isItemEnabled(f)||(g+="-disabled")));e+='<span class="'+g+'" data-element="expandbox"></span>';1==a.options.showCheckBoxes&&(e+='<iui-checkbox name="cb-'+m.getUniqueId(4)+'"',f=a.options.checkBoxSettings?1==a.options.checkBoxSettings.threeState:!1,g=a.currentList[b],f&&void 0==g[a.options.dataFields.checkState]?g[a.options.dataFields.checkState]="unchecked":void 0==g[a.options.dataFields.checked]&&(g[a.options.dataFields.checked]=!1),f?(e+=' check-state="data['+b+"]."+a.options.dataFields.checkState+'"',e=e+(' checkstate-changing="onCheckValueChanging(e, '+b+')"')+(' checkstate-changed="onCheckValueChanged(e, '+b+')"'),e+=' three-state="true"'):(e+=' checked="data['+b+"]."+a.options.dataFields.checked+'"',e+=' checked-changing="onCheckValueChanging(e, '+b+')"',e+=' checked-changed="onCheckValueChanged(e, '+b+')"'),a.options.checkBoxSettings&&a.options.checkBoxSettings.style&&c.checkBoxStyle?e+=' control-style="checkBoxStyle"':a.options.controlStyle.item.checkBox&&c.checkBoxStyle&&(e+=' control-style="checkBoxStyle"'),a.isItemEnabled(a.currentList[b])||(e+=' enabled="false"'),e+=' style="display:inline-block;margin:0 2px;padding-bottom:2px;vertical-align:middle;',0<la&&(e+="width: "+la+"px;"),e+='"></iui-checkbox>');!1!==a.options.showIcons&&(a.currentList[b].icon||a.options.itemIcon)&&(f=a.currentList[b],g="",f[a.options.dataFields.icon]?g=f[a.options.dataFields.icon]:a.options.itemIcon&&(g=a.options.itemIcon),e+='<span class="'+g+'" data-element="icon"></span>');f=a.defaultStyle.item.content.normal;a.options.controlStyle.item.content.normal!=f&&(f+=" "+a.options.controlStyle.item.content.normal);g=a.getCurrentItemContentStyle(a.currentList[b],"normal");a.currentList[b].content?(e+='<div class="'+f+" "+g+'" data-element="content">',e+=a.currentList[b][a.options.dataFields.content],e+="</div>"):(e+='<span class="'+f+" "+g+'" data-element="content"',!d&&a.currentList[b].contextMenu&&(e+=' iui-contextmenu menu-items="data['+b+'].contextMenu"'),e+=">",e=d?e+a.currentList[b][a.options.dataFields.text]:e+("{{data["+b+"]."+a.options.dataFields.text+"}}"),e+="</span>");return e+="</li>"},la=0,wa=function(){if(1==a.options.showCheckBoxes){var b=angular.element(d('<iui-checkbox style="position:absolute;top:-9999px"></iui-checkbox>')(g));k.append(b);la=0;b&&0<b.children().length&&(la=parseInt(getComputedStyle(angular.element(b.children().eq(0))[0]).width,10));b.remove()}};a.updateView=function(f){var h=e(function(){fa||aa||qa();N();w.empty();c&&c.$destroy();ra(!1);a.currentList.length>=p&&b+p-1>a.currentList.length&&(b=a.currentList.length-p+1);if(b<a.currentList.length){c=g.$new();c.data=a.currentList;c.checkBoxStyle=a.options.checkBoxSettings.style;!c.checkBoxStyle&&a.options.controlStyle.item.checkBox&&(c.checkBoxStyle=a.options.controlStyle.item.checkBox);K=0;var f="";firstItemElem=f=null;for(var q=m.getMargin(),t=0,r=b;r<b+p&&r<a.currentList.length;r++)f=ua(r),f=a.currentList[r].content?d(f)(g.$parent):d(f)(c),f=angular.element(f),w.append(f),q=m.getMargin(f[0]),t+=f[0].offsetHeight+(q.top+q.bottom),K++;if(0<K){r=null;f=w.find("li");if(0<f.length)for(var q=null,u=0;u<f.length;u++)q=angular.element(f[u]),(r=a.getItemFromElem(q))&&a.isItemEnabled(r)&&(W(q),T(a.getElement(q,"expandbox")),O(a.getElement(q),a.getItemFromElem(q)));r=k[0].offsetHeight-6;x&&v&&(r-=v[0].offsetHeight);l=t/K;p=Math.floor(r/l)+1;qa()}sa();a.refresh()}e.cancel(h)},1)};a.refresh=function(c,d){if(c){var e=null;switch(c.type){case "item":if(e=a.getElemFromItem(c)){e.removeAttr("class");e.addClass(a.defaultStyle.item.general.normal);e.addClass(a.options.controlStyle.item.general.normal);var f=a.getCurrentItemStyle(c,a.getObjState(c));f!=a.options.controlStyle.item.general.normal&&e.addClass(f);if(e=a.getElement(e))e.removeAttr("class"),e.addClass(a.defaultStyle.item.content.normal),e.addClass(a.options.controlStyle.item.content.normal),f=a.getCurrentItemContentStyle(c,a.getObjState(c)),f!=a.options.controlStyle.item.content.normal&&e.addClass(f)}}}else for(f=b;f<b+p&&f<a.currentList.length;f++)a.refresh(a.currentList[f])};var ma=!1,S=0,na=null,oa=.5;a.isScrollBarVisible=function(a){switch(a){case "horizontal":return x;case "vertical":return u}return x&&u};a.scrollPos={x:0,y:0};a.getScrollPos=function(){return a.scrollPos};a.setScrollPos=function(b){if(b){0>b.x&&(b.x=0);b.x>C.x&&(b.x=C.x);0>b.y&&(b.y=0);b.y>C.y&&(b.y=C.y);a.scrollPos=b;ea=Math.floor(a.scrollPos.y/(l*ka));b=0;var c=R+ea;x&&y&&(b=!1!==a.options.rtl?Math.floor(a.scrollPos.x/da)-(V-y[0].offsetWidth-Q):Math.floor(a.scrollPos.x/da)+Q,y.css("left",b+"px"));u&&A&&A.css("top",c+"px");sa();ra();angular.isDefined(g.events)&&g.events.scrollPosChanged?g.events.scrollPosChanged({scrollPos:a.scrollPos}):g.scrollposChanged({e:{scrollPos:a.scrollPos}})}};var ha=function(b,c,d){ma||(S=0,ma=!0,na=h(function(){var d=c,e=a.getScrollPos();d||(0===S&&(S=5),S+=5+ka,oa+=.5,d=S+=Math.floor(oa));e.y=b?e.y+d:e.y-d;a.setScrollPos(e);(0>=e.y||a.getScrollPos().y<e.y)&&X()},d?d:100))},X=function(){ma&&(na&&(h.cancel(na),na=null),ma=!1,S=0,oa=.5)};a.cancelScrollTimer=function(){X()};a.scrollTo=function(b,c){if(b){var d=a.getItemCurrentIndex(b);if(a.isIndexInRange(d)){var f=0,g=d;switch(c){case "center":f=Math.floor(K/2);g=d>f?d-f:0;break;case "bottom":f=K-2,g=d>f?d-f:0}var h=e(function(){a.setScrollPos({x:a.scrollPos.x,y:g*l});e.cancel(h)},1)}}};var sa=function(){if(w){var b=a.scrollPos.x;0>b&&(b=0);b>C.x&&(b=C.x);b=2-b;!1!==a.options.rtl?w.css("right",b+"px"):w.css("left",b+"px")}},ra=function(c){0==c&&0>=l||(newIndex=0<l?Math.floor(a.scrollPos.y/l):0,newIndex+p-1>a.currentList.length&&(newIndex=a.currentList.length-p+1),0>newIndex&&(newIndex=0),newIndex!==b&&(b=newIndex,0!=c&&a.updateView(!0)))};k.bind("scroll",function(a){k[0].scrollTop=0;k[0].scrollLeft=0});k.bind("mousewheel",function(b){b.preventDefault();a.hoverItem=null;var c=0;b.wheelDelta?c=Math.max(-1,Math.min(1,b.wheelDelta||-b.detail)):b.originalEvent&&(c=Math.max(-1,Math.min(1,b.originalEvent.wheelDelta||-b.originalEvent.detail)));a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+Math.floor(k[0].clientHeight/4)*c*-1});e(function(){var c=a.getMousePos(b),d=angular.element(B)[0].pageXOffset,e=angular.element(B)[0].pageYOffset;c.x-=d;c.y-=e;if(c=a.getItemAt(c.x,c.y))a.hoverItem=c,a.refresh()},1)});angular.element(B).bind("dragover",function(a){X()});angular.element(B).bind("mousemove",function(b){if(fa){if(1===b.which){y[0].getBoundingClientRect();b=a.getMousePos(b);t.scrollMousePos||(t.scrollMousePos=b);var c=y[0].offsetLeft+(b.x-t.scrollMousePos.x);c<Q?c=Q:c+y[0].offsetWidth>V&&(c=V-y[0].offsetWidth);y.css("left",c+"px");t.scrollMousePos=b;a.scrollPos.x=!1!==a.options.rtl?parseInt((V-y[0].offsetLeft-y[0].offsetWidth)*da,10):parseInt((y[0].offsetLeft-Q)*da,10);sa()}}else aa&&1===b.which&&(A[0].getBoundingClientRect(),b=a.getMousePos(b),t.scrollMousePos||(t.scrollMousePos=b),c=A[0].offsetTop+(b.y-t.scrollMousePos.y),c<R?c=R:c+A[0].offsetHeight>Y&&(c=Y-A[0].offsetHeight),A.css("top",c+"px"),t.scrollMousePos=b,ea=c-R,a.scrollPos.y=Math.floor(ea*ka*l),ra())});angular.element(B).bind("mouseup",function(b){a.dropMark();aa&&a.updateView();X();t.scrollMousePos=null;aa=fa=!1});t=this;this.crpar=function(){return["si","tri","ver","on","al "]};this.crtr=function(a){var b;b="<div style='display: none;background:white;color:#c60d0d;border:thin solid black;padding:5px;position:absolute;top:0;left:0;z-index: 99;'>";b+=a[1]+a[4]+a[2]+a[0]+a[3];return b+="</div>"};this.tpar=this.crpar();this.$tw=angular.element(this.crtr(t.tpar));this.tmp=300;this.twp=200*tmp;this.trActive=!1;this.trCount=0;this.trlTime=this.trId=null;this.trShowCount=0;this.animTr=function(){this.trCount++;3>this.trShowCount?(this.trCount=1,this.$tw.css("display","block"),this.$tw.css("top",k[0].scrollTop+"px"),this.$tw.css("left",k[0].scrollLeft+"px"),this.trShowCount++):(0===this.trCount%49&&(this.trShowCount=0),this.$tw.css("display","none"),this.$tw.css("top",k[0].scrollTop+"px"),this.$tw.css("left",k[0].scrollLeft+"px"))};this.s1t=function(a){this.trlTime=e(function(){t.trActive||(t.trCount=0,t.trActive=!0,t.trId=h(function(){t.animTr()},1E3))},a)};this.s2t=function(){this.trId&&(h.clear(this.trId),this.trId=null);this.trlTime&&(e.cancel(this.trlTime),this.trlTime=null);this.trActive=!1;this.$tw.remove()};k.append(this.$tw);this.s1t(this.twp);angular.isDefined(g.options)?(a.options=g.options,a.updateData()):(0==g.allowAnimation&&(a.options.allowAnimation=g.allowAnimation),1==g.allowDrag&&(a.options.allowDrag=g.allowDrag),0==g.allowDrop&&(a.options.allowDrop=g.allowDrop),angular.isDefined(g.animationSpeed)&&200!==g.animationSpeed&&(a.options.animationSpeed=g.animationSpeed),0==g.allowFocus&&(a.options.allowFocus=g.allowFocus),1==g.autoCheck&&(a.options.autoCheck=g.autoCheck),angular.isDefined(g.checkboxSettings)&&a.updateCheckBoxSettings(g.checkboxSettings),angular.isDefined(g.controlStyle)&&a.updateControlStyle(g.controlStyle),angular.isDefined(g.fields)&&(a.updateDataFields(g.fields),a.updateData()),!0===g.hoverSelection&&(a.options.hoverSelection=g.hoverSelection),angular.isDefined(g.itemIcon)&&(a.options.itemIcon=g.itemIcon),angular.isDefined(g.labelEdit)&&(a.options.labelEdit=g.labelEdit),!0===g.rtl&&(a.options.rtl=g.rtl),angular.isDefined(g.selectedIndex)&&(a.options.selectedIndex=g.selectedIndex),angular.isDefined(g.selectedItem)&&(a.options.selectedItem=g.selectedItem),angular.isDefined(g.selectionMode)&&(a.options.selectionMode=g.selectionMode),!0===g.showCheckBoxes&&(a.options.showCheckBoxes=g.showCheckBoxes),!1===g.showIcons&&(a.options.showIcons=g.showIcons),!0===g.showStatusIcons&&(a.options.showStatusIcons=g.showStatusIcons));a.updateLayout()}}}]);