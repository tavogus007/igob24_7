(function(){angular.module("template/treeGrid/treeGrid.html",[]).run(["$templateCache",function(e){e.put("template/treeGrid/treeGrid.html",'<div class="table-responsive">\n <table class="table tree-grid">\n   <thead>\n     <tr>\n       <th><a ng-if="expandingProperty.sortable" ng-click="sortBy(expandingProperty)">{{expandingProperty.displayName || expandingProperty.field || expandingProperty}}</a><span ng-if="!expandingProperty.sortable">{{expandingProperty.displayName || expandingProperty.field || expandingProperty}}</span><i ng-if="expandingProperty.sorted" class="{{expandingProperty.sortingIcon}} pull-right"></i></th>\n       <th ng-repeat="col in colDefinitions"><a ng-if="col.sortable" ng-click="sortBy(col)">{{col.displayName || col.field}}</a><span ng-if="!col.sortable">{{col.displayName || col.field}}</span><i ng-if="col.sorted" class="{{col.sortingIcon}} pull-right"></i></th>\n     </tr>\n   </thead>\n   <tbody>\n     <tr ng-repeat="row in tree_rows | searchFor:$parent.filterString:expandingProperty:colDefinitions track by row.branch.uid"\n       ng-class="\'level-\' + {{ row.level }} + (row.branch.selected ? \' active\':\'\')" class="tree-grid-row">\n       <td><a ng-click="user_clicks_branch(row.branch)"><i ng-class="row.tree_icon"\n              ng-click="row.branch.expanded = !row.branch.expanded"\n              class="indented tree-icon"></i>\n           </a><span class="indented tree-label" ng-click="on_user_click(row.branch)">\n             {{row.branch[expandingProperty.field] || row.branch[expandingProperty]}}</span>\n       </td>\n       <td ng-repeat="col in colDefinitions">\n         <div ng-if="col.cellTemplate" compile="col.cellTemplate" cell-template-scope="col.cellTemplateScope"></div>\n         <div ng-if="!col.cellTemplate">{{row.branch[col.field]}}</div>\n       </td>\n     </tr>\n   </tbody>\n </table>\n</div>\n')}]),angular.module("treeGrid",["template/treeGrid/treeGrid.html"]).directive("compile",["$compile",function(e){return{restrict:"A",link:function(n,r,t){n.cellTemplateScope=n.$eval(t.cellTemplateScope),n.$watch(t.compile,function(t){var l=e(t),i=l(n);r.append(i)})}}}]).directive("treeGrid",["$timeout","treegridTemplate",function(e,n){return{restrict:"E",templateUrl:function(e,r){return r.templateUrl||n.getPath()},replace:!0,scope:{treeData:"=",colDefs:"=",expandOn:"=",onSelect:"&",onClick:"&",initialSelection:"@",treeControl:"="},link:function(n,r,t){var l,i,c,a,o,u,s,d,f,p,h,g;if(l=function(e){console.log("ERROR:"+e)},t.iconExpand=t.iconExpand?t.iconExpand:"icon-plus  glyphicon glyphicon-plus  fa fa-plus",t.iconCollapse=t.iconCollapse?t.iconCollapse:"icon-minus glyphicon glyphicon-minus fa fa-minus",t.iconLeaf=t.iconLeaf?t.iconLeaf:"icon-file  glyphicon glyphicon-file  fa fa-file",t.sortedAsc=t.sortedAsc?t.sortedAsc:"icon-file  glyphicon glyphicon-chevron-up  fa angle-up",t.sortedDesc=t.sortedDesc?t.sortedDesc:"icon-file  glyphicon glyphicon-chevron-down  fa angle-down",t.expandLevel=t.expandLevel?t.expandLevel:"3",a=parseInt(t.expandLevel,10),!n.treeData)return void alert("No data was defined for the tree, please define treeData!");var _=function(){if(t.expandOn)i=n.expandOn,n.expandingProperty=n.expandOn;else if(n.treeData.length){for(var e=n.treeData[0],r=Object.keys(e),l=0,c=r.length;l<c;l++)if("string"==typeof e[r[l]]){i=r[l];break}i||(i=r[0]),n.expandingProperty=i}};if(_(),t.colDefs)n.colDefinitions=n.colDefs;else if(n.treeData.length){var b=[],v=n.treeData[0],x=["children","level","expanded",i];for(var y in v)x.indexOf(y)===-1&&b.push({field:y});n.colDefinitions=b}u=function(e){var r,t,l,i,c,a;for(r=function(n,t){var l,i,c,a,o;if(e(n,t),null!=n.children){for(a=n.children,o=[],i=0,c=a.length;i<c;i++)l=a[i],o.push(r(l,t+1));return o}},c=n.treeData,a=[],l=0,i=c.length;l<i;l++)t=c[l],a.push(r(t,1));return a},h=null,p=function(r){if(!r)return null!=h&&(h.selected=!1),void(h=null);if(r!==h){if(null!=h&&(h.selected=!1),r.selected=!0,h=r,c(r),null!=r.onSelect)return e(function(){return r.onSelect(r)});if(null!=n.onSelect)return e(function(){return n.onSelect({branch:r})})}},n.on_user_click=function(e){n.onClick&&n.onClick({branch:e})},n.user_clicks_branch=function(e){if(e!==h)return p(e)},n.sortBy=function(e){"asc"===e.sortDirection?(n.treeData.sort(m(e.field,!0,e.sortingType)),e.sortDirection="desc",e.sortingIcon=t.sortedDesc):(n.treeData.sort(m(e.field,!1,e.sortingType)),e.sortDirection="asc",e.sortingIcon=t.sortedAsc),e.sorted=!0,D(e)};var m=function(e,n,r){var t="number"===r?function(n){return parseFloat(n[e])}:function(n){return null===n[e]?"":n[e].toLowerCase()},l=n?-1:1;return function(e,n){return e=t(e),n=t(n),l*((e>n)-(n>e))}},D=function(e){for(var r=n.colDefinitions.length,t=0;t<r;t++){var l=n.colDefinitions[t];l.field!=e.field&&(l.sorted=!1,l.sortDirection="none")}};return s=function(e){var n;return n=void 0,e.parent_uid&&u(function(r){if(r.uid===e.parent_uid)return n=r}),n},o=function(e,n){var r;if(r=s(e),null!=r)return n(r),o(r,n)},c=function(e){return o(e,function(e){return e.expanded=!0})},n.tree_rows=[],f=function(){_();var e,r,l,c,a,o;for(u(function(e,n){if(!e.uid)return e.uid=""+Math.random()}),u(function(e){var n,r,t,l,i;if(angular.isArray(e.children)){for(l=e.children,i=[],r=0,t=l.length;r<t;r++)n=l[r],i.push(n.parent_uid=e.uid);return i}}),n.tree_rows=[],u(function(e){var n,r;return e.children?e.children.length>0?(r=function(e){return"string"==typeof e?{label:e,children:[]}:e},e.children=function(){var t,l,i,c;for(i=e.children,c=[],t=0,l=i.length;t<l;t++)n=i[t],c.push(r(n));return c}()):void 0:e.children=[]}),e=function(r,l,c){var a,o,u,s,d,f,p;if(null==l.expanded&&(l.expanded=!1),u=l.children&&0!==l.children.length?l.expanded?t.iconCollapse:t.iconExpand:t.iconLeaf,l.level=r,n.tree_rows.push({level:r,branch:l,label:l[i],tree_icon:u,visible:c}),null!=l.children){for(f=l.children,p=[],s=0,d=f.length;s<d;s++)a=f[s],o=c&&l.expanded,p.push(e(r+1,a,o));return p}},a=n.treeData,o=[],l=0,c=a.length;l<c;l++)r=a[l],o.push(e(1,r,!0));return o},n.$watch("treeData",f,!0),null!=t.initialSelection&&u(function(n){if(n.label===t.initialSelection)return e(function(){return p(n)})}),d=n.treeData.length,u(function(e,n){return e.level=n,e.expanded=e.level<a}),null!=n.treeControl&&angular.isObject(n.treeControl)?(g=n.treeControl,g.expand_all=function(){return u(function(e,n){return e.expanded=!0})},g.collapse_all=function(){return u(function(e,n){return e.expanded=!1})},g.get_first_branch=function(){if(d=n.treeData.length,d>0)return n.treeData[0]},g.select_first_branch=function(){var e;return e=g.get_first_branch(),g.select_branch(e)},g.get_selected_branch=function(){return h},g.get_parent_branch=function(e){return s(e)},g.select_branch=function(e){return p(e),e},g.get_children=function(e){return e.children},g.select_parent_branch=function(e){var n;if(null==e&&(e=g.get_selected_branch()),null!=e&&(n=g.get_parent_branch(e),null!=n))return g.select_branch(n),n},g.add_branch=function(e,r){return null!=e?(e.children.push(r),e.expanded=!0):n.treeData.push(r),r},g.add_root_branch=function(e){return g.add_branch(null,e),e},g.expand_branch=function(e){if(null==e&&(e=g.get_selected_branch()),null!=e)return e.expanded=!0,e},g.collapse_branch=function(e){if(null==e&&(e=h),null!=e)return e.expanded=!1,e},g.get_siblings=function(e){var r,t;if(null==e&&(e=h),null!=e)return r=g.get_parent_branch(e),t=r?r.children:n.treeData},g.get_next_sibling=function(e){var n,r;if(null==e&&(e=h),null!=e&&(r=g.get_siblings(e),d=r.length,n=r.indexOf(e),n<d))return r[n+1]},g.get_prev_sibling=function(e){var n,r;if(null==e&&(e=h),r=g.get_siblings(e),d=r.length,n=r.indexOf(e),n>0)return r[n-1]},g.select_next_sibling=function(e){var n;if(null==e&&(e=h),null!=e&&(n=g.get_next_sibling(e),null!=n))return g.select_branch(n)},g.select_prev_sibling=function(e){var n;if(null==e&&(e=h),null!=e&&(n=g.get_prev_sibling(e),null!=n))return g.select_branch(n)},g.get_first_child=function(e){var n;if(null==e&&(e=h),null!=e&&(null!=(n=e.children)?n.length:void 0)>0)return e.children[0]},g.get_closest_ancestor_next_sibling=function(e){var n,r;return n=g.get_next_sibling(e),null!=n?n:(r=g.get_parent_branch(e),g.get_closest_ancestor_next_sibling(r))},g.get_next_branch=function(e){var n;if(null==e&&(e=h),null!=e)return n=g.get_first_child(e),null!=n?n:n=g.get_closest_ancestor_next_sibling(e)},g.select_next_branch=function(e){var n;if(null==e&&(e=h),null!=e&&(n=g.get_next_branch(e),null!=n))return g.select_branch(n),n},g.last_descendant=function(e){var n;return d=e.children.length,0===d?e:(n=e.children[d-1],g.last_descendant(n))},g.get_prev_branch=function(e){var n,r;if(null==e&&(e=h),null!=e)return r=g.get_prev_sibling(e),null!=r?g.last_descendant(r):n=g.get_parent_branch(e)},g.select_prev_branch=function(e){var n;if(null==e&&(e=h),null!=e&&(n=g.get_prev_branch(e),null!=n))return g.select_branch(n),n}):void 0}}}]).provider("treegridTemplate",function(){var e="template/treeGrid/treeGrid.html";this.setPath=function(n){e=n},this.$get=function(){return{getPath:function(){return e}}}}).filter("searchFor",function(){function e(e,r,t,l){var i=!1,c=!1;t.filterable&&(c=!0,n(e,r,t)&&(i=!0));for(var a=l.length,o=0;o<a;o++){var u=l[o];u.filterable&&(c=!0,n(e,r,u)&&(i=!0))}return c?i&&e.visible:e.visible}function n(e,n,r){if("number"===r.sortingType){if(null!=e.branch[r.field]&&parseFloat(e.branch[r.field])===parseFloat(n))return!0}else if(null!=e.branch[r.field]&&e.branch[r.field].toLowerCase().indexOf(n)!==-1)return!0}return function(n,r,t,l){var i=[];if(!r||r.length<3)for(var c=0;c<n.length;c++){var a=n[c];a.visible&&i.push(a)}else for(var c=0;c<n.length;c++){var a=n[c];e(a,r,t,l)&&i.push(a)}return i}})}).call(window);