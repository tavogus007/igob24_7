function PCController(o,i,e,t,a,r,l,c,n,s,u,d,p,m,g,f,A,C,M,S,E){function P(o){var o=window.event||o;Math.max(-1,Math.min(1,o.wheelDelta||-o.detail));return!1}function v(o,i){for(var e in o)i[e]=o[e]}o.flujo={pasos:{paso0:"listaSolicitudes",paso1:"verificacion",paso2:"solicitudTramite",paso3:"parametrosEdificacion"},paso:"listaSolicitudes"},o.tablaSolicitudes={},o.listaSolicitudes=[],o.tablaListaArquitectos={},o.listaArquitectos=[],o.listaPredios=[],o.listaTipoTramite=[],o.textoBotones={btnDelegar:"Delegar trámite",btnRegistrar:"Registrar trámite"},o.btnSaveSolicitud=o.textoBotones.btnRegistrar,o.predioSeleccionado=null,o.predioSeleccionadoPropietarios=[],o.solicitud={nombreSolicitante:"",paternoSolicitante:"",maternoSolicitante:"",numeroDocumentoSol:"",expedido:"",tipoDocumento:0,emailSolicitante:"",telefonoSolicitante:"",tipoPersona:"",direccion:"",anchoVia:null,codigoCatastral:null,distritoMunicipal:null,idDuplicado:null,idPendTerreno:null,lusu:null,macrodistrito:null,nombreVia:null,nroInmueble:null,nroPuerta:null,riesgoConstruccionLocalizacionCategoria:null,superficieReal:null,tipoVia:null,wkt:null,zona:null,idTipoTramite:0,arquitectoNombre:"",arquitectoRegistroNacionalCAB:"",arquitectoTelefono:"",arquitectoEmail:"",autorizacionEntregaDocumentos:null,autorizacionSeguimientoTramite:null,idFichaTecnica:0,idPCCartilla:0,categoriaPatrimonial:"",fechaEstimadaInicioObra:null,ALE:null,FML:null,AMCSotano:null,AMCSemisotano:null,AMCZocalo:null,AMCMezzanine:null,AMCTorre:null,AME:null,AMF:null,RMEFrontal:null,RMEFondo:null,RMELateralIzq:null,RMELateralDer:null,RMEFrontalZocalo:null,RMEFondoZocalo:null,RMELateralIzqZocalo:null,RMELateralDerZocalo:null,NMP:null,AMV:null,voladizo:null,incentivoDobleALE:null,incentivoRME:null,incentivoRMEZocalo:null,incentivoAMCSemisotano:null,incentivoAMCSotano:null,incentivoNMP:null,incentivoAMF:null,riesgoConstruccionResultado:null,idEstado:0,codigoMirador:null,descripcionMirador:null,codigoPlaza:null,descripcionPlaza:null,cPresidencialDistancia:null,cPresidencialAltura:null,telefericoConsolidado:null,telefericoColor:null,restriccionCH:null,restricciones:0,pendienteVia:null},o.srcTutorial="../territorio/img/TramitePermisoConstruccion.png",o.inicio=function(){o.setDatosSolicitante(),o.getSolicitudes(),o.getListaTipoTramite(),o.getListaArquitectos(),o.loginPagoEnLinea()},o.$on("api:ready",function(){o.setDatosSolicitante(),o.getSolicitudes(),o.getListaTipoTramite(),o.getListaArquitectos(),o.loginPagoEnLinea()}),o.setDatosSolicitante=function(){var i=new rcNatural;i.oid=l.get("IDCIUDADANO"),i.datosCiudadanoNatural(function(i){var e=JSON.parse(i);if(e.length>0){var t=e,a=t[0].dtspsl_tipo_persona;"NATURAL"==a?(o.solicitud.nombreSolicitante=t[0].dtspsl_nombres,o.solicitud.maternoSolicitante=t[0].dtspsl_materno,o.solicitud.paternoSolicitante=t[0].dtspsl_paterno,o.solicitud.numeroDocumentoSol=t[0].dtspsl_ci,o.solicitud.expedido=t[0].dtspsl_expedido,o.solicitud.tipoDocumento=1,o.solicitud.emailSolicitante=null!=t[0].dtspsl_correo?t[0].dtspsl_correo:"",o.solicitud.telefonoSolicitante=null!=t[0].dtspsl_movil?t[0].dtspsl_movil:null!=t[0].dtspsl_telefono?t[0].dtspsl_telefono:"",o.solicitud.tipoPersona="NATURAL"):(o.solicitud.nombreSolicitante=t[0].dtspsl_razon_social,o.solicitud.maternoSolicitante="",o.solicitud.paternoSolicitante="",o.solicitud.nroDocumento=t[0].dtspsl_nit,o.solicitud.expedido="",o.solicitud.tipoDocumento=7,o.solicitud.emailSolicitante=null!=t[0].dtspsl_correo?t[0].dtspsl_correo:"",o.solicitud.telefonoSolicitante=null!=t[0].dtspsl_movil?t[0].dtspsl_movil:null!=t[0].dtspsl_telefono?t[0].dtspsl_telefono:"",o.solicitud.tipoPersona="JURIDICO")}else u.show("","Error al recuperar datos","error"),console.log("Error no se encontraron los datos del ciudadano!!",l.get("IDCIUDADANO"))})},o.getSolicitudes=function(){$.blockUI();var i=l.get("CICIUDADANO");"JURIDICO"==l.get("TIPO_PERSONA")&&(i=l.get("NITCIUDADANO"));var e=new dataSITOL;e.pcSolicitudLst(i,function(i){var e=JSON.parse(i);if(e.success){o.listaSolicitudes=e.success.dataSql;e.success.dataSql;o.tablaSolicitudes.reload(),o.verificarFum(),$.unblockUI()}else u.show("","Error al recuperar datos de solicitudes","error"),console.log("Error al obtener las solicitudes",e.error.message,e.error.code),$.unblockUI()})},o.getSolicitudesUnico=function(){var i=l.get("CICIUDADANO");"JURIDICO"==l.get("TIPO_PERSONA")&&(i=l.get("NITCIUDADANO"));var e=new dataSITOL;e.pcSolicitudLst(i,function(i){var e=JSON.parse(i);if(e.success){o.listaSolicitudes=e.success.dataSql;e.success.dataSql;o.tablaSolicitudes.reload()}else u.show("","Error al recuperar datos de solicitudes único","error"),console.log("Error al obtener las solicitudes único",e.error.message,e.error.code)})},o.verificarFum=function(){for(var i=0;i<o.listaSolicitudes.length;i++){var e=o.listaSolicitudes[i];5==e.idEstado&&o.vdplepago(e)}},o.vdplepago=function(i){var e=i.fum,t={idfum:e},a=l.get("TOKEN"),r='Bearer <\\"'+a+'\\">';$.ajax({async:!0,type:"POST",url:"https://pagonline.lapaz.bo/api/comprobante",data:t,dataType:"json",crossDomain:!0,headers:{"cache-control":"no-cache"},headers:{authorization:r},success:function(e){e.Resultado.idFum?o.solActFumPagado(i):(u.show("","Error no se realizo el pago del Fum","error"),console.log("Error no se realizo el pago del Fum",e))}})},o.solActFumPagado=function(i){var e=new dataSITOL;e.pcSolicitudActFumPagado(i.idFichaTecnica,function(i){var e=JSON.parse(i);e.success?o.getSolicitudesUnico():(u.show("","Error al Activar Fum pagado","error"),console.log("Error al act fum pagado",e.error.message,e.error.code))})},o.tablaSolicitudes=new d({page:1,count:4,filter:{},sorting:{fechaIngresoFormulario:"desc"}},{total:o.listaSolicitudes.length,getData:function(i,e){var t=e.filter()?p("filter")(o.listaSolicitudes,e.filter()):o.listaSolicitudes,a=e.sorting()?p("orderBy")(t,e.orderBy()):o.listaSolicitudes;e.total(o.listaSolicitudes.length),i.resolve(a.slice((e.page()-1)*e.count(),e.page()*e.count()))}}),o.getListaTipoTramite=function(){var i=new dataSITOL;i.pcTipoTramiteLst(function(i){var e=JSON.parse(i);e.success?o.listaTipoTramite=e.success.dataSql:(u.show("","Error en el listado de tipo tramite","error"),console.log("Error en el listado de tipo tramite",e.error.message,e.error.code))})},o.BuscarArquitecto=function(){var i=o.buscarArquitectoNombre;o.tablaListaArquitectos.filter({arquitectoNombre:i})},o.BuscarArquitectoLimpiar=function(){o.tablaListaArquitectos.filter({}),o.buscarArquitectoNombre=""},o.getListaArquitectos=function(){var i=new dataSIT;i.pcListaArquitecto(function(i){var e=JSON.parse(i);if(e.success){o.listaArquitectos=e.success.dataSql;e.success.dataSql;o.tablaListaArquitectos.reload()}else u.show("","Error al recuperar la data de arquitectos","error"),console.log("Error al recuperar la data de arquitectos",e.error.message,e.error.code)})},o.tablaListaArquitectos=new d({page:1,count:10,filter:{},sorting:{arquitectoNombre:"asc"}},{total:o.listaArquitectos.length,getData:function(i,e){var t=e.filter()?p("filter")(o.listaArquitectos,e.filter()):o.listaArquitectos,a=e.sorting()?p("orderBy")(t,e.orderBy()):o.listaArquitectos;e.total(o.listaArquitectos.length),i.resolve(a.slice((e.page()-1)*e.count(),e.page()*e.count()))}}),o.resetSolicitud=function(){o.solicitud.anchoVia=null,o.solicitud.codigoCatastral=null,o.solicitud.distritoMunicipal=null,o.solicitud.idDuplicado=null,o.solicitud.idPendTerreno=null,o.solicitud.lusu=null,o.solicitud.macrodistrito=null,o.solicitud.nombreVia=null,o.solicitud.nroInmueble=null,o.solicitud.nroPuerta=null,o.solicitud.riesgoConstruccionLocalizacionCategoria=null,o.solicitud.superficieReal=null,o.solicitud.superficieRealCatastro=null,o.solicitud.tipoVia=null,o.solicitud.wkt=null,o.solicitud.zona=null,o.solicitud.idTipoTramite=1,o.solicitud.arquitectoNombre="",o.solicitud.arquitectoRegistroNacionalCAB="",o.solicitud.arquitectoTelefono="",o.solicitud.arquitectoEmail="",o.solicitud.autorizacionEntregaDocumentos=null,o.solicitud.autorizacionSeguimientoTramite=null,o.solicitud.idFichaTecnica=0,o.solicitud.idPCCartilla=0,o.solicitud.categoriaPatrimonial="",o.solicitud.fechaEstimadaInicioObra=null,o.solicitud.ALE=null,o.solicitud.FML=null,o.solicitud.AMCSotano=null,o.solicitud.AMCSemisotano=null,o.solicitud.AMCZocalo=null,o.solicitud.AMCMezzanine=null,o.solicitud.AMCTorre=null,o.solicitud.AME=null,o.solicitud.AMF=null,o.solicitud.RMEFrontal=null,o.solicitud.RMEFondo=null,o.solicitud.RMELateralIzq=null,o.solicitud.RMELateralDer=null,o.solicitud.RMEFrontalZocalo=null,o.solicitud.RMEFondoZocalo=null,o.solicitud.RMELateralIzqZocalo=null,o.solicitud.RMELateralDerZocalo=null,o.solicitud.NMP=null,o.solicitud.AMV=null,o.solicitud.voladizo=null,o.solicitud.incentivoDobleALE=null,o.solicitud.incentivoRME=null,o.solicitud.incentivoRMEZocalo=null,o.solicitud.incentivoAMCSemisotano=null,o.solicitud.incentivoAMCSotano=null,o.solicitud.incentivoNMP=null,o.solicitud.incentivoAMF=null,o.solicitud.riesgoConstruccionResultado=null,o.solicitud.idEstado=0,o.solicitud.restricciones=null,o.predioSeleccionado=null,o.btnSaveSolicitud=o.textoBotones.btnRegistrar},o.accionDescargarSolicitud=function(o){var i=c.SERVICE_SITOLextgen+"Territorio/GenerarSolicitudPDF?d="+o.pisol;window.open(i,"_blank")},o.accionImprimirProforma=function(i){o.varSpin=!0,o.RegistroFUM={registrado:"OK",mensaje:""};var e=c.SERVICE_SITOLextgen+"ApiTerritorio/DocumentoFum?q="+i.piif;$("#visorFum object").attr("data",e),S(function(){o.varSpin=!1},1e3)},o.loginPagoEnLinea=function(){var o={usr_usuario:"catastro",usr_clave:"catastro2016"};$.ajax({dataType:"json",type:"POST",url:"https://pagonline.lapaz.bo/api/logueo",data:o,async:!1,success:function(o){l.set("TOKEN",o.token)},error:function(o,i,e){dataResp='{"error":{"message":"'+o.responseText+'","code":700}}',console.log("Error en login pago en Linea",e)}})},o.accionPagoOL=function(o){l.set("IDFUM",o.fum),window.location.href="#servicios|epagos"},o.accionSeguimientoFlujo=function(i){if($.blockUI(),i.piif){var e={q:i.piif};a({method:"POST",url:c.SERVICE_SITOLextgen+"ApiMotorFlujo/FlujoSeguimientoTarea",data:Object.toparams(e),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,t,a,r){e.res?(u.show("","Error al consultar seguimiento de trámite","error"),console.log("Error al consultar seguimiento de trámite",e)):($("#seguimientoNroSolicitud").val(i.idFichaTecnica),$("#seguimientoTipoTramite").val("PERMISOS CONSTRUCCIÓN"),o.listaSeguimientoTareas=e,$("#divPopupSeguimiento").modal("show")),$.unblockUI()}).error(function(o,i,e,t){u.show("","Error en el flujo de seguimiento de trámite","error"),console.log("Error en el flujo de seguimiento de trámite",o),$.unblockUI()})}else u.show("","Error en la accion de seguimiento de flujo de trámite","error"),console.log("Error en la accion de seguimiento de flujo de trámite",i)},o.accionDelegarSolicitud=function(i){o.flujo.paso=o.flujo.pasos.paso2,o.getSolicitud(i.idFichaTecnica)},o.scroll=0,o.loading="loading",o.getNavStyle=function(o){return o>100?"pdf-controls fixed":"pdf-controls"},o.onError=function(o){},o.onLoad=function(){o.loading=""},o.onProgress=function(o){},o.resetUrl=function(){o.pdfUrl="../catastro/img/Default.pdf";var i="../catastro/img/Default.pdf";o.RefreshUrl(i)},o.configCartilla={urlTemplate:c.SERVICE_SITOLextgen+"Archivos/cartillas/distrito {distrito}/cartillas/{patron}.pdf",url:c.SERVICE_SITOLextgen+"Archivos/cartillas/distrito {distrito}/cartillas/{patron}.pdf",patron:null},o.pdfUrl="../catastro/img/Default.pdf",o.accionVerDocumentoFinal=function(i){$("#divPopup7").modal("show");var e=document.getElementById("pdfView");e.addEventListener?(e.addEventListener("mousewheel",P,!1),e.addEventListener("DOMMouseScroll",P,!1)):e.attachEvent("onmousewheel",P),o.varSpin=!0,o.resetUrl();var t=c.SERVICE_SITOLextgen+"ApiTerritorio/DocumentoFinalPC?q="+i.piif;o.RefreshUrl(t),S(function(){o.varSpin=!1},2800),o.fit()},o.accionVerDocumentoFinalImagen=function(i){$("#divPopupDocFinal").modal("show"),o.docFinalImagen=c.SERVICE_SITOLextgen+"ApiTerritorio/DocumentoFinalPCImagen?q="+i.piif},o.visorIframe={url:null,titulo:null,texto:null},o.visorIframeCambiarModelo=function(i,e,t){o.visorIframe.url="http://sitservicios.lapaz.bo/sit/LUSU/modelo_lusu2.html?pisos=xpisos&anchoVia=xanchovia&superficie=xsuperficie",o.visorIframe.url=o.visorIframe.url.replace("xpisos",t).replace("xanchovia",e).replace("xsuperficie",i),o.visorIframe.titulo="Modelo 3D",o.visorIframe.texto="Modelo generado en función a la superficie del predio y número máximo de plantas. <b style='color: red'>Modelo Referencial</b>",$("#visorIframe").attr("src",o.visorIframe.url)},o.visorIframeCambiarMapa=function(i){o.visorIframe.url="http://sitservicios.lapaz.bo/sit/LUSU/MapaLUSU.html?codcat=xcodcat",o.visorIframe.url=o.visorIframe.url.replace("xcodcat",i),window.open(o.visorIframe.url,"_blank")},o.cambiarPaso=function(i){switch(i){case o.flujo.pasos.paso0:o.resetSolicitud(),o.flujo.paso=i;break;case o.flujo.pasos.paso1:o.resetSolicitud(),o.getListaPredios(),o.flujo.paso=i;break;case o.flujo.pasos.paso2:o.flujo.paso=i;break;case o.flujo.pasos.paso3:}},o.getListaPredios=function(){$.blockUI(),o.listaPredios=[];var i=l.get("CICIUDADANO");"JURIDICO"==l.get("TIPO_PERSONA")&&(i=l.get("NITCIUDADANO"));var e=new dataSIT;e.dplLstCC(i,function(i){var e=JSON.parse(i);e.success?(o.listaPredios=e.success.dataSql,$.unblockUI()):(u.show("","Error al obtener la lista de predios","error"),console.log("Error al obtener la lista de predios",e.error.message,e.error.code),$.unblockUI())})},o.setPredioSeleccionado=function(i){o.predioSeleccionado=i,o.getPredio(o.predioSeleccionado.CodigoCatastral),o.getPredioPropietarios(o.predioSeleccionado.CodigoCatastral)},o.getPredio=function(i){$.blockUI(),o.predioSeleccionadoPropietarios=[];var e=new dataSIT;e.pcPrediosConsolidado(i,function(e){var t=JSON.parse(e);t.success?(1==t.success.dataSql.length?o.setSolicitudDatosPredio(t.success.dataSql[0]):0==t.success.dataSql.length?(u.show("","Error no se encontró el predio con Código Catastral"+i+" en la tabla consolidada","error"),console.log("Error no se encontró el predio con Cód Catastral:"+i)):(u.show("","Error se encontró más de un registro con el mismo Código Catastral: "+i+" en la tabla consolidada","error"),console.log("Error se encontró más de un registro con el mismo Código Catastral:"+i)),$.unblockUI()):($.unblockUI(),u.show("","Error al recuperar datos predios","error"),console.log("Error al recuperar datos predios",t.error.message,t.error.code))})},o.setSolicitudDatosPredio=function(i){o.solicitud.codigoCatastral=i.codigoCatastral,o.solicitud.macrodistrito=i.macrodistrito,o.solicitud.zona=i.zona,o.solicitud.tipoVia=i.tipoVia,o.solicitud.nombreVia=i.nombreVia,o.solicitud.anchoVia=i.anchoVia,o.solicitud.nroPuerta=i.nroPuerta,o.solicitud.direccion=i.direccion,o.solicitud.nroInmueble=i.nroInmueble,o.solicitud.superficieReal=i.superficieReal,o.solicitud.superficieRealCatastro=i.superficieReal,o.solicitud.idPendTerreno=i.idPendTerreno,o.solicitud.riesgoConstruccionLocalizacionCategoria=i.zonaRiesgo,o.solicitud.lusu=i.cartillaLusu,o.solicitud.distritoMunicipal=i.DistritoMunicipal,o.solicitud.idPCCartilla=i.idPCCartilla,o.solicitud.pendTerreno=i.pendTerreno,i.pendienteViaEIV?o.solicitud.pendienteVia=i.pendienteViaEIV:o.solicitud.pendienteVia=0,o.solicitud.codigoMirador=i.codigoMirador,o.solicitud.descripcionMirador=i.descripcionMirador,o.solicitud.codigoPlaza=i.codigoPlaza,o.solicitud.descripcionPlaza=i.descripcionPlaza,o.solicitud.cPresidencialDistancia=i.cPresidencialDistancia,o.solicitud.cPresidencialAltura=i.cPresidencialAltura,o.solicitud.telefericoConsolidado=i.telefericoConsolidado,o.solicitud.telefericoColor=i.telefericoColor,o.solicitud.restricciones=0,"CH1"==i.patronLusu||"CH2"==i.patronLusu||"CH3"==i.patronLusu||"CH4"==i.patronLusu?o.solicitud.restriccionCH=1:o.solicitud.restriccionCH=0,null==i.codigoMirador&&null==i.codigoPlaza&&null==i.cPresidencialDistancia&&null==i.cPresidencialAltura&&null==i.telefericoColor&&1!=o.solicitud.restriccionCH||(o.solicitud.restricciones=1),o.configCartilla.patron=o.solicitud.lusu,o.configCartilla.url=o.configCartilla.urlTemplate.replace("{distrito}",o.solicitud.distritoMunicipal).replace("{patron}",i.patronLusu),o.getAlturasMaximas(o.solicitud.idPCCartilla,o.solicitud.anchoVia)},o.getPredioPropietarios=function(i){$.blockUI(),o.predioSeleccionadoPropietarios=[];var e=new dataSIT;e.pcPredio(i,"C2",function(i){var e=JSON.parse(i);e.success?(o.predioSeleccionadoPropietarios=e.success.dataSql,$.unblockUI()):(u.show("","Error al obtener el predio propietarios","error"),console.log("Error al obtener el predio propietarios",e.error.message,e.error.code),$.unblockUI())})},o.getAlturasMaximas=function(i,e){o.solicitud.cantidadMaxPlantas=null,o.solicitud.cantidadMaxPlantasIncentivo=null;var t=new dataSITOL;t.pcLusuParametrosAlturaMaxima(i,e,function(i){var e=JSON.parse(i);if(e.success){if(e.success.dataSql.length>0){var t=e.success.dataSql[0];o.solicitud.cantidadMaxPlantas=t.cantidadMaxPlantas,o.solicitud.cantidadMaxPlantasIncentivo=t.cantidadMaxPlantasIncentivo}}else console.log("Error al obtener las alturas maximas",e.error.message)})},o.setSolicitudArquitecto=function(i){o.solicitud.arquitectoNombre=i.arquitectoNombre,o.solicitud.arquitectoRegistroNacionalCAB=i.registroNacionalCAB,o.solicitud.arquitectoTelefono=i.telefonoCelular,o.solicitud.arquitectoEmail=i.correoElectronico,o.cambiarTextoBtnSolicitud()},o.saveUpdateSolicitud=function(){null!=o.solicitud.idFichaTecnica&&o.solicitud.idFichaTecnica>0?o.updateSolicitud():o.saveSolicitud()},o.saveSolicitud=function(){$.blockUI(),null!=o.solicitud.arquitectoNombre&""!=o.solicitud.arquitectoNombre?o.solicitud.idEstado=2:o.solicitud.idEstado=1,void 0==o.solicitud.arquitectoNombre&&(o.solicitud.arquitectoNombre=""),void 0==o.solicitud.arquitectoRegistroNacionalCAB&&(o.solicitud.arquitectoRegistroNacionalCAB=""),void 0==o.solicitud.arquitectoEmail&&(o.solicitud.arquitectoEmail=""),void 0==o.solicitud.arquitectoTelefono&&(o.solicitud.arquitectoTelefono="");var i=new dataSITOL;i.pcSolicitudReg(o.solicitud.idTipoTramite,o.solicitud.macrodistrito,o.solicitud.distritoMunicipal,o.solicitud.lusu,o.solicitud.superficieRealCatastro,o.solicitud.codigoCatastral,o.solicitud.nombreSolicitante,o.solicitud.paternoSolicitante,o.solicitud.maternoSolicitante,o.solicitud.numeroDocumentoSol,o.solicitud.tipoDocumento,o.solicitud.expedido,o.solicitud.telefonoSolicitante,o.solicitud.emailSolicitante,o.solicitud.arquitectoNombre,o.solicitud.arquitectoRegistroNacionalCAB,o.solicitud.arquitectoEmail,o.solicitud.arquitectoTelefono,o.solicitud.autorizacionEntregaDocumentos,o.solicitud.autorizacionSeguimientoTramite,o.solicitud.riesgoConstruccionLocalizacionCategoria,o.solicitud.idPendTerreno,o.solicitud.anchoVia,o.solicitud.idEstado,o.solicitud.idPCCartilla,o.solicitud.zona,o.solicitud.direccion,o.solicitud.nroInmueble,o.solicitud.pendienteVia,function(i){var e=JSON.parse(i);e.success?e.success.dataSql[0].d?("OK"!=e.success.dataSql[0].d?o.sendCorreoDelegado(e.success.dataSql[0].d):($.unblockUI(),o.getSolicitudes(),u.show("","Solicitud guardada correctamente","success")),o.flujo.paso=o.flujo.pasos.paso0):($.unblockUI(),u.show("","Error al guardar la solicitud","error"),console.log("Error al guardar la solicitud",e.error.message,e.error.code)):($.unblockUI(),console.log("Error al guardar",e.error.message,e.error.code))})},o.updateSolicitud=function(){$.blockUI(),null!=o.solicitud.arquitectoNombre&""!=o.solicitud.arquitectoNombre?o.solicitud.idEstado=2:o.solicitud.idEstado=1,void 0==o.solicitud.arquitectoNombre&&(o.solicitud.arquitectoNombre=""),void 0==o.solicitud.arquitectoRegistroNacionalCAB&&(o.solicitud.arquitectoRegistroNacionalCAB=""),void 0==o.solicitud.arquitectoEmail&&(o.solicitud.arquitectoEmail=""),void 0==o.solicitud.arquitectoTelefono&&(o.solicitud.arquitectoTelefono="");var i=new dataSITOL;i.pcSolicitudAct(o.solicitud.idFichaTecnica,o.solicitud.idTipoTramite,o.solicitud.macrodistrito,o.solicitud.distritoMunicipal,o.solicitud.lusu,o.solicitud.superficieRealCatastro,o.solicitud.codigoCatastral,o.solicitud.nombreSolicitante,o.solicitud.paternoSolicitante,o.solicitud.maternoSolicitante,o.solicitud.numeroDocumentoSol,o.solicitud.tipoDocumento,o.solicitud.expedido,o.solicitud.telefonoSolicitante,o.solicitud.emailSolicitante,o.solicitud.arquitectoNombre,o.solicitud.arquitectoRegistroNacionalCAB,o.solicitud.arquitectoEmail,o.solicitud.arquitectoTelefono,o.solicitud.autorizacionEntregaDocumentos,o.solicitud.autorizacionSeguimientoTramite,o.solicitud.riesgoConstruccionLocalizacionCategoria,o.solicitud.idPendTerreno,o.solicitud.anchoVia,o.solicitud.idEstado,o.solicitud.idPCCartilla,o.solicitud.pendienteVia,function(i){var e=JSON.parse(i);e.success?e.success.dataSql[0].d?("OK"!=e.success.dataSql[0].d?o.sendCorreoDelegado(e.success.dataSql[0].d):($.unblockUI(),o.getSolicitudes(),u.show("","Solicitud actualizada correctamente","success")),o.flujo.paso=o.flujo.pasos.paso0):($.unblockUI(),u.show("","Error al actualizar solicitud","error"),console.log("Error al actualizar solicitud",e)):($.unblockUI(),console.log("Error al guardar solicitud",e.error.message,e.error.code))})},o.sendCorreoDelegado=function(i){var e={q:i};a({method:"POST",url:c.SERVICE_SITOLextgen+"ApiTerritorio/FlujoCorreoDelegado",data:Object.toparams(e),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(i,e,t,a){$.unblockUI(),"OK"==i.res?(o.getSolicitudes(),u.show("","Registro guardado y delegado al arquitecto","success")):(u.show("","Error al enviar correo","error"),console.log("Error al enviar correo",i))}).error(function(o,i,e,t){u.show("","Error al enviar correo","error"),console.log("Error al enviar correo",o,i,e,t)})},o.cambiarTextoBtnSolicitud=function(){null!=o.solicitud.arquitectoNombre&""!=o.solicitud.arquitectoNombre?o.btnSaveSolicitud=o.textoBotones.btnDelegar:o.btnSaveSolicitud=o.textoBotones.btnRegistrar},o.validarFormularioSolicitud=function(){var i=!0;if(null==o.solicitud.idTipoTramite||0==o.solicitud.idTipoTramite)i=!0;else if(1==o.solicitud.idTipoTramite)if(null!=o.solicitud.arquitectoNombre&""!=o.solicitud.arquitectoNombre){var e=null==o.solicitud.arquitectoTelefono||""==o.solicitud.arquitectoTelefono||null==o.solicitud.arquitectoEmail||""==o.solicitud.arquitectoEmail||null==o.solicitud.arquitectoRegistroNacionalCAB||""==o.solicitud.arquitectoRegistroNacionalCAB;i=e}else i=!1;else i=!1;return i},o.ErrorCapcha="",o.getlimpiareRROR=function(){o.ErrorCapcha=""},o.getCaptchasX=function(){var o=new captcha;o.obtcaptcha(function(o){json=JSON.parse(o),partes=json.success[0].sp_captcha_porx1.split(","),numero=partes[0].substring(1),i1=partes[2]+","+partes[3],i2=partes[4]+","+partes[5],document.getElementById("img2").src=i1.substring(1,i1.length-1),document.getElementById("img1").src=i2.substring(1,i2.length-2);var i="";"A"==partes[1]?i="AYMARA":"Q"==partes[1]?i="QUECHUA":"G"==partes[1]?i="GUARANI":"C"==partes[1]?i="CASTELLANO":console.log("Error CaptchasX",partes[1]),document.getElementById("img1").title="Palabra en "+i,document.getElementById("resultadoC").value="",document.getElementById("resultadoC").placeholder="Ingrese texto: "+i+" CASTELLANO",document.getElementById("lbllengua").placeholder="Ingrese texto: "+i+" CASTELLANO"})},o.VerificarCapcha=function(){var i=$("#resultadoC").val(),e=numero,t=new captcha;t.identificador=e,t.respuesta=i,t.verificarCaptcha(function(i){json=JSON.parse(i),void 0==json.success[0]?(o.getCaptchasX(),o.resultadoC="",o.ErrorCapcha="Vuelva registrar el capcha"):($("#divPopupCaptcha").modal("hide"),o.saveUpdateSolicitud())})},o.getPredioRiesgo=function(i){var e=new dataSIT;e.pcPredioRiesgo(i,function(e){var t=JSON.parse(e);t.success?1==t.success.dataGeo.features.length?o.solicitud.riesgoConstruccionLocalizacionCategoria=t.success.dataGeo.features[0].properties.GRADO:0==t.success.dataGeo.features.length?console.log("Error no se encontro espacialmente el riesgo del predio wkt:"+i):console.log("Error se encontraron mas zonas de riesgo para el predio wkt:"+i):console.log("Error al ubicar espacialmente el riesgo del predio wkt:"+i)})},o.getPredioLUSU=function(i){var e=new dataSIT;e.pcPredioLUSU(i,function(e){var t=JSON.parse(e);t.success?1==t.success.dataGeo.features.length?(o.solicitud.lusu=t.success.dataGeo.features[0].properties.uspa_fina+" - d"+t.success.dataGeo.features[0].properties.distrito,o.solicitud.distritoMunicipal=t.success.dataGeo.features[0].properties.distrito):0==t.success.dataGeo.features.length?console.log("Error no se encontro espacialmente el lusu del predio wkt:"+i):console.log("Error no se encontraron mas zonas de lusu para el predio wkt:"+i):console.log("Error al ubicar espacialmente el lusu del predio wkt:"+i)})},o.setSolicitudParametrosEdificacion=function(i){o.flujo.paso=o.flujo.pasos.paso3,o.getSolicitud(i.idFichaTecnica)},o.getSolicitud=function(i){var e=new dataSITOL;e.pcSolicitudGet(i,function(i){var e=JSON.parse(i);e.success?(v(e.success.dataSql[0],o.solicitud),o.cambiarTextoBtnSolicitud(),ALEPredio=o.solicitud.superficieReal,idCartilla=o.solicitud.idPCCartilla,AnchoVia=o.solicitud.anchoVia,o.solicitud.ALE=o.solicitud.superficieReal,o.getCargarCartilla(idCartilla,AnchoVia,ALEPredio)):console.log("Error al obtener la solicitud",e.error.message)})},o.cambiarCartilla=function(){ALEPredio=o.solicitud.ALE,idCartilla=o.solicitud.idPCCartilla,AnchoVia=o.solicitud.anchoVia,joao=o.solicitud.ALE,o.getCargarCartilla(idCartilla,AnchoVia,ALEPredio)},o.getCargarCartilla=function(i,e,t){var a=new dataSITOL;a.pcLusuParametrosCompleto(i,e,function(i){var e=JSON.parse(i);if(e.success){var a=e.success.dataSql[0];o.idPCCartilla=a.idPCCartilla,o.zona=a.zona,o.patron=a.patron,o.cartilla=a.zona+" "+a.patron,o.ALE=a.ALE,o.FML=a.FML,o.AMC=a.AMC,o.AMCSotano=a.AMCSotano,o.AMCSemisotano=a.AMCSemisotano,o.valor1=a.AMCSemisotano,o.AMCZocalo=a.AMCZocalo,o.AMCTorre=a.AMCTorre,o.valor2=a.AMCTorre,o.AMCMezzanine=a.AMCMezzanine,o.AME=a.porcentajeALE,o.AMF=a.alturaMaximaFachada,o.frontal=a.frontal,o.fondo=a.fondo,o.laterales=a.laterales,o.frontalOpcional=a.frontalOpcional,o.fondoOpcional=a.fondoOpcional,o.lateralesOpcional=a.lateralesOpcional,o.opcionalLimiteMin=a.opcionalLimiteMin,o.opcionalLimiteMax=a.opcionalLimiteMax,o.frontalReferencia=a.frontalReferencia,o.fondoReferencia=a.fondoReferencia,o.lateralesReferencia=a.lateralesReferencia,o.zocaloFrontal=a.zocaloFrontal,o.zocaloFondo=a.zocaloFondo,o.zocaloLaterales=a.zocaloLaterales,o.MensajeNMP="Una unidad por cada "+a.NMP+" m² de AME",o.NMP=a.NMP,o.AMV=a.AMV,o.Voladizo=a.anchoVoladizo,o.AMCSemisotanoPI=a.AMCSemisotano,o.AMCTorrePI=a.AMCTorre,o.incentivoAMCIncremento=a.incentivoAMCIncremento,o.incentivoAMCPorcentaje=a.incentivoAMCPorcentaje,o.incentivoRME=a.incentivoRME,t>=2*o.ALE&&o.incentivoAMCIncremento!=-1?(o.AMEPI=a.porcentajeALE+100,o.MensajeDobleALE="AME con incremento de 100% de ALE por lote con doble ALE",o.MensajeAMFAnchoVia="AMF con incentivo según ancho via: "+a.descripcionAnchoVia,o.AMFPI=a.alturaMaximaFachada+a.incrementoIncentivo):(o.AMEPI=a.porcentajeALE,o.MensajeDobleALE="No aplica incentivo",o.MensajeAMFAnchoVia="AMF sin incentivo según ancho via: "+a.descripcionAnchoVia,o.AMFPI=a.alturaMaximaFachada),o.RMEFrontalPI=a.frontal,o.valor3=a.frontal,o.MensajeReduccionSemiSotanoAMC="Por cada "+o.incentivoAMCPorcentaje+"% menos de AMC de semisótano utilizado se incrementa "+o.incentivoAMCIncremento+"% de ALE al AME",o.MensajeReduccionTorreAMC="Por cada "+o.incentivoAMCPorcentaje+"% menos de AMC de torre utilizado se incrementa "+o.incentivoAMCIncremento+"% de ALE al AME",o.MensajeNoAplicaIncentivo="No aplica incentivo",o.MensajeIncrementoRME="Incremento de "+o.incentivoRME+"% de ALE al AME por cada ml de retiro frontal adicional",o.MensajeOpcionalRME="Opcional de "+o.opcionalLimiteMin+" m. en adelante",o.ALEPredio=t,o.AMCSotanoPredio=(t*a.AMCSotano/100).toFixed(2),o.AMCSemisotanoPredio=(t*a.AMCSemisotano/100).toFixed(2),o.AMCTorrePredio=(t*a.AMCTorre/100).toFixed(2),o.AMCZocaloPredio=(t*a.AMCZocalo/100).toFixed(2),o.AMCMezzaninePredio=(t*a.AMCMezzanine/100).toFixed(2),o.AMEPredio=(t*o.AMEPI/100).toFixed(2),o.AMVPredio=(t*a.AMV/100).toFixed(2),o.RMEFrontalPredio=a.frontal,o.AMCSemisotanoPI=(t*a.AMCSemisotano/100).toFixed(2),o.AMCTorrePI=(t*a.AMCTorre/100).toFixed(2),o.NMPPI=(o.AMEPredio/a.NMP).toFixed(0),o.idPCCartillaAnchoVia=a.idPCCartillaAnchoVia,o.incrementoIncentivo=a.incrementoIncentivo,o.numeroZocalos=a.numeroZocalos}else console.log("Error al obtener cargar Cartilla ",e.error.message)})},o.inputSuperficie=function(i){o.SuperficieCatastro=i},o.verCartilla=function(i){o.getCargarCartilla(i.idCartilla)},o.incentivoAMCSemisotano=function(i){AMEPI=o.AME,o.AMCSemisotanoPI=i,ALEPredio>=2*o.ALE&&(AMEPI+=100),o.AMEPI=AMEPI+(o.AMCSemisotano-o.AMCSemisotanoPI)/10*o.incentivoAMCIncremento+(o.AMCTorre-o.AMCTorrePI)/10*o.incentivoAMCIncremento+(o.RMEFrontalPI-o.frontal)*o.incentivoRME,o.NMPPI=(o.AMEPredio/o.NMP).toFixed(0),o.AMEPredio=(ALEPredio*o.AMEPI/100).toFixed(2),o.AMCSemisotanoPredio=(o.ALEPredio*i/100).toFixed(2)},o.incentivoAMCTorre=function(i){AMEPI=o.AME,o.AMCTorrePI=i,ALEPredio>=2*o.ALE&&(AMEPI+=100),o.AMEPI=AMEPI+(o.AMCSemisotano-o.AMCSemisotanoPI)/10*o.incentivoAMCIncremento+(o.AMCTorre-o.AMCTorrePI)/10*o.incentivoAMCIncremento+(o.RMEFrontalPI-o.frontal)*o.incentivoRME,o.NMPPI=(o.AMEPredio/o.NMP).toFixed(0),o.AMEPredio=(ALEPredio*o.AMEPI/100).toFixed(2),o.AMCTorrePredio=(o.ALEPredio*i/100).toFixed(2)},o.incentivoRMEFrontal=function(i){AMEPI=o.AME,o.RMEFrontalPI=i,ALEPredio>=2*o.ALE&&(AMEPI+=100),o.AMEPI=AMEPI+(o.AMCSemisotano-o.AMCSemisotanoPI)/10*o.incentivoAMCIncremento+(o.AMCTorre-o.AMCTorrePI)/10*o.incentivoAMCIncremento+(o.RMEFrontalPI-o.frontal)*o.incentivoRME,o.NMPPI=(o.AMEPredio/o.NMP).toFixed(0),o.AMEPredio=(ALEPredio*o.AMEPI/100).toFixed(2),o.RMEFrontalPredio=(o.ALEPredio*i/100).toFixed(2)}}app.filter("jsonDate",["$filter",function(o){return function(i,e){return i?o("date")(parseInt(i.substr(6)),e):""}}]),app.filter("tiempoCumplimientoDesdeAceptacion",["$filter","$sce",function(o,i){return function(o,e){var t="";if(null!=o.fechaAceptacion){var a=o,r=o.tiempoCumplimiento,l=new Date(parseInt(a.fechaAceptacion.substr(6))),c=new Date;o.fechaFin&&(c=new Date(parseInt(a.fechaFin.substr(6))));var n=new Date(l.getFullYear(),l.getMonth(),l.getDate()),s=new Date(c.getFullYear(),c.getMonth(),c.getDate()),u=s.getTime()-n.getTime(),d=u/864e5,p=r-d;t=p<=0?"<span style='color:red'>Fuera de plazo</span>":"<span style='color:green'>Dentro del plazo</span>"}return i.trustAsHtml(t)}}]),app.directive("lusuparametroOpcional",["$filter",function(o){return formatter=function(o){return o==-2?"OPCIONAL":o},{restrict:"A",require:"ngModel",link:function(o,i,e,t){t.$formatters.push(formatter)}}}]),app.directive("modelformatoSercat",["$filter",function(o){return formatter=function(o){if(null!=o){if(15==o.length){var i=o,e=i.substring(0,3)+"-"+i.substring(3,7)+"-"+i.substring(7,11)+"-"+i.substring(11,15);return e}return o}},{restrict:"A",require:"ngModel",link:function(o,i,e,t){t.$formatters.push(formatter)}}}]);