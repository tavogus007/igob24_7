ol.control.LayerSwitcher=function(e){var t=e||{},n=t.tipLabel?t.tipLabel:"Legend";this.mapListeners=[],this.hiddenClassName="ol-unselectable ol-control layer-switcher",ol.control.LayerSwitcher.isTouchDevice_()&&(this.hiddenClassName+=" touch"),this.shownClassName=this.hiddenClassName+" shown";var o=document.createElement("div");o.className=this.hiddenClassName;var r=document.createElement("button");r.setAttribute("title",n),o.appendChild(r),this.panel=document.createElement("div"),this.panel.className="panel",o.appendChild(this.panel),ol.control.LayerSwitcher.enableTouchScroll_(this.panel);var i=this;r.onmouseover=function(e){i.showPanel()},r.onclick=function(e){e=e||window.event,i.showPanel(),e.preventDefault()},i.panel.onmouseout=function(e){e=e||window.event,i.panel.contains(e.toElement||e.relatedTarget)||i.hidePanel()},ol.control.Control.call(this,{element:o,target:t.target})},ol.inherits(ol.control.LayerSwitcher,ol.control.Control),ol.control.LayerSwitcher.prototype.showPanel=function(){this.element.className!=this.shownClassName&&(this.element.className=this.shownClassName,this.renderPanel())},ol.control.LayerSwitcher.prototype.hidePanel=function(){this.element.className!=this.hiddenClassName&&(this.element.className=this.hiddenClassName)},ol.control.LayerSwitcher.prototype.renderPanel=function(){for(this.ensureTopVisibleBaseLayerShown_();this.panel.firstChild;)this.panel.removeChild(this.panel.firstChild);var e=document.createElement("ul");this.panel.appendChild(e),this.renderLayers_(this.getMap(),e)},ol.control.LayerSwitcher.prototype.setMap=function(e){for(var t=0;t<this.mapListeners.length;t++)this.getMap().unByKey(this.mapListeners[t]);if(this.mapListeners.length=0,ol.control.Control.prototype.setMap.call(this,e),e){var n=this;this.mapListeners.push(e.on("pointerdown",function(){n.hidePanel()})),this.renderPanel()}},ol.control.LayerSwitcher.prototype.ensureTopVisibleBaseLayerShown_=function(){var e;ol.control.LayerSwitcher.forEachRecursive(this.getMap(),function(t,n,o){"base"===t.get("type")&&t.getVisible()&&(e=t)}),e&&this.setVisible_(e,!0)},ol.control.LayerSwitcher.prototype.setVisible_=function(e,t){var n=this.getMap();e.setVisible(t),t&&"base"===e.get("type")&&ol.control.LayerSwitcher.forEachRecursive(n,function(t,n,o){t!=e&&"base"===t.get("type")&&t.setVisible(!1)})},ol.control.LayerSwitcher.prototype.renderLayer_=function(e,t){var n=this,o=document.createElement("li"),r=e.get("title"),i=e.get("title").replace(/\s+/g,"-")+"_"+t,a=document.createElement("label");if(e.getLayers){o.className="group",a.innerHTML=r,o.appendChild(a);var l=document.createElement("ul");o.appendChild(l),this.renderLayers_(e,l)}else{o.className="layer";var s=document.createElement("input");"base"===e.get("type")?(s.type="radio",s.name="base"):s.type="checkbox",s.id=i,s.checked=e.get("visible"),s.onchange=function(t){n.setVisible_(e,t.target.checked)},o.appendChild(s),a.htmlFor=i,a.innerHTML=r,o.appendChild(a)}return o},ol.control.LayerSwitcher.prototype.renderLayers_=function(e,t){for(var n,o=e.getLayers().getArray().slice().reverse(),r=0;r<o.length;r++)(n=o[r]).get("title")&&t.appendChild(this.renderLayer_(n,r))},ol.control.LayerSwitcher.forEachRecursive=function(e,t){e.getLayers().forEach(function(e,n,o){t(e,n,o),e.getLayers&&ol.control.LayerSwitcher.forEachRecursive(e,t)})},ol.control.LayerSwitcher.enableTouchScroll_=function(e){if(ol.control.LayerSwitcher.isTouchDevice_()){var t=0;e.addEventListener("touchstart",function(e){t=this.scrollTop+e.touches[0].pageY},!1),e.addEventListener("touchmove",function(e){this.scrollTop=t-e.touches[0].pageY},!1)}},ol.control.LayerSwitcher.isTouchDevice_=function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}};